<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
Â  Â  <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
Â  Â  <title>Barber Note Pro v.11.3.1 (Updated)</title>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
Â  Â <style>
        /* --- 1. à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸µà¹à¸¥à¸°à¸˜à¸µà¸¡ (à¸£à¸§à¸¡à¸‚à¸­à¸‡à¹€à¸”à¸´à¸¡ + à¸˜à¸µà¸¡à¹ƒà¸«à¸¡à¹ˆ) --- */
        :root { 
            --primary: #00CCFF; /* à¸Ÿà¹‰à¸² Neon à¸•à¸²à¸¡à¹‚à¸¥à¹‚à¸à¹‰à¹ƒà¸«à¸¡à¹ˆ */
            --accent: #16a34a; 
            --danger: #dc2626; 
            --warning: #f59e0b; 
            --main-bg: #f1f5f9; 
            --card: #ffffff; 
            --text: #1e293b; 
            --input-bg: #f8fafc; 
            --border: #e2e8f0; 
        }
        body.theme-dark { --main-bg: #0f172a; --card: #1e293b; --text: #f8fafc; --input-bg: #334155; --border: #475569; }
        body.theme-pastel { --main-bg: #faf5ff; --card: #ffffff; --text: #4c1d95; --input-bg: #f5f3ff; --border: #e9d5ff; }

        body { margin: 0; font-family: 'Kanit'; background: var(--main-bg); color: var(--text); padding-bottom: 90px; transition: 0.3s; font-weight: 300; }
        
        /* --- 2. Header & Navigation --- */
        header { padding: 15px; background: var(--card); display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top:0; z-index:100; }
        header h1 { flex: 1; text-align: center; font-size: 18px; margin: 0; font-weight: 500; }
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; border-top: 1px solid rgba(0,0,0,0.1); height: 75px; align-items: center; justify-content: space-around; z-index: 9999; }
        .nav-item { flex: 1; text-align: center; color: #94a3b8; font-size: 13px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; }
        .nav-item.active { color: var(--primary); font-weight: 500; }

        /* --- 3. à¸à¸²à¸£à¹Œà¸”à¹à¸¥à¸° Layout (à¹à¸šà¸šà¹ƒà¸«à¸¡à¹ˆ) --- */
        .page { display: none; padding: 15px; animation: fadeIn 0.2s; } 
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .card { background: var(--card); border-radius: 20px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; width: 100%; box-sizing: border-box; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 8px; width: 100%; box-sizing: border-box; }

        input, select { width: 100%; height: 45px; padding: 8px 10px; border-radius: 12px; border: 1px solid var(--border); font-size: 16px; box-sizing: border-box; background: var(--input-bg); color: var(--text); outline: none; font-family: 'Kanit'; }
        
        /* --- 4. à¸›à¸¸à¹ˆà¸¡à¹à¸¥à¸°à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥ --- */
        .btn-pay { border: 2px solid transparent; background: var(--input-bg); color: var(--text); padding: 8px 5px; border-radius: 12px; font-weight: 500; cursor: pointer; transition: 0.2s; font-size: 18px; display: flex; align-items: center; justify-content: center; gap: 4px; }
        .active-cash { border: 3px solid #16a34a !important; color: #14532d !important; background: #dcfce7 !important; }
        .active-transfer { border: 3px solid #0284c7 !important; color: #0c4a6e !important; background: #e0f2fe !important; }
        
        .btn-save { background: var(--primary); color: white; width: 100%; padding: 12px; border-radius: 12px; font-size: 18px; font-weight: 600; border: none; cursor: pointer; }
        
        /* à¹à¸–à¸šà¸ªà¸–à¸²à¸™à¸°à¹à¸¥à¸°à¸›à¸¸à¹ˆà¸¡à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸šà¸´à¸™à¸«à¸™à¹‰à¸² 2 */
        .status-bar { width: 100%; padding: 15px; border-radius: 15px; text-align: center; font-weight: 600; font-size: 16px; box-sizing: border-box; }
        .status-blue { background: #e0f2fe; color: #0284c7; } 
        .btn-plane { width: 50px; height: 50px; border-radius: 15px; background: var(--primary); color: white; border: none; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,204,255,0.3); }

        /* --- 5. à¸£à¸°à¸šà¸šà¸¢à¸¸à¸š/à¸‚à¸¢à¸²à¸¢ à¸«à¸™à¹‰à¸² 3 (Accordion) --- */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-toggle-history { width: 100%; background: var(--input-bg); border: 1px solid var(--border); padding: 12px; border-radius: 15px; font-size: 14px; color: var(--text); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-family: 'Kanit'; }
        .accordion-content { display: none; background: rgba(0,0,0,0.02); border-radius: 15px; padding: 15px; margin-top: 8px; border: 1px solid var(--border); }

        /* à¸ªà¹ˆà¸§à¸™à¸­à¸·à¹ˆà¸™à¹† à¸„à¸‡à¹€à¸”à¸´à¸¡ */
        .acc-main-card { background: var(--card); padding: 18px; border-radius: 25px; border-left: 6px solid #f59e0b; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 15px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); width: 100%; border-radius: 25px; padding: 22px; max-height: 85vh; overflow-y: auto; }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #ddd; display: inline-block; margin: 5px; }
    </style>
</head>
<body id="mainBody">
<header><div style="width:40px"></div><h1 id="shopNameDisp">Barber Note</h1><div onclick="openSettings()" style="cursor:pointer"><i class="fas fa-cog"></i></div></header>

Â  <div id="p1" class="page active">
Â <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; padding: 5px;">
Â  Â Â 
Â  Â  <div style="position: relative; background: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 12px; padding: 12px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
Â  Â  Â  Â  <span style="font-size: 18px;">ğŸ“…</span>
Â  Â  Â  Â  <input type="date" id="dateInp" onchange="updateDateDisplay(this.value)" style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer;">
Â  Â  Â  Â  <span id="dateDisplay" style="font-size: 10px; font-weight: 700; color: #475569;">à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ</span>
Â  Â  </div>

Â  Â  <div onclick="handleInsurance()" style="background: #fffbeb; border: 1.5px solid #fde68a; border-radius: 12px; padding: 12px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
Â  Â  Â  Â  <span style="font-size: 18px;">ğŸ›¡ï¸</span>
Â  Â  Â  Â  <span style="font-size: 10px; font-weight: 800; color: #b45309;">à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰</span>
Â  Â  </div>

Â  Â  <div onclick="handleHoliday()" style="background: #fff1f2; border: 1.5px solid #fecdd3; border-radius: 12px; padding: 12px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
Â  Â  Â  Â  <span style="font-size: 18px;">ğŸ–ï¸</span>
Â  Â  Â  Â  <span style="font-size: 10px; font-weight: 800; color: #be185d;">à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”</span>
Â  Â  </div>
</div>
<div class="card" style="border-left: 5px solid #10b981;">
        <div class="grid-2" style="margin-bottom:10px; grid-template-columns: 1fr;">
            <select id="hairStyle">
                <option value="">-- à¹€à¸¥à¸·à¸­à¸à¸—à¸£à¸‡à¸œà¸¡ --</option>
                <option value="à¹€à¸”à¹‡à¸">ğŸ‘¶ à¸•à¸±à¸”à¸œà¸¡à¹€à¸”à¹‡à¸</option>
                <option>à¸£à¸­à¸‡à¸—à¸£à¸‡</option><option>à¹à¸Ÿà¸Šà¸±à¹ˆà¸™</option><option>à¸ªà¸à¸´à¸™à¹€à¸Ÿà¸”</option>
                <option>à¹€à¸›à¸´à¸”à¸‚à¹‰à¸²à¸‡</option><option>à¸•à¸³à¸£à¸§à¸ˆ/à¸—à¸«à¸²à¸£</option><option>à¸—à¸£à¸‡à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™<option>à¹à¸à¹‰à¸œà¸¡<option>à¹‚à¸à¸™à¸œà¸¡</option>
            </select>
        </div>
        <div class="grid-2">
            <select id="extra1"><option value="">à¸šà¸£à¸´à¸à¸²à¸£à¸­à¸·à¹ˆà¸™ 1</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡<option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡<option>à¸”à¸±à¸”à¸œà¸¡</option></select>
            <select id="extra2"><option value="">à¸šà¸£à¸´à¸à¸²à¸£à¸­à¸·à¹ˆà¸™ 2</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡<option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡<option>à¸”à¸±à¸”à¸œà¸¡</option></select>
        </div>
    </div>

    <div class="card" style="border-left: 5px solid #f59e0b;">
        <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="font-size:40px; font-weight:600; color:#b45309; text-align:center; height:80px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 8px; margin-top: 15px;">
            <button id="btnCash" class="btn-pay" onclick="selectPay('Cash')">à¸ªà¸”</button>
            <button id="btnTrans" class="btn-pay" onclick="selectPay('Trans')">à¹‚à¸­à¸™</button>
            <button class="btn-save" id="mainSaveBtn" onclick="handleSave()" style="margin:0; font-size:16px;">à¸šà¸±à¸™à¸—à¸¶à¸</button>
        </div>
    </div>
</div>
<div id="p2" class="page">
    <div class="grid-2">
        <div class="card" style="text-align: center;">
            <label>à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¸£à¸§à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰</label>
            <div id="dTotal" style="font-size:28px; font-weight:600">0</div>
            <div id="dCounts" style="font-size:18px; font-weight:600; color:var(--primary); margin-top:5px;">à¸¥à¸¹à¸à¸„à¹‰à¸²: 0 à¸„à¸™</div>
        </div>
        <div class="card">
            <div style="font-size:16px; font-weight:600; margin-bottom:6px;">ğŸ“± à¹‚à¸­à¸™: <b id="dTrans">0</b></div>
            <div style="font-size:16px; font-weight:600; margin-bottom:6px;">ğŸ¤µ à¸Šà¹ˆà¸²à¸‡: <b id="dBarber">0</b></div>
            <div style="font-size:16px; font-weight:600;">ğŸ  à¸£à¹‰à¸²à¸™: <b id="dShop">0</b></div>
        </div>
    </div>

    <div style="display: flex; gap: 8px; align-items: center; margin: 10px 0;">
        <div id="settleBar" class="status-bar status-blue" style="margin:0; flex: 1;">à¸¢à¸­à¸”à¸à¸­à¸”à¸µ</div>
        <button class="btn-plane" onclick="closeDay()">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <label>à¸£à¸²à¸¢à¸à¸²à¸£à¸§à¸±à¸™à¸™à¸µà¹‰</label>
            <i class="fab fa-line" style="color:#06C755; font-size:24px; cursor:pointer;" onclick="shareLine()"></i>
        </div>
        <div id="dServiceStats" style="margin-bottom:15px;"></div>
        <div id="dailyList"></div>
    </div>
</div>
<div id="p3" class="page">
Â  Â  <div class="acc-main-card">
Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center;">
Â  Â  Â  Â  Â  Â  <h3 style="margin:0; font-size:15px; color:#b45309;">ğŸ§¾ à¸ªà¸£à¸¸à¸›à¸¢à¸­à¸”à¸šà¸±à¸à¸Šà¸µà¸ªà¸¸à¸—à¸˜à¸´</h3>
Â  Â  Â  Â  Â  Â  <div id="accLight" class="acc-light" style="background:gray;"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="font-size:11px; color:#64748b; margin:12px 0; line-height:1.6; background:rgba(0,0,0,0.03); padding:10px; border-radius:12px;">
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between;">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="accOldText">à¸¢à¸­à¸”à¸„à¹‰à¸²à¸‡à¹€à¸”à¸´à¸¡:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <b id="accOldVal">à¸¿0</b>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between;">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="accTodayText">à¸¢à¸­à¸”à¸§à¸±à¸™à¸™à¸µà¹‰:</span>
Â  Â  Â  Â  Â  Â  Â  Â  <b id="accTodayVal">à¸¿0</b>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="text-align:center; margin:15px 0;">
Â  Â  Â  Â  Â  Â  <div style="font-size:38px; font-weight:800; color:#1e3a8a;">
Â  Â  Â  Â  Â  Â  Â  Â  <small style="font-size:18px; font-weight:400; opacity:0.5;">à¸¿</small><span id="accNet">0</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="accStatus" class="status-bar" style="margin:10px 0; text-align:center;">à¸à¸³à¸¥à¸±à¸‡à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...</div>

Â  Â  Â  Â  <button class="btn-toggle-history" onclick="toggleAccHistory()">
Â  Â  Â  Â  Â  Â  <i class="fas fa-history"></i> <span id="toggleText">à¸”à¸¹à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™</span>
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <div id="accHistoryWrapper" class="history-wrapper">
Â  Â  Â  Â  Â  Â  <div id="accHistory" class="history-list"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <hr style="opacity:0.05; margin:15px 0;">

Â  Â  Â  Â  <label style="font-size:12px; color:#64748b;">à¸£à¸°à¸šà¸¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</label>
Â  Â  Â  Â  <input type="date" id="accDate" style="height:40px; margin-bottom:10px;">
Â  Â  Â  Â  <input type="text" id="accNote" placeholder="à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ" style="height:40px; margin-bottom:10px;">
Â  Â  Â  Â  <button class="btn-save" onclick="clearAccount()" style="margin:0; padding:15px; background:var(--accent);">âœ… à¸¢à¸·à¸™à¸¢à¸±à¸™à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢</button>
Â  Â  </div>
<div class="stats-grid">
    <button class="btn-toggle-history" onclick="toggleAccordion('dailyAcc')">
        <i class="fas fa-calendar-day"></i> à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸£à¸²à¸¢à¸§à¸±à¸™
    </button>
    <button class="btn-toggle-history" onclick="toggleAccordion('monthlyAcc')">
        <i class="fas fa-chart-line"></i> à¸ªà¸–à¸´à¸•à¸´à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™
    </button>
</div>

<div id="dailyAcc" class="accordion-content">
    <label style="font-size:12px; color:var(--primary); font-weight:600;">ğŸ“… à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸”à¸¹</label>
    <input type="date" id="histDate" onchange="loadHistDaily()" style="margin-top:5px;">
    <div id="histDailyArea" style="margin-top:10px;"></div>
</div>

<div id="monthlyAcc" class="accordion-content">
    <label style="font-size:12px; color:var(--warning); font-weight:600;">ğŸ“Š à¹€à¸¥à¸·à¸­à¸à¹€à¸”à¸·à¸­à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¸£à¸¸à¸›</label>
    <input type="month" id="histMonth" onchange="loadHistMonth()" style="margin-top:5px;">
    <div id="histMonthArea" style="margin-top:10px;"></div>
</div>
Â  Â  
<div id="historyPanel" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:10000; align-items:flex-end;">
Â  Â  <div style="background:var(--card); width:100%; border-radius:25px 25px 0 0; padding:20px; max-height:85vh; overflow-y:auto; animation: slideUp 0.3s ease-out; box-shadow: 0 -10px 25px rgba(0,0,0,0.2);">
Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:2px solid rgba(0,0,0,0.05); padding-bottom:15px;">
Â  Â  Â  Â  Â  Â  <h3 style="margin:0; font-size:18px;"><i class="fas fa-history"></i> à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™</h3>
Â  Â  Â  Â  Â  Â  <button onclick="closeHistoryFull()" style="background:#f1f5f9; border:none; padding:10px 20px; border-radius:12px; font-weight:bold; color:var(--danger);">à¸›à¸´à¸”</button></div>
Â  Â  Â  Â  <div id="accHistoryFull"></div>
Â  Â  </div>
</div>

Â  Â  <style>
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
/* à¸›à¸£à¸±à¸šà¸ªà¹„à¸•à¸¥à¹Œà¸›à¸¸à¹ˆà¸¡à¸”à¸¹à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¹ƒà¸™ Card à¹ƒà¸«à¹‰à¹€à¸”à¹ˆà¸™à¸‚à¸¶à¹‰à¸™ */
.btn-toggle-history { width: 100%; padding: 12px; border-radius: 12px; border: 1px dashed var(--primary); background: #f0f7ff; color: var(--primary); cursor: pointer; font-family: 'Kanit'; }
</style>

Â  Â  <div id="modalSet" class="modal"><div class="modal-content"><h3>âš™ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</h3><label>à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™</label><input id="setShop">
<div class="grid-2" style="margin-top:10px"><div><label>% à¹à¸šà¹ˆà¸‡</label><input type="number" id="setPerc"></div><div><label>à¸›à¸£à¸°à¸à¸±à¸™</label><input type="number" id="setGuar"></div></div>
<div class="grid-2" style="margin-top:15px"><div><label>ğŸ”Š à¹€à¸ªà¸µà¸¢à¸‡</label><select id="setSound"><option value="on">à¹€à¸›à¸´à¸”</option><option value="off">à¸›à¸´à¸”</option></select></div><div><label>ğŸšï¸ à¹€à¸ªà¸µà¸¢à¸‡à¸à¸¹à¸”</label><select id="setVoice"><option value="female">ğŸ‘© à¸«à¸à¸´à¸‡</option><option value="male">ğŸ‘¨ à¸Šà¸²à¸¢</option></select></div></div>
<label style="margin-top:15px">à¸˜à¸µà¸¡</label><select id="setTheme" onchange="changeTheme(this.value)"><option value="light">Light</option><option value="dark">Dark</option><option value="pastel">Pastel</option></select>
<div style="margin-top:10px"><label>à¹€à¸¥à¸·à¸­à¸à¸ªà¸µà¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡ (7 à¸ªà¸µ)</label><br>
Â  Â  <div class="color-dot" style="background:#fdf2f8" onclick="setBg('#fdf2f8')"></div><div class="color-dot" style="background:#f0fdf4" onclick="setBg('#f0fdf4')"></div><div class="color-dot" style="background:#f0f9ff" onclick="setBg('#f0f9ff')"></div><div class="color-dot" style="background:#fffbeb" onclick="setBg('#fffbeb')"></div><div class="color-dot" style="background:#faf5ff" onclick="setBg('#faf5ff')"></div><div class="color-dot" style="background:#f1f5f9" onclick="setBg('#f1f5f9')"></div><div class="color-dot" style="background:#ffffff; border:1px solid #ccc" onclick="setBg('#ffffff')"></div>
</div>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;"><button class="btn-save" onclick="saveSettings()" style="margin:0">à¸šà¸±à¸™à¸—à¸¶à¸</button><button onclick="closeSettings()" style="border-radius:10px; border: 1px solid var(--border)">à¸›à¸´à¸”</button></div>
<button onclick="clearAllData()" style="width:100%; background:none; border:none; color:red; margin-top:20px; font-size:12px; opacity:0.5">à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button></div></div>

<nav class="nav"><div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>à¸šà¸±à¸™à¸—à¸¶à¸</div><div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-calendar-check"></i>à¸£à¸²à¸¢à¸§à¸±à¸™</div><div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-history"></i>à¸ªà¸–à¸´à¸•à¸´</div></nav>

<script>
let payMethod="", 
        conf=JSON.parse(localStorage.getItem("barber_conf"))||{shop:"Barber Shop",perc:50,guar:0,theme:"light",bg:"#f1f5f9",sound:"on",voice:"female"}, 
        db=JSON.parse(localStorage.getItem("barber_db"))||[], 
        archives=JSON.parse(localStorage.getItem("barber_arc"))||[],
        account=JSON.parse(localStorage.getItem("barber_account"))||{balance:0, logs:[]};

    const $=(id)=>document.getElementById(id);
    
    window.onload=()=>{ 
        $("dateInp").valueAsDate=new Date(); 
        updateDateDisplay($("dateInp").value);
        applySettings(); 
    };
    
    function speak(t){ if(conf.sound==="off")return; window.speechSynthesis.cancel(); const m=new SpeechSynthesisUtterance(t); m.lang='th-TH'; m.pitch=conf.voice==="male"?0.6:1.1; window.speechSynthesis.speak(m); }
    
    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ˆà¸±à¸”à¸à¸²à¸£à¹€à¸§à¸¥à¸² 0900 -> 09:00
    document.querySelectorAll('.time-input').forEach(i=>i.addEventListener('input',e=>{ 
        let v=e.target.value.replace(/\D/g,''); 
        if(v.length>=4) e.target.value=v.substring(0,2)+":"+v.substring(2,4); 
    }));

    function go(n){ 
        document.querySelectorAll('.page, .nav-item').forEach(el=>el.classList.remove('active')); 
        $("p"+n).classList.add('active'); 
        $("n"+n).classList.add('active'); 
        if(n===2) renderDay(); 
        if(n===3) { loadAccountStatus(); loadAccountHistory(); }
    }

    function selectPay(m){ payMethod=m; $("btnCash").className=m==='Cash'?'btn-pay active-cash':'btn-pay'; $("btnTrans").className=m==='Trans'?'btn-pay active-transfer':'btn-pay'; }

    // --- à¸£à¸°à¸šà¸š à¸¢à¸·à¸”/à¸«à¸” à¸«à¸™à¹‰à¸² 3 ---
    function toggleAccordion(id) {
        const daily = $("dailyAcc");
        const monthly = $("monthlyAcc");
        if (id === 'dailyAcc') {
            daily.style.display = (daily.style.display === 'block') ? 'none' : 'block';
            monthly.style.display = 'none';
        } else {
            monthly.style.display = (monthly.style.display === 'block') ? 'none' : 'block';
            daily.style.display = 'none';
        }
    }

    // --- à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Logic à¹ƒà¸«à¸¡à¹ˆ à¸•à¸±à¸” mainSvc) ---
    function handleSave(){
        const p=$("priceInp").value; 
        const hair=$("hairStyle").value;
        const ex1=$("extra1").value;
        const ex2=$("extra2").value;

        if(!hair && !ex1 && !ex2){ speak("à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸šà¸£à¸´à¸à¸²à¸£"); return; }
        if(!p||!payMethod){ speak("à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸£à¸²à¸„à¸²à¹à¸¥à¸°à¸§à¸´à¸˜à¸µà¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™"); return; }

        // à¸£à¸§à¸¡à¸Šà¸·à¹ˆà¸­à¸šà¸£à¸´à¸à¸²à¸£ (à¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¹€à¸”à¹‡à¸ à¹ƒà¸«à¹‰à¸–à¸·à¸­à¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¸—à¸£à¸‡à¸œà¸¡à¸«à¸¥à¸±à¸)
        let svcs = [hair, ex1, ex2].filter(s => s !== "");
        
        db.push({
            id: Date.now(),
            date: $("dateInp").value,
            time: `${$("tStart").value || '00:00'}-${$("tEnd").value || '00:00'}`,
            svcs: svcs,
            hair: hair, // à¹€à¸à¹‡à¸šà¹„à¸§à¹‰à¹€à¸Šà¹‡à¸„à¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¹€à¸”à¹‡à¸à¸«à¸£à¸·à¸­à¸—à¸£à¸‡à¸­à¸°à¹„à¸£
            price: Number(p),
            pay: payMethod
        });

        localStorage.setItem("barber_db", JSON.stringify(db)); 
        speak("à¸šà¸±à¸™à¸—à¸¶à¸ " + p + " à¸šà¸²à¸— à¸ªà¸³à¹€à¸£à¹‡à¸ˆ");
        
        // à¹€à¸­à¸Ÿà¹€à¸Ÿà¸à¸•à¹Œà¸›à¸¸à¹ˆà¸¡à¸šà¸±à¸™à¸—à¸¶à¸
        $("mainSaveBtn").innerText="à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§ âœ“"; 
        $("mainSaveBtn").style.background="var(--accent)";
        
        setTimeout(()=>{ 
            $("mainSaveBtn").innerText="à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥"; 
            $("mainSaveBtn").style.background="var(--primary)"; 
            $("priceInp").value=""; 
            if($("tEnd").value){ $("tStart").value=$("tEnd").value; $("tEnd").value=""; } 
            $("extra1").value=$("extra2").value=$("hairStyle").value=""; 
            selectPay(""); 
        }, 600);
    }

    function renderDay(){
        const d=$("dateInp").value, today=db.filter(r=>r.date===d); 
        let tot=0,trans=0,cash=0,stats={},listHtml="";
        
        today.sort((a,b)=>a.time.localeCompare(b.time)).forEach(r=>{
            tot+=r.price; 
            r.pay==='Trans' ? trans+=r.price : cash+=r.price; 
            
            // à¸™à¸±à¸šà¸ªà¸–à¸´à¸•à¸´: à¸–à¹‰à¸² hair à¹€à¸›à¹‡à¸™à¹€à¸”à¹‡à¸ à¹ƒà¸«à¹‰à¸™à¸±à¸šà¸—à¸±à¹‰à¸‡à¹€à¸”à¹‡à¸à¹à¸¥à¸°à¸•à¸±à¸”à¸œà¸¡
            if(r.hair === "à¹€à¸”à¹‡à¸") {
                stats["à¹€à¸”à¹‡à¸"] = (stats["à¹€à¸”à¹‡à¸"] || 0) + 1;
                stats["à¸•à¸±à¸”à¸œà¸¡"] = (stats["à¸•à¸±à¸”à¸œà¸¡"] || 0) + 1;
            } else if(r.hair) {
                stats["à¸•à¸±à¸”à¸œà¸¡"] = (stats["à¸•à¸±à¸”à¸œà¸¡"] || 0) + 1;
            }

            // à¸™à¸±à¸šà¸šà¸£à¸´à¸à¸²à¸£à¹€à¸ªà¸£à¸´à¸¡à¸­à¸·à¹ˆà¸™à¹†
            r.svcs.forEach(s => { 
                if(s !== r.hair) stats[s] = (stats[s] || 0) + 1; 
            });

            listHtml += `<div class="history-row"><div style="display:flex; justify-content:space-between"><span>${r.time} | ${r.svcs.join('+')}</span><b>à¸¿${r.price}</b></div><div style="display:flex; justify-content:space-between; opacity:0.7"><span></span><span>${r.pay==='Cash'?'ğŸ’µ à¸ªà¸”':'ğŸ“± à¹‚à¸­à¸™'} <i class="fas fa-trash" style="margin-left:10px; color:var(--danger)" onclick="delRec(${r.id})"></i></span></div></div>`;
        });

        const bEarn=Math.max(tot*(conf.perc/100),conf.guar), sEarn=tot-bEarn, settle=cash-bEarn;
        $("dTotal").innerText=tot.toLocaleString(); 
        $("dTrans").innerText=trans.toLocaleString(); 
        $("dBarber").innerHTML=`${Math.floor(bEarn).toLocaleString()} <small>(à¸ªà¸”: ${cash})</small>`; 
        $("dShop").innerText=Math.floor(sEarn).toLocaleString(); 
        $("dCounts").innerText=`à¸¥à¸¹à¸à¸„à¹‰à¸²: ${today.length} à¸„à¸™`; 
        $("dailyList").innerHTML=listHtml||"<center style='opacity:0.3; padding:20px'>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>";
        
        // à¹à¸ªà¸”à¸‡ Badge à¸ªà¸–à¸´à¸•à¸´
        let sH=""; 
        if(stats["à¸•à¸±à¸”à¸œà¸¡"]) sH += `<span class="badge" style="background:#4338ca; color:white;">à¸•à¸±à¸”à¸œà¸¡: ${stats["à¸•à¸±à¸”à¸œà¸¡"]}</span>`;
        for(let s in stats) { if(s !== "à¸•à¸±à¸”à¸œà¸¡") sH += `<span class="badge">${s}: ${stats[s]}</span>`; }
        $("dServiceStats").innerHTML=sH;

        const b=$("settleBar"); 
        if(tot===0){ b.innerText="ğŸŸ¦ à¸£à¹‰à¸²à¸™à¸ˆà¹ˆà¸²à¸¢à¸›à¸£à¸°à¸à¸±à¸™"; b.className="status-bar status-blue"; } 
        else if(settle>0){ b.innerText=`ğŸŸ¥ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™ à¸¿${Math.floor(settle).toLocaleString()}`; b.className="status-bar status-red"; } 
        else if(settle<0){ b.innerText=`ğŸŸ¦ à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡ à¸¿${Math.floor(Math.abs(settle)).toLocaleString()}`; b.className="status-bar status-indigo"; } 
        else { b.innerText="âœ… à¸¢à¸­à¸”à¸à¸­à¸”à¸µ"; b.className="status-bar status-green"; }
    }

    function calcTodaySettle(){
        const d = $("dateInp").value;
        const today = db.filter(r=>r.date===d);
        if(!today.length) return 0;
        const tot = today.reduce((a,b)=>a+b.price,0);
        const cash = today.filter(r=>r.pay==='Cash').reduce((a,b)=>a+b.price,0);
        const bEarn = Math.max(tot*(conf.perc/100), conf.guar);
        return cash - bEarn;
    }

    function closeDay() {
        const d = $("dateInp").value;
        const today = db.filter(r => r.date === d);
        if(!today.length) return alert("à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸ˆà¸°à¸ªà¹ˆà¸‡");
        if(confirm("à¸›à¸´à¸”à¸¢à¸­à¸”à¸§à¸±à¸™à¸™à¸µà¹‰à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¹„à¸›à¸«à¸™à¹‰à¸²à¸ªà¸–à¸´à¸•à¸´?")) {
            const tot = today.reduce((a,b) => a+b.price, 0);
            const cash = today.filter(r=>r.pay==='Cash').reduce((a,b)=>a+b.price, 0);
            const bEarn = Math.max(tot * (conf.perc/100), conf.guar);
            
            let dailyStats = {};
            today.forEach(r => { 
                r.svcs.forEach(s => { dailyStats[s] = (dailyStats[s] || 0) + 1; });
                if(r.hair === "à¹€à¸”à¹‡à¸") dailyStats["à¸•à¸±à¸”à¸œà¸¡"] = (dailyStats["à¸•à¸±à¸”à¸œà¸¡"] || 0) + 1;
                else if(r.hair) dailyStats["à¸•à¸±à¸”à¸œà¸¡"] = (dailyStats["à¸•à¸±à¸”à¸œà¸¡"] || 0) + 1;
            }); 

            archives = archives.filter(a => a.date !== d);
            archives.push({date: d, total: tot, cash: cash, barber: bEarn, shop: tot-bEarn, settle: cash-bEarn, count: today.length, details: today, stats: dailyStats});
            
            account.balance = (account.balance || 0) + (cash - bEarn);
            localStorage.setItem("barber_account", JSON.stringify(account));
            localStorage.setItem("barber_arc", JSON.stringify(archives));
            db = db.filter(r => r.date !== d);
            localStorage.setItem("barber_db", JSON.stringify(db));
            
            speak("à¸›à¸´à¸”à¸¢à¸­à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ"); go(3);
        }
    }

    function loadAccountStatus() {
        const todaySettle = calcTodaySettle();
        const oldBal = account.balance || 0;
        const net = oldBal + todaySettle;
        const dStr = $("dateInp").value;
        const dObj = new Date(dStr);
        const dateThai = `${dObj.getDate()}/${dObj.getMonth()+1}/${(dObj.getFullYear()+543).toString().slice(-2)}`;

        $("accOldVal").innerText = `à¸¿${oldBal.toLocaleString()}`;
        $("accTodayVal").innerText = `à¸¿${todaySettle.toLocaleString()}`;
        $("accNet").innerText = Math.abs(net).toLocaleString();

        let txt="âœ… à¸¢à¸­à¸”à¸à¸­à¸”à¸µ", cls="status-green", light="#16a34a";
        if(net>0){ txt=`ğŸš© à¸„à¹‰à¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™ à¸¿${Math.abs(net).toLocaleString()}`; cls="status-red"; light="#dc2626"; }
        else if(net<0){ txt=`ğŸš© à¸„à¹‰à¸²à¸‡à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡ à¸¿${Math.abs(net).toLocaleString()}`; cls="status-indigo"; light="#1e3a8a"; }

        $("accStatus").innerText = txt;
        $("accStatus").className = "status-bar "+cls;
        $("accLight").style.background = light;
    }

    function clearAccount(){
        const d = $("accDate").value; if(!d) return alert("à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ");
        const net = (account.balance || 0) + calcTodaySettle();
        account.logs.unshift({ date: d, amount: net, note: $("accNote").value || "à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸¢à¸­à¸”à¸ªà¸°à¸ªà¸¡" });
        account.balance = 0 - calcTodaySettle();
        localStorage.setItem("barber_account",JSON.stringify(account));
        speak("à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"); 
        $("accNote").value = ""; 
        loadAccountHistory(); loadAccountStatus();
    }

    function loadAccountHistory(){
        const box = $("accHistory");
        if(!account.logs.length){ box.innerHTML = "<center style='opacity:.4; padding:20px;'>à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´</center>"; return; }
        box.innerHTML = account.logs.slice(0,10).map(l=>`<div class="history-row" style="padding:8px 0; border-bottom:1px dashed #ddd;"><b>${l.date}</b> | à¸¿${Math.abs(l.amount).toLocaleString()}<div style="font-size:10px; opacity:.6">${l.note}</div></div>`).join("");
    }

    function toggleAccHistory() {
        $("historyPanel").style.display = "flex";
        const box = $("accHistoryFull");
        if(!account.logs.length){
            box.innerHTML = "<center style='opacity:.4; padding:50px;'>à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™</center>";
            return;
        }
        box.innerHTML = account.logs.map(l => `
            <div style="padding:15px; border-bottom:1px solid rgba(0,0,0,0.05); margin-bottom:12px; background:var(--input-bg); border-radius:15px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <b style="font-size:15px;">ğŸ“… ${l.date}</b>
                    <b style="font-size:18px; color:var(--accent);">à¸¿${Math.abs(l.amount).toLocaleString()}</b>
                </div>
                <div style="font-size:12px; color:#64748b; margin-top:8px;">${l.note || "à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸¢à¸­à¸”à¸ªà¸°à¸ªà¸¡"}</div>
            </div>
        `).join("");
    }

    function loadHistDaily() {
        const d = $("histDate").value; const found = archives.find(a => a.date === d); area = $("histDailyArea"); 
        if(!found) { area.innerHTML = "<center style='color:#ccc; padding:20px;'>à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>"; return; }
        let rows = found.details.map(r => `<div class="history-row" style="font-size:13px;"><div style="display:flex; justify-content:space-between"><b>${r.time} | ${r.svcs.join('+')}</b> <b>à¸¿${r.price}</b></div><div style="font-size:11px; opacity:0.6">${r.pay==='Cash'?'à¹€à¸‡à¸´à¸™à¸ªà¸”':'à¹‚à¸­à¸™'}</div></div>`).join('');
        let statBadges = ""; for(let s in found.stats) { statBadges += `<span class="badge" style="background:#eee; color:#333;">${s}: ${found.stats[s]}</span>`; }
        area.innerHTML = `<div style="background:var(--input-bg); padding:10px; border-radius:15px;"><div style="display:grid; grid-template-columns:1fr 1fr; gap:5px; margin-bottom:10px; font-size:12px;"><div>à¸¢à¸­à¸”: ${found.total}</div><div>à¸ªà¸”: ${found.cash}</div></div><div style="display:flex; flex-wrap:wrap; gap:3px; margin-bottom:10px;">${statBadges}</div><div style="border-top:1px dashed #ccc; padding-top:5px;">${rows}</div></div>`;
    }

    function loadHistMonth() {
        const m = $("histMonth").value; const area = $("histMonthArea"); if(!m) return;
        const filtered = archives.filter(a => a.date.startsWith(m));
        if(!filtered.length) { area.innerHTML = "<center style='color:#ccc; padding:20px;'>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>"; return; }
        let mT=0, mB=0, mC=0, mStats={};
        filtered.forEach(a => { mT+=a.total; mB+=a.barber; mC+=a.count; for(let s in a.stats) mStats[s]=(mStats[s]||0)+a.stats[s]; });
        let sB=""; for(let s in mStats) sB+=`<span class="badge">${s}: ${mStats[s]}</span>`;
        area.innerHTML = `<div style="padding:15px; background:var(--input-bg); border-radius:15px;">
            <div style="font-size:18px; font-weight:700; color:var(--primary);">à¸¿${mT.toLocaleString()}</div>
            <div style="font-size:12px; margin-bottom:10px;">à¸Šà¹ˆà¸²à¸‡: ${Math.floor(mB).toLocaleString()} | à¸£à¹‰à¸²à¸™: ${Math.floor(mT-mB).toLocaleString()}</div>
            <div style="font-size:12px; opacity:0.7;">à¸¥à¸¹à¸à¸„à¹‰à¸²: ${mC} à¸„à¸™ | à¸—à¸³à¸‡à¸²à¸™: ${filtered.length} à¸§à¸±à¸™</div>
            <div style="margin-top:10px;">${sB}</div>
        </div>`;
    }

    function shareLine() {
        const d = $("dateInp").value, today = db.filter(r => r.date === d); if (!today.length) return;
        let tot = 0, trans = 0, cash = 0;
        let msg = `ğŸ’ˆ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸£à¹‰à¸²à¸™: ${conf.shop}\nğŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆ: ${d}\n-------------------------\n`;
        today.forEach((r, i) => { 
            tot += r.price; r.pay === 'Trans' ? trans += r.price : cash += r.price;
            msg += `${i + 1}. [${r.time}] ${r.svcs.join('+')} = ${r.price}\n`;
        });
        const bE = Math.max(tot * (conf.perc / 100), conf.guar), settle = Math.floor(cash - bE);
        msg += `-------------------------\nğŸ’° à¸¢à¸­à¸”à¸£à¸§à¸¡: ${tot}\nğŸ¤µ à¸Šà¹ˆà¸²à¸‡: ${Math.floor(bE)}\nğŸ  à¸£à¹‰à¸²à¸™: ${Math.floor(tot - bE)}\n-------------------------\n`;
        msg += settle >= 0 ? `ğŸš© à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™: ${settle}` : `ğŸš© à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡: ${Math.abs(settle)}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }

    function updateDateDisplay(val) {
        if(!val) return;
        const d = new Date(val);
        const months = ["à¸¡.à¸„.","à¸.à¸.","à¸¡à¸µ.à¸„.","à¹€à¸¡.à¸¢.","à¸.à¸„.","à¸¡à¸´.à¸¢.","à¸.à¸„.","à¸ª.à¸„.","à¸.à¸¢.","à¸•.à¸„.","à¸.à¸¢.","à¸˜.à¸„."];
        $('dateDisplay').innerText = d.getDate() + " " + months[d.getMonth()];
    }

    function delRec(id) { if(confirm("à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸™à¸µà¹‰?")) { db = db.filter(r => r.id !== id); localStorage.setItem("barber_db", JSON.stringify(db)); speak("à¸¥à¸šà¹à¸¥à¹‰à¸§"); renderDay(); } }
    function closeHistoryFull() { $("historyPanel").style.display = "none"; }
    function openSettings(){ $("modalSet").style.display="flex"; $("setShop").value=conf.shop; $("setPerc").value=conf.perc; $("setGuar").value=conf.guar; $("setTheme").value=conf.theme; $("setSound").value=conf.sound; $("setVoice").value=conf.voice; }
    function closeSettings(){ $("modalSet").style.display="none"; }
    function setBg(c){ conf.bg=c; applySettings(); }
    function changeTheme(v){ conf.theme=v; applySettings(); }
    function saveSettings(){ conf.shop=$("setShop").value; conf.perc=Number($("setPerc").value); conf.guar=Number($("setGuar").value); conf.theme=$("setTheme").value; conf.sound=$("setSound").value; conf.voice=$("setVoice").value; localStorage.setItem("barber_conf",JSON.stringify(conf)); applySettings(); closeSettings(); speak("à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§"); }
    function applySettings(){ $("shopNameDisp").innerText=conf.shop; $("mainBody").className="theme-"+conf.theme; $("mainBody").style.backgroundColor=conf.bg; }
    function clearAllData(){ if(confirm("à¸¥à¹‰à¸²à¸‡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”?")){ localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
    
