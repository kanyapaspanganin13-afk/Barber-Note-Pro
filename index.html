<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.2.1.1</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; }
        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }
        .container { padding: 10px; max-width: 500px; margin: auto; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
        .icon-card { position: relative; border-radius: 12px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1.5px solid transparent; }
        .icon-card span:first-child { font-size: 18px; }
        .icon-card span:last-child { font-size: 10px; font-weight: 800; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 12px; font-size: 14px; background: #f1f5f9; outline: none; }
        .price-box { font-size: 40px; font-weight: bold; text-align: center; color: var(--primary); padding: 10px; border: 2px solid var(--primary); border-radius: 15px; margin-bottom: 15px; width: 100%; background: #fff; display: block; }
        .btn { border: none; padding: 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 600; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-pay { background: #e2e8f0; color: #64748b; border: 2px solid transparent; }
        .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
        .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }
        .btn-main { background: var(--primary); color: white; width: 100%; font-size: 28px; height: 60px; }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-item { border: none; background: none; color: #94a3b8; font-size: 11px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 22px; }
        .page { display: none; } .page.active { display: block; }
        .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 14px; }
        .status-red { background: #fee2e2; color: #dc2626; }
        .status-indigo { background: #e0e7ff; color: #3730a3; }
        .status-green { background: #dcfce7; color: #16a34a; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 8px; font-size: 11px; margin: 2px; background: #eee; }
        .history-row { padding: 10px; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal-content { background: #fff; padding: 20px; border-radius: 25px; width: 100%; max-width: 400px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
<div class="container">
    <h2 id="shopNameDisp" style="text-align:center; color:var(--primary); margin: 10px 0;">Barber Shop</h2>
    <div id="p1" class="page active">
        <div class="grid-3">
            <div class="icon-card" style="background: #fffbeb; border-color: #fde68a;" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤')">
                <span>üõ°Ô∏è</span><span style="color: #b45309;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span>
            </div>
            <div class="icon-card" style="background: #fff1f2; border-color: #fecdd3;" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤')">
                <span>üèñÔ∏è</span><span style="color: #be185d;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
            </div>
            <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1;" onclick="openSettings()">
                <span>‚öôÔ∏è</span><span style="color: #475569;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
            </div>
        </div>
        <div class="grid-3">
            <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1; padding: 5px;">
                <span id="dateDisplay" style="font-size: 10px; font-weight: 700;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                <input type="date" id="dateInp" onchange="updateDateDisplay(this.value)" style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer;">
            </div>
            <input type="text" id="tStart" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°" style="text-align:center;">
            <input type="text" id="tEnd" placeholder="‡πÄ‡∏™‡∏£‡πá‡∏à" style="text-align:center;">
        </div>
        <div class="grid-3">
            <select id="hairStyle">
                <option value="">üíá ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏°</option><option value="‡πÄ‡∏î‡πá‡∏Å">üë∂ ‡∏ï‡∏±‡∏î‡∏ú‡∏°‡πÄ‡∏î‡πá‡∏Å</option>
                <option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option></select>
            <select id="extra1">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô 1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option></select>
            <select id="extra2">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô 2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option></select>
        </div>
        <input type="number" id="priceInp" class="price-box" placeholder="0">
        <div class="grid-2">
            <button id="btnCash" class="btn btn-pay" onclick="selectPay('Cash')">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
            <button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">üì± ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button></div>
        <button id="mainSaveBtn" class="btn btn-main" onclick="handleSave()"><i class="fas fa-save"></i></button> </div>
        
<div id="p2" class="page">
    <div class="grid-2"><div class="card" style="text-align: center;"><label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label><div id="dTotal" style="font-size:28px; font-weight:600">0</div><div id="dCounts" style="font-size:18px; font-weight:600; color:var(--primary); margin-top:5px;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: 0 ‡∏Ñ‡∏ô</div></div>
    <div class="card"><div style="font-size:16px; font-weight:600; margin-bottom:6px;">üì± ‡πÇ‡∏≠‡∏ô: <b id="dTrans">0</b></div><div style="font-size:16px; font-weight:600; margin-bottom:6px;">ü§µ ‡∏ä‡πà‡∏≤‡∏á: <b id="dBarber">0</b></div><div style="font-size:16px; font-weight:600;">üè† ‡∏£‡πâ‡∏≤‡∏ô: <b id="dShop">0</b></div></div></div>
    <div id="settleBar" class="status-bar status-blue">‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ</div>
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;"><label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label><i class="fab fa-line" style="color:#06C755; font-size:24px; cursor:pointer;" onclick="shareLine()"></i></div>
        <div id="dServiceStats" style="margin-bottom:15px;"></div><div id="dailyList"></div>
    </div>
    <button class="btn-close-day" onclick="closeDay()"><i class="fas fa-check-circle"></i></button>
</div>


   <div id="p3" class="page">
        <div class="card" style="text-align:center">
            <span>‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
            <h1 id="accNet" style="color:var(--primary);margin:5px 0">‡∏ø0</h1>
            <div class="grid-2" style="font-size:12px;opacity:0.7">
                <div>‡πÄ‡∏î‡∏¥‡∏°: <b id="accOldVal">0</b></div>
                <div>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: <b id="accTodayVal">0</b></div>
            </div>
        </div>
        <div class="grid-2">
            <input id="accNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
            <button class="btn" style="background:var(--success);color:#fff" onclick="clearAccount()">‚úî ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î</button>
        </div>
        <div id="accountList"></div>
    </div>
</div>

<nav class="nav-bar">
    <button id="n1" class="nav-item active" onclick="go(1)"><i class="fas fa-cut"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button id="n2" class="nav-item" onclick="go(2)"><i class="fas fa-file-lines"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    <button id="n3" class="nav-item" onclick="go(3)"><i class="fas fa-wallet"></i>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
</nav>

<div id="modalSet" class="modal">
    <div class="modal-content">
        <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <label style="font-size:11px">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label>
        <input id="setShop">
        <div class="grid-2" style="margin-top:8px">
            <input type="number" id="setPerc" placeholder="% ‡∏ä‡πà‡∏≤‡∏á">
            <input type="number" id="setGuar" placeholder="‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏ß‡∏±‡∏ô">
        </div>
        <div style="margin-top:8px">
            <select id="setTheme">
                <option value="neon-light">üå§ Neon Light</option>
                <option value="deep-navy">üåå Deep Navy</option>
                <option value="barber-dark">üåë Barber Dark</option>
            </select>
        </div>
        <div class="grid-2" style="margin-top:8px">
            <select id="setSound"><option value="on">üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡∏¥‡∏î</option><option value="off">üîá ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏¥‡∏î</option></select>
            <select id="setVoiceGender"><option value="female">üë© ‡∏´‡∏ç‡∏¥‡∏á</option><option value="male">üë® ‡∏ä‡∏≤‡∏¢</option></select>
        </div>
        <div class="grid-2" style="margin-top:15px">
            <button class="btn" style="background:var(--primary);color:#fff" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button class="btn" style="background:#ccc" onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
        </div>
        <button class="btn" style="width:100%;background:var(--danger);color:#fff;margin-top:10px" onclick="clearAllData()">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
</div>
<div id="modalHistory" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <b>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</b>
            <button onclick="closeHistoryPopup()" style="border:none; background:none; font-size:24px;">&times;</button>
        </div>
        <div id="historyListContent" style="max-height:300px; overflow-y:auto;"></div>
    </div>
</div>

<script>
    let db=JSON.parse(localStorage.getItem("barber_db"))||[], 
        conf=JSON.parse(localStorage.getItem("barber_conf"))||{shop:"Barber Shop", perc:50, guar:0, sound:"on", voice:"female"},
        account=JSON.parse(localStorage.getItem("barber_account"))||{balance:0, logs:[]},
        payMethod="";

    const $=(id)=>document.getElementById(id);

    window.onload=()=>{ 
        const today = new Date().toISOString().split('T')[0];
        $("dateInp").value = today;
        $("accDateSearch").value = today;
        updateDateDisplay(today);
    };

    function go(n){
        document.querySelectorAll('.page, .nav-item').forEach((el,i)=>{
            if(el.id.startsWith('p')) el.classList.toggle('active', el.id==='p'+n);
            if(el.id.startsWith('n')) el.classList.toggle('active', el.id==='n'+n);
        });
        if(n===2 || n===3) renderDay();
    }

    function updateDateDisplay(val){ 
        if(!val)return; 
        const d=new Date(val); 
        $("dateDisplay").innerText = d.toLocaleDateString('th-TH',{day:'numeric',month:'short'}); 
        renderDay(); 
    }

    function selectPay(m){ 
        payMethod=m; 
        $("btnCash").className=m==='Cash'?'btn-pay active-cash':'btn-pay'; 
        $("btnTrans").className=m==='Trans'?'btn-pay active-trans':'btn-pay'; 
    }

    function handleSave(){
        const p=$("priceInp").value; 
        if(!p||!payMethod){ alert("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"); return; }
        const r = {
            id:Date.now(), 
            date:$("dateInp").value, 
            time:$("tStart").value||'--:--', 
            svcs:[$("hairStyle").value,$("extra1").value,$("extra2").value].filter(s=>s), 
            price:Number(p), 
            pay:payMethod,
            hair:$("hairStyle").value
        };
        db.push(r); 
        localStorage.setItem("barber_db", JSON.stringify(db));
        $("priceInp").value=""; selectPay(""); renderDay();
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
    }

    function renderDay(){
        const d=$("accDateSearch").value; // ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏î‡∏µ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏°‡∏≤‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
        const today=db.filter(r=>r.date===d); 
        let tot=0,trans=0,cash=0,stats={},listHtml="";

        today.forEach(r=>{
            tot+=r.price; 
            r.pay==='Trans' ? trans+=r.price : cash+=r.price; 
            r.svcs.forEach(s => { stats[s] = (stats[s] || 0) + 1; });
            listHtml += `<div class="history-row">
                <div style="display:flex; justify-content:space-between"><span>${r.time} | ${r.svcs.join('+')}</span><b>‡∏ø${r.price}</b></div>
                <div style="display:flex; justify-content:space-between; opacity:0.7; font-size:12px;">
                    <span>${r.pay==='Cash'?'üíµ ‡∏™‡∏î':'üì± ‡πÇ‡∏≠‡∏ô'}</span>
                    <i class="fas fa-trash" style="color:var(--danger)" onclick="delRec(${r.id})"></i>
                </div>
            </div>`;
        });

        const bEarn=Math.max(tot*(conf.perc/100),conf.guar);
        const settle=cash-bEarn;

        if($("dTotal")) $("dTotal").innerText=tot.toLocaleString();
        if($("dTrans")) $("dTrans").innerText=trans.toLocaleString();
        if($("dBarber")) $("dBarber").innerText=Math.floor(bEarn).toLocaleString();
        if($("dailyList")) $("dailyList").innerHTML=listHtml||"<center style='opacity:0.3; padding:20px'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";
        
        // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Badge
        let sH=""; for(let s in stats) { sH += `<span class="badge">${s}: ${stats[s]}</span>`; }
        if($("dServiceStats")) $("dServiceStats").innerHTML=sH;

        // ‡∏ö‡∏≤‡∏£‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const b=$("settleBar"); 
        if(b){
            if(tot===0) { b.innerText="üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"; b.className="status-bar status-indigo"; }
            else if(settle>0) { b.innerText=`üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle).toLocaleString()}`; b.className="status-bar status-red"; }
            else if(settle<0) { b.innerText=`üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}`; b.className="status-bar status-indigo"; }
            else { b.innerText="‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ"; b.className="status-bar status-green"; }
        }

        // ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
        $("accOldVal").innerText = (account.balance || 0).toLocaleString();
        $("accTodayVal").innerText = Math.floor(settle).toLocaleString();
        const net = (account.balance || 0) + settle;
        $("accNet").innerText = Math.abs(net).toLocaleString();
        $("accStatus").innerText = net > 0 ? "üö© ‡∏ä‡πà‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô" : net < 0 ? "üö© ‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏≤‡∏á" : "‚úÖ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏•‡∏á‡∏ï‡∏±‡∏ß";
        $("accStatus").className = "status-bar " + (net > 0 ? "status-red" : net < 0 ? "status-indigo" : "status-green");
    }

    function delRec(id){ if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")){ db=db.filter(r=>r.id!==id); localStorage.setItem("barber_db",JSON.stringify(db)); renderDay(); } }
    function openSettings(){ $("modalSet").style.display="flex"; $("setShop").value=conf.shop; $("setPerc").value=conf.perc; $("setGuar").value=conf.guar; }
    function closeSettings(){ $("modalSet").style.display="none"; }
    function saveSettings(){ 
        conf.shop=$("setShop").value; conf.perc=$("setPerc").value; conf.guar=$("setGuar").value; 
        localStorage.setItem("barber_conf",JSON.stringify(conf)); 
        $("shopNameDisp").innerText=conf.shop;
        closeSettings(); renderDay(); 
    }
    function clearAllData(){ if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£")){ localStorage.clear(); location.reload(); } }

    function openHistoryPopup(){ 
        $("modalHistory").style.display="flex"; 
        $("historyListContent").innerHTML = account.logs.map(l=>`<div class="history-row"><b>${l.date}</b> | ${l.amount.toLocaleString()} ‡∏ø<br><small>${l.note}</small></div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";
    }
    function closeHistoryPopup(){ $("modalHistory").style.display="none"; }

    function clearAccount(){
        const net = (account.balance || 0) + (Math.floor(parseFloat($("accTodayVal").innerText.replace(/,/g,''))));
        account.logs.unshift({date: new Date().toLocaleDateString('th-TH'), amount: net, note: $("accNote").value || "‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î"});
        account.balance = 0 - (Math.floor(parseFloat($("accTodayVal").innerText.replace(/,/g,''))));
        localStorage.setItem("barber_account", JSON.stringify(account));
        $("accNote").value=""; renderDay(); alert("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    }

    function shareLine() {
        const d = $("dateInp").value, today = db.filter(r => r.date === d); if (!today.length) return;
        let tot = 0, trans = 0, cash = 0, counts = {"‡∏ï‡∏±‡∏î‡∏ú‡∏°":0, "‡πÄ‡∏î‡πá‡∏Å":0, "‡∏™‡∏£‡∏∞‡∏ú‡∏°":0, "‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î":0, "‡∏≠‡∏∑‡πà‡∏ô":0};
        let msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô: ${conf.shop}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${d}\n------------------\nüìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:\n`;
        today.forEach((r, i) => {
            tot += r.price; r.pay === 'Trans' ? trans += r.price : cash += r.price;
            msg += `${i+1}. [${r.time}] ${r.svcs.join('+')} = ${r.price} ${r.pay==='Cash'?'üíµ':'üì±'}\n`;
            r.svcs.forEach(s => {
                if(s.includes("‡∏ï‡∏±‡∏î‡∏ú‡∏°")) counts["‡∏ï‡∏±‡∏î‡∏ú‡∏°"]++;
                else if(s.includes("‡πÄ‡∏î‡πá‡∏Å")) counts["‡πÄ‡∏î‡πá‡∏Å"]++;
                else if(s.includes("‡∏™‡∏£‡∏∞")) counts["‡∏™‡∏£‡∏∞‡∏ú‡∏°"]++;
                else if(s.includes("‡πÇ‡∏Å‡∏ô")) counts["‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î"]++;
                else counts["‡∏≠‡∏∑‡πà‡∏ô"]++;
            });
        });
        const bEarn = Math.max(tot * (conf.perc / 100), conf.guar);
        msg += `------------------\nüìä ‡∏™‡∏£‡∏∏‡∏õ:\n`;
        if(counts["‡∏ï‡∏±‡∏î‡∏ú‡∏°"]) msg += `üíá ‡∏ï‡∏±‡∏î‡∏ú‡∏°: ${counts["‡∏ï‡∏±‡∏î‡∏ú‡∏°"]}\n`;
        if(counts["‡πÄ‡∏î‡πá‡∏Å"]) msg += `üë∂ ‡πÄ‡∏î‡πá‡∏Å: ${counts["‡πÄ‡∏î‡πá‡∏Å"]}\n`;
        msg += `------------------\nüí∞ ‡∏£‡∏ß‡∏°: ${tot}\nüì± ‡πÇ‡∏≠‡∏ô: ${trans}\nü§µ ‡∏ä‡πà‡∏≤‡∏á: ${Math.floor(bEarn)}\nüè† ‡∏£‡πâ‡∏≤‡∏ô: ${Math.floor(tot-bEarn)}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
</script>
</body>
</html>
