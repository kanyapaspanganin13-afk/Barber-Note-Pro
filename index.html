<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BarberNote">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro V.02232 </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker.register("./service-worker.js")
                    .then(reg => console.log("‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô!"))
                    .catch(err => console.error("‚ùå SW error:", err));
            });
        }
    </script>
</head>
<style>
    /* 1. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å */
    :root { 
        --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; 
        --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0;
    }
    /* 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ò‡∏µ‡∏° (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£) */
    body.navy { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --accent: #38bdf8; }
    body.dark { --bg: #121212; --card: #1a1a1a; --text: #fbbf24; --accent: #fbbf24; }

    /* 3. ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
    * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { 
        margin: 0; background: var(--bg); color: var(--text); 
        padding-bottom: 90px; overflow-x: hidden; transition: all 0.3s ease; 
    }
   /* 4. ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á) */
.container { 
    padding: 15px; 
    max-width: 500px; 
    margin: auto; 
    position: relative; 
    z-index: 1; 
}
/* 4. ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏¢‡πå‡πÄ‡∏≠‡∏≤‡∏ï‡πå (‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢) */
.page { 
    display: none; 
    background: var(--card);
    opacity: 0.95; 
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    
    border-radius: 25px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid var(--border);

    /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
    min-height: 75vh;    
}

.page.active { 
    /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô block ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô/‡∏õ‡∏∏‡πà‡∏°) ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡∏°‡∏≤‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° */
    display: block; 
    animation: slideUp 0.4s ease-out;
}
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 8px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-bottom: 8px; }
/* 5. ‡πÄ‡∏°‡∏ô‡∏π‡∏ö‡∏≤‡∏£‡πå (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ò‡∏µ‡∏°) */
nav {
    position: fixed; bottom: 0; left: 0; right: 0;
    /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å #ffffff !important ‡πÄ‡∏õ‡πá‡∏ô var(--card) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏ò‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
    background: var(--card) !important; 
    display: flex; justify-content: space-around; 
    height: 75px; align-items: center;
    /* ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ò‡∏µ‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏°‡∏∑‡∏î */
    box-shadow: 0 -5px 20px rgba(0,0,0,0.15); 
    z-index: 99999; 
    /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡∏ò‡∏µ‡∏° */
    border-top: 1px solid var(--border); 
    padding-bottom: env(safe-area-inset-bottom);
    transition: background 0.3s ease; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡∏à‡∏∞‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏î‡∏π‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•‡∏Ñ‡∏£‡∏±‡∏ö */
}
.nav-item { 
    flex: 1; text-align: center; 
    /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏ò‡∏µ‡∏° ‡πÅ‡∏ï‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏à‡∏≤‡∏á‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
    color: var(--text);
    opacity: 0.6; 
    cursor: pointer; transition: 0.2s; 
    display: flex; flex-direction: column; align-items: center;
}
.nav-item.active { 
    /* ‡∏™‡∏µ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏µ Accent ‡∏Ç‡∏≠‡∏á‡∏ò‡∏µ‡∏°‡∏ô‡∏±‡πâ‡∏ô‡πÜ (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á) */
    color: var(--accent) !important; 
    opacity: 1; 
}
.nav-item i { font-size: 22px; display: block; margin-bottom: 2px; }
.nav-item span { font-size: 11px; font-weight: 700; }
    /* 6. ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï */
    .icon-card, input, select { background: var(--card); color: var(--text); }

    .icon-card { 
        border-radius: 15px; padding: 10px 2px; display: flex; flex-direction: column; 
        align-items: center; justify-content: center; gap: 4px; cursor: pointer; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); height: 75px; font-size: 14px; transition: 0.2s;
    }
    .icon-card:active { transform: scale(0.95); }

    input, select { 
        width: 100%; height: 75px; border-radius: 20px; font-size: 20px; font-weight: 700; 
        text-align: center; border: none; outline: none; box-shadow: 0 4px 10px rgba(0,0,0,0.03); 
        appearance: none; -webkit-appearance: none;
    }

    /* 7. ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ */
    .btn { 
        border: none; padding: 12px; border-radius: 15px; cursor: pointer; 
        display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.2s; 
    }
    .btn-save { background: var(--success); color: white; width: 100%; font-size: 16px; margin-top: 10px; }
    
    .btn-pay { background: #e2e8f0; color: #64748b; border: 2px solid transparent; height: 70px; font-size: 18px; width: 100%; }
    .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
    .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }

    /* 8. ‡πÇ‡∏°‡∏î‡∏≠‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô */
    .modal { 
        position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); 
        display: none; z-index: 1000000; align-items: center; justify-content: center; 
    }
    .modal-content { 
        background: var(--card); color: var(--text); width: 90%; max-width: 400px; 
        border-radius: 25px; padding: 25px; max-height: 85vh; overflow-y: auto; 
    }

    .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: 800; font-size: 14px; margin-bottom: 10px; }
    .acc-main-card { background: var(--card); padding: 20px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 15px; }
    #accHistory { font-size: 12px; max-height: 150px; overflow-y: auto; }
    @keyframes slideUp {
        from { transform: translateY(100%); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
</style>
</head>
<body>
<div class="container">
<div id="p1" class="page active" style="padding: 15px; background: #f8fafc;">
    <h2 id="shopNameDisp" style="text-align:center; color:#1e293b; font-weight:900; margin: 10px 0 20px 0; letter-spacing: 1px; text-transform: uppercase;">BARBER SHOP</h2>
    
    <div class="grid-3" style="gap: 12px; margin-bottom: 20px;">
        <div class="icon-card" style="background:#fff; border:none; box-shadow:0 8px 15px rgba(0,0,0,0.05); border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center;" onclick="handleInsurance()">
            <div style="background:linear-gradient(135deg, #fbbf24, #f59e0b); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                <i class="fas fa-shield-alt"></i>
            </div>
            <span style="color:#1e293b; font-weight:800; font-size:14px;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span>
        </div>
        
        <div class="icon-card" style="background:#fff; border:none; box-shadow:0 8px 15px rgba(0,0,0,0.05); border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center;" onclick="handleHoliday()">
            <div style="background:linear-gradient(135deg, #f87171, #ef4444); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                <i class="fas fa-umbrella-beach"></i>
            </div>
            <span style="color:#1e293b; font-weight:800; font-size:14px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
        </div>

        <div class="icon-card" style="background:#fff; border:none; box-shadow:0 8px 15px rgba(0,0,0,0.05); border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center;" onclick="openSettings()">
            <div style="background:linear-gradient(135deg, #94a3b8, #475569); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                <i class="fas fa-cog"></i>
            </div>
            <span style="color:#1e293b; font-weight:800; font-size:14px;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
        </div>
    </div>

   <div class="grid-3" style="gap:10px; margin-bottom:15px;">
        <div style="background:#fff; border-radius:18px; border:none; height:75px; position:relative; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
            <span id="dateDisplay" style="font-weight:800; color:#475569; font-size:18px;">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
           <input type="date" id="dateInp" onchange="document.getElementById('dateDisplay').innerText = this.value; if(window.updateDateDisplay) updateDateDisplay(this.value); renderDay();" style="position:absolute; opacity:0; width:100%; height:100%; cursor:pointer; z-index:2;">
        </div>
        <input type="time" id="tStart" style="height:75px; border-radius:22px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
        <input type="time" id="tEnd" style="height:75px; border-radius:22px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
    </div>
<div style="display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
    <select id="hairStyle" style="height:70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#1e293b; box-shadow:0 4px 10px rgba(0,0,0,0.03); padding:0 10px;">
        <option value="">‚úÇÔ∏è ‡∏ó‡∏£‡∏á‡∏ú‡∏°</option>
        <option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option>
        <option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option>
    </select>
    <select id="extra1" style="height:70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow:0 4px 10px rgba(0,0,0,0.03); padding:0 8px;">
        <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£1</option>
        <option value="‡πÄ‡∏î‡πá‡∏Å"> ‡πÄ‡∏î‡πá‡∏Å</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option>
    </select>
    <select id="extra2" style="height:70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow:0 4px 10px rgba(0,0,0,0.03); padding:0 8px;">
        <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£2</option>
        <option value="‡πÄ‡∏î‡πá‡∏Å"> ‡πÄ‡∏î‡πá‡∏Å</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option>
    </select>
</div>

<div style="display: grid; grid-template-columns: 1.4fr 1fr; gap: 8px; margin: 10px 0;">
    <div style="position: relative; background: #ffffff; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05);">
        <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 24px; color: #6366f1; font-weight: 900;">‡∏ø</span>
        <input type="number" id="priceInp" placeholder="0" inputmode="numeric" 
            style="width: 100%; height: 85px !important; background: transparent !important; font-size: 45px !important; font-weight: 900 !important; color: #1e293b !important; padding-left: 40px !important; border: none !important;">
    </div>

    <input type="number" id="tipInp" placeholder="‡∏ó‡∏¥‡∏õ" inputmode="numeric" 
        style="width: 100%; height: 85px !important; background: #ccfbf1 !important; border-radius: 20px !important; font-size: 32px !important; font-weight: 900 !important; color: #0f766e !important; border: none !important;">
</div>

<div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
    <button id="btnCash" onclick="selectPay('Cash')" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #10b981, #059669); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(16,185,129,0.3); display:flex; align-items:center; justify-content:center; gap:10px;">
        <i class="fas fa-money-bill-wave"></i> ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
    </button>
    <button id="btnTrans" onclick="selectPay('Trans')" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #6366f1, #4338ca); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(99,102,241,0.3); display:flex; align-items:center; justify-content:center; gap:10px;">
        <i class="fas fa-qrcode"></i> ‡∏™‡πÅ‡∏Å‡∏ô‡∏à‡πà‡∏≤‡∏¢
    </button>
</div>
<button class="btn-main" onclick="handleSave(event)" style="width:100%; height:90px; border-radius:28px; background:linear-gradient(135deg, #4338ca, #3730a3); color:#fff; border:none; box-shadow:0 15px 35px rgba(67,56,202,0.4); display:flex; align-items:center; justify-content:center; gap:15px;">
    <i class="fas fa-save" style="font-size: 38px;"></i>
    <span style="font-size: 32px; font-weight: 900; letter-spacing:1px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
</button>  
</div>
<div id="p2" class="page" style="max-width:480px; margin:0 auto; padding: 15px; padding-bottom: 100px;">
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
        <div style="background: #3f51b5; padding:18px 15px; border-radius:20px; text-align:center; box-shadow:0 10px 15px -3px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);">
            <small style="font-weight:800; color:#cbd5e1; text-transform: uppercase; letter-spacing: 0.5px;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</small>
            <div id="dTotal" style="font-size:36px; font-weight:900; color:#cbd5e1; margin: 5px 0;">0</div>
            <div id="dCounts" style="font-size:16px; font-weight:700; color:#cbd5e1; background:rgba(255,255,255,0.15); display:inline-block; padding:2px 10px; border-radius:10px;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 0 ‡∏Ñ‡∏ô</div>
        </div>

       <div style="background:#3f51b5; padding:15px; border-radius:20px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); display:flex; flex-direction:column; justify-content:center; gap:8px;">
    
    <div style="display:flex; justify-content:space-between; align-items:center; font-size:15px; font-weight:700;">
        <span style="color:#cbd5e1; display:flex; align-items:center; gap:8px;">
            <i class="fas fa-mobile-alt" style="width:18px; color:#60a5fa;"></i> ‡πÇ‡∏≠‡∏ô:
        </span> 
        <b id="dTrans" style="color:#ffffff;">0</b>
    </div>
    
    <div style="display:flex; justify-content:space-between; align-items:center; font-size:15px; font-weight:700;">
        <span style="color:#cbd5e1; display:flex; align-items:center; gap:8px;">
            <i class="fas fa-money-bill-wave" style="width:18px; color:#4ade80;"></i> ‡∏™‡∏î:
        </span> 
        <b id="dCash" style="color:#ffffff;">0</b>
    </div>
    
    <div style="display:flex; justify-content:space-between; align-items:center; font-size:15px; font-weight:700;">
        <span style="color:#cbd5e1; display:flex; align-items:center; gap:8px;">
            <i class="fas fa-cut" style="width:18px; color:#fbbf24;"></i> ‡∏ä‡πà‡∏≤‡∏á:
        </span> 
        <b id="dBarber" style="color:#ffffff;">0</b>
    </div>
    
    <div style="display:flex; justify-content:space-between; align-items:center; font-size:15px; font-weight:800; border-top: 1px dashed rgba(255,255,255,0.2); padding-top: 8px; margin-top: 2px;">
        <span style="color:#cbd5e1; display:flex; align-items:center; gap:8px;">
            <i class="fas fa-store" style="width:18px; color:#f472b6;"></i> ‡∏£‡πâ‡∏≤‡∏ô:
        </span> 
        <b id="dShop" style="color:#ffffff;">0</b>
    </div>
</div>
</div>
    <div id="settleBarContainer" style="margin-bottom:18px;"><div id="settleBar"></div> </div>
    <div id="dServiceStats"></div>
    <hr style="border:0; border-top:1px solid #e2e8f0; margin-top:15px;">
    <div id="dailyList"></div>

¬†<div style="margin-top: 115px; width: 100%; display: flex; justify-content: center;">
¬† ¬† ¬† ¬† <button onclick="clearDailyData()" style="width:70%; height:50px; background:#e51c23; border:none ; border-radius:15px; font-size:15px; font-weight:800; color:#ffffff; display:flex; align-items:center; justify-content:center; gap:8px; box-shadow: none;">
¬† ¬† ¬† ¬† ¬† ¬† <i class="fas fa-trash-alt" style="font-size: 18px;"></i><span style="line-height: 1;">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
¬† ¬† ¬† ¬† </button>
¬† ¬† </div>
</div>

    <div id="p3" class="page" style="max-width:480px; margin:0 auto; padding: 12px; padding-bottom: 100px; background: #f8fafc;">
    <div class="card" style="background:#fff; border-radius:25px; padding:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border:1px solid #fff; margin-bottom: 15px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <b style="font-size:22px; color:#92400e;"><i class="fas fa-wallet"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</b>
            <div id="accLight" style="background:#22c55e; width:10px; height:10px; border-radius:50%; box-shadow:0 0 8px #22c55e;"></div>
        </div>

        <div style="display:flex; gap:12px; margin-bottom:25px;">
            <div style="flex:1; background:#fff; border-radius:22px; padding:18px 10px; text-align:center; box-shadow: 0 8px 20px rgba(0,0,0,0.04); border: 1px solid #f1f5f9;">
                <small style="font-size:16px; color:#64748b; font-weight:700; text-transform:uppercase;">‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°</small>
                <b style="font-size:22px; color:#1e293b; font-weight:900; display:block;" id="accOldVal">‡∏ø0</b>
            </div>
            <div style="flex:1; background:#fff; border-radius:22px; padding:18px 10px; text-align:center; box-shadow: 0 8px 20px rgba(0,0,0,0.04); border: 1px solid #f1f5f9;">
                <small style="font-size:16px; color:#64748b; font-weight:700; text-transform:uppercase;">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</small>
                <b style="font-size:22px; color:#1e293b; font-weight:900; display:block;" id="accTodayVal">‡∏ø0</b>
            </div>
        </div>
            <div style="text-align:center; margin-bottom:20px;">
    <div style="font-size:48px; font-weight:900; color:#1a237e; letter-spacing:-1px;">‡∏ø<span id="accNet">0</span></div>
    <div id="statusBadge" style="display:inline-block; padding:6px 16px; border-radius:20px; font-size:14px; font-weight:bold; margin-top:8px;">
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...
    </div>
     </div>
        <div style="margin-bottom:15px;">
            <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; margin-bottom:8px; height:50px;">
                <i class="fas fa-calendar-alt" style="color:#6366f1;"></i>
                <input type="date" id="accDate" style="flex:1; border:none; background:none; font-size:16px; font-weight:600; padding-left:10px; outline:none;">
            </div>
            <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; height:50px;">
                <i class="fas fa-pen-nib" style="color:#94a3b8;"></i>
                <input type="text" id="accNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." style="flex:1; border:none; background:none; font-size:15px; padding-left:10px; outline:none;">
            </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="clearAccount()" style="background:linear-gradient(135deg, #10b981, #059669); color:#fff; border:none; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800;">
                <i class="fas fa-check-double"></i> ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô
            </button>
           <button onclick="openHistoryModal()" style="background:#fff; color:#3b82f6; border:2px solid #3b82f6; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800;">
                <i class="fas fa-history"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô
            </button>
        </div> 
    </div>
 <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
    <div onclick="$('histDate').showPicker()" style="background:linear-gradient(135deg, #f59e0b, #d97706); border-radius:25px; padding:20px 10px; text-align:center; color:#fff; position:relative; box-shadow:0 8px 15px rgba(245,158,11,0.2);">
        <i class="fas fa-search-dollar" style="font-size:28px; margin-bottom:5px; display:block;"></i>
        <b style="font-size:16px;">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</b>
        <input type="date" id="histDate" onchange="loadHistDaily()" style="position:absolute; inset:0; opacity:0;">
    </div>

    <div onclick="$('histMonth').showPicker()" style="background:linear-gradient(135deg, #6366f1, #4338ca); border-radius:25px; padding:20px 10px; text-align:center; color:#fff; position:relative; box-shadow:0 8px 15px rgba(99,102,241,0.2);">
        <i class="fas fa-calendar-check" style="font-size:28px; margin-bottom:5px; display:block;"></i>
        <b style="font-size:16px;">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</b>
        <input type="month" id="histMonth" onchange="loadHistMonth()" style="position:absolute; inset:0; opacity:0;">
    </div>
</div> <div onclick="confirmShareLine()" 
     style="margin-top: 15px; 
            background: linear-gradient(135deg, #25d366, #075e54); 
            border-radius: 25px; 
            padding: 15px; 
            text-align: center; 
            color: #fff; 
            cursor: pointer; 
            box-shadow: 0 8px 15px rgba(37,211,102,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;">
    <i class="fab fa-line" style="font-size: 24px;"></i>
    <b style="font-size: 16px;">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</b>
</div>
</div>
</div>    
<div id="modalSet" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(15px); -webkit-backdrop-filter:blur(15px); z-index:9999; display:flex; align-items:center; justify-content:center; padding:15px;">
    
    <div style="background:#ffffff; width:95%; max-width:420px; border-radius:35px; display:flex; flex-direction:column; overflow:hidden; animation: slideUp 0.3s ease-out; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
        
        <div style="padding:25px 20px 15px; text-align:center;">
            <h3 style="margin:0; font-size:24px; color:#1e3a8a; font-weight:900;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
        </div>

        <div style="padding:10px 25px 35px;">
            <input type="text" id="setShop" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700; color:#1e3a8a; margin-bottom:12px; outline:none;">

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px;">
                <input type="number" id="setPerc" placeholder="% ‡∏ä‡πà‡∏≤‡∏á" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700; outline:none;">
                <input type="number" id="setGuar" placeholder="‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700; outline:none;">
            </div>

            <div style="margin-bottom:12px;">
                <select id="setTheme" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:16px; font-weight:700; color:#475569; outline:none;">
                    <option value="light">üå§ ‡∏ò‡∏µ‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á</option>
                    <option value="navy">üåå ‡∏ò‡∏µ‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô</option>
                    <option value="dark">üåë ‡∏ò‡∏µ‡∏°‡∏î‡∏≥-‡∏ó‡∏≠‡∏á</option>
                </select>
            </div>
<div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
    <div style="position: relative; display: flex; align-items: center;">
        <select id="setSound" style="width:100%; height:55px; border-radius:18px; border:1px solid #cbd5e1; background:#f1f5f9; text-align:center; font-size:15px; font-weight:700; outline:none; appearance:none; -webkit-appearance:none; padding-left: 40px;">
            <option value="on">‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
            <option value="off">‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</option>
        </select>
        <i class="fas fa-volume-up" style="position: absolute; left: 15px; color: #475569; pointer-events: none;"></i>
    </div>

    <div style="position: relative; display: flex; align-items: center;">
        <select id="setVoice" style="width:100%; height:55px; border-radius:18px; border:1px solid #cbd5e1; background:#f1f5f9; text-align:center; font-size:15px; font-weight:700; outline:none; appearance:none; -webkit-appearance:none; padding-left: 40px;">
            <option value="female">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏ç‡∏¥‡∏á</option>
            <option value="male">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ä‡∏≤‡∏¢</option>
        </select>
        <i class="fas fa-user-friends" style="position: absolute; left: 15px; color: #475569; pointer-events: none;"></i>
    </div>
</div>

<div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:25px;">
    <button onclick="exportBackup()" style="height:50px; background:#ffffff; border:1px solid #cbd5e1; border-radius:12px; font-size:13px; font-weight:800; color:#1e293b; display:flex; align-items:center; justify-content:center; gap:6px; cursor:pointer;">
        <i class="fas fa-file-download" style="font-size:14px;"></i> 
        <span>‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
    </button>
    
    <input type="file" id="fileInput" style="display:none;" onchange="importBackup(this)">

<button onclick="document.getElementById('fileInput').click()" style="height:50px; background:#ffffff; border:1px solid #cbd5e1; border-radius:12px; font-size:13px; font-weight:800; color:#1e293b; display:flex; align-items:center; justify-content:center; gap:6px; cursor:pointer;">
    <i class="fas fa-file-upload" style="font-size:14px;"></i> 
    <span>‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤</span>
</button>
    
    <button onclick="clearData()" style="height:50px; background:#fff1f2; border:1px solid #fecaca; border-radius:12px; font-size:13px; font-weight:800; color:#e11d48; display:flex; align-items:center; justify-content:center; gap:6px; cursor:pointer;">
        <i class="fas fa-trash-alt" style="font-size:14px;"></i> 
        <span>‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
    </button>
</div>

            <div style="display:grid; grid-template-columns: 2fr 1.2fr; gap:12px;">
                <button onclick="saveSettings()" style="background:#1e3a8a; color:#fff; height:65px; border-radius:22px; border:none; font-weight:800; font-size:20px; box-shadow: 0 10px 25px rgba(30,58,138,0.3);">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                <button onclick="$('modalSet').style.display='none'" style="background:#f1f5f9; color:#64748b; height:65px; border-radius:22px; border:none; font-weight:800; font-size:18px;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</button>
            </div>
        </div>
    </div>
</div>
    <div id="reportModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 id="reportTitle" style="margin:0; color:#1a237e;">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
            <button onclick="closeReportModal()" style="background:#fee2e2; color:#dc2626; border:none; width:35px; height:35px; border-radius:50%; font-size:18px; cursor:pointer;">‚úï</button>
        </div>
        <div id="reportContent" style="max-height:400px; overflow-y:auto;"></div>
    </div>
</div>

<div id="historyModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; color:#1a237e;">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</h3>
            <button onclick="closeHistoryModal()" style="background:#fee2e2; color:#dc2626; border:none; width:35px; height:35px; border-radius:50%; font-size:18px; cursor:pointer;">‚úï</button>
        </div>
        <div id="accHistory" style="max-height:400px; overflow-y:auto;"></div>
    </div>
</div>
 <nav>
    <div onclick="go(1)" class="nav-item active"><i class="fas fa-edit"></i><span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span></div>
    <div onclick="go(2)" class="nav-item"><i class="fas fa-history"></i><span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span></div>
    <div onclick="go(3)" class="nav-item"><i class="fas fa-wallet"></i><span>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span></div>
</nav>
 <script>
const $ = (id) => document.getElementById(id);
let db = JSON.parse(localStorage.getItem("barber_db")) || [];
let archives = JSON.parse(localStorage.getItem("barber_archives")) || [];
let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
let payMethod = "";
function save() {
    localStorage.setItem("barber_db", JSON.stringify(db));
    localStorage.setItem("barber_archives", JSON.stringify(archives));
    localStorage.setItem("barber_account", JSON.stringify(account));
    localStorage.setItem("barber_conf", JSON.stringify(conf));
}
window.onload = () => {
    const today = new Date().toISOString().split('T')[0];

    if ($("dateInp")) $("dateInp").value = today;
    if ($("accDate")) $("accDate").value = today;
    if ($("histDate")) $("histDate").value = today;
    if (conf.shop) $("shopNameDisp").innerText = conf.shop;
    if (conf.theme) applyTheme(conf.theme);

    renderDay();
    loadAccountStatus();
};

    function addMinutes(time, mins) {
    if (!time) return "";
    const [h, m] = time.split(":").map(Number);
    const d = new Date();
    d.setHours(h, m + mins, 0, 0);
    return d.toTimeString().slice(0, 5);
}
function openReportModal(title, htmlContent) {
    const modal = $("reportModal");
    const modalTitle = $("reportTitle");     
    const modalContent = $("reportContent"); 
    const modalInner = modalContent.parentElement; 

    if (!modal || !modalTitle || !modalContent) {
        console.error("‚ùå ‡∏´‡∏≤ ID Modal ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÄ‡∏ä‡πá‡∏Ñ HTML ‡∏î‡πà‡∏ß‡∏ô!");
        return;
    }
    modalTitle.innerText = title;
    modalContent.innerHTML = htmlContent;
    modalInner.style.width = "95%";            
    modalInner.style.maxWidth = "650px";       
    modalInner.style.maxHeight = "85vh";       
    modalInner.style.overflowY = "auto";       
    modalInner.style.borderRadius = "24px";    
    modalInner.style.padding = "20px";
    modalInner.style.margin = "auto";
    modal.style.display = "flex";
    modal.style.alignItems = "center";
    modal.style.justifyContent = "center";
}
function closeReportModal() {
    $("reportModal").style.display = "none";
}
  function openHistoryModal() { 
    $("historyModal").style.display = "flex"; 
    if (typeof renderHistoryList === "function") {
        renderHistoryList(); 
    } else {
        console.error("‡∏´‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô renderHistoryList ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡πÇ‡∏ß‡πâ‡∏¢!");
    }
}

function closeHistoryModal() { 
    $("historyModal").style.display = "none"; 
}
  function handleSave() {
    const p = parseInt($("priceInp").value), t = parseInt($("tipInp").value) || 0;
    if (!p || !payMethod) return alert("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô!");
    const start = $("tStart").value || new Date().toTimeString().slice(0, 5);
    const rec = {
        id: Date.now(), date: $("dateInp").value, time: start, endTime: $("tEnd").value || addMinutes(start, 30),
        svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(Boolean),
        hair: $("hairStyle").value, price: p, tip: t, pay: payMethod, type: "SERVICE"
    };
    db.push(rec); saveDB(); renderDay(); 
    ["priceInp", "tipInp", "tStart", "tEnd"].forEach(id => $(id).value = ""); 
}
function handleInsurance() {
    const d = $("dateInp").value || new Date().toISOString().split('T')[0], g = parseInt(conf.guar) || 0;
    const speak = (t) => { const m = new SpeechSynthesisUtterance(t); m.lang = 'th-TH'; window.speechSynthesis.speak(m); };
    if (g <= 0) return (speak("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"), alert("‚ö†Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÉ‡∏ô '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö' ‡∏Å‡πà‡∏≠‡∏ô"));
    if (db.find(r => r.date === d && r.type === "GUARANTEE_CLAIM")) return (speak("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞"), alert("üõ°Ô∏è ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß"));
    if (confirm(`üõ°Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ'?`)) {
        db.push({ id: Date.now(), date: d, time: "00:00", svcs: ["üõ°Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"], price: 0, pay: "N/A", type: "GUARANTEE_CLAIM" });
        saveDB(); speak(`‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô ${g} ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`); alert("‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); renderDay();
    }
}
function handleHoliday(){
    const d=$("dateInp").value;
    if(!d) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô");
    
    if(confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${d} ‡πÄ‡∏õ‡πá‡∏ô "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"?`)){
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° property off: true ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
        db.push({
            id: Date.now(),
            date: d,
            time: "00:00",
            svcs: ["üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"],
            price: 0,
            pay: "N/A",
            type: "HOLIDAY",
            off: true  // <--- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
        });
        
        saveDB();
        
        // ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ)
        const m = new SpeechSynthesisUtterance("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        m.lang = 'th-TH';
        window.speechSynthesis.speak(m);
        
        alert("üèñÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        renderDay();
    }
}
     function openSettings() {
    if ($("setShop"))  $("setShop").value  = conf.shop  || "";
    if ($("setTheme")) $("setTheme").value = conf.theme || "light";
    if ($("setVoice")) $("setVoice").value = conf.voice || "female";
    if ($("setSound")) $("setSound").value = conf.sound || "on"; 
    if ($("setPerc"))  $("setPerc").value  = conf.perc  || 50;
    if ($("setGuar"))  $("setGuar").value  = conf.guar  || 0;

    $("modalSet").style.display = "flex";
}
function applyTheme(t) {
    document.body.className = t;
    const oldStyle = document.getElementById("navyStyle");
    if (oldStyle) oldStyle.remove();

    const s = document.documentElement.style;

    // --- ‚òÄÔ∏è ‡∏ò‡∏µ‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á (Default) ---
    s.setProperty('--card', '#ffffff');
    s.setProperty('--text', '#1a237e');
    s.setProperty('--modal-bg', '#f3f4f6'); // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏µ‡∏™‡∏ß‡πà‡∏≤‡∏á
    document.body.style.background = '#f3f4f6';

    if (t === 'dark') {
        // --- üåë ‡∏ò‡∏µ‡∏°‡∏°‡∏∑‡∏î-‡∏ó‡∏≠‡∏á ---
        s.setProperty('--card', '#262626');
        s.setProperty('--text', '#fbbf24');
        s.setProperty('--modal-bg', '#171717'); // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏µ‡∏î‡∏≥
        document.body.style.background = '#171717';
    } 
    else if (t === 'navy') {
        // --- üåå ‡∏ò‡∏µ‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô ---
        s.setProperty('--card', '#ffffff');
        s.setProperty('--text', '#1a237e');
        s.setProperty('--modal-bg', '#1a237e'); // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
        document.body.style.background = '#1a237e';

        const st = document.createElement("style");
        st.id = "navyStyle";
        st.innerHTML = `
            body.navy { background: #1a237e !important; color: #ffffff !important; }
            .navy .card b, .navy .card span { color: #1e293b !important; }
            .navy #dTotal, .navy #accNet { color: #1a237e !important; }
            .nav-item { color: #ffffff !important; opacity: 0.7; }
            .nav-item.active { color: #facc15 !important; opacity: 1; font-weight: bold; }
        `;
        document.head.appendChild(st);
    }
}
function saveSettings() {
    const shopName = $("setShop").value;
    const shopPerc = $("setPerc").value;
    const shopGuar = $("setGuar").value;
    const shopTheme = $("setTheme").value;
    conf.shop = shopName;
    conf.perc = parseFloat(shopPerc) || 0; // ‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏á
    conf.guar = parseFloat(shopGuar) || 0; // ‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏±‡∏á
    conf.theme = shopTheme;
    localStorage.setItem('shopName', shopName);
    localStorage.setItem('shopPerc', shopPerc);
    localStorage.setItem('shopGuar', shopGuar);
    localStorage.setItem('shopTheme', shopTheme);

    if($("shopNameDisp")) {
        $("shopNameDisp").innerText = shopName.toUpperCase();
    }
    if (typeof applyTheme === "function") {
        applyTheme(shopTheme); 
    }
    if (typeof calculateMoney === "function") {
        calculateMoney(); 
    }
    if (typeof renderDay === "function") {
        renderDay(); 
    }
    $("modalSet").style.display = 'none';
    alert("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
}
 function closeAndGoHome(){const m=document.getElementById("modalSet");if(m)m.style.display='none';if(typeof go==='function')go(1);else location.reload()}
 function speak(txt) {if ('speechSynthesis' in window) {const msg = new SpeechSynthesisUtterance(txt); msg.lang = 'th-TH'; window.speechSynthesis.speak(msg);}}       
 function clearAllData(){if(confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){localStorage.clear();location.reload()}}
 function updateDateDisplay(v){if(!v)return;const d=new Date(v);const el=$("dateDisplay");if(el)el.innerText=d.toLocaleDateString('th-TH',{day:'numeric',month:'short',year:'2-digit'});if(typeof renderDay==="function")renderDay()}window.addEventListener('DOMContentLoaded',()=>{const i=$("dateInp"),t=new Date().toISOString().split('T')[0];if(i){i.value=t;updateDateDisplay(t)}});
 function selectPay(m) {payMethod = m; $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;$("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;}
function renderDay() {
    const dInp = $("dateInp").value;
    const allRec = db.filter(r => r.date === dInp);
    const today = allRec.filter(r => r.type !== 'HOLIDAY');
    const isHoliday = allRec.some(r => r.type === 'HOLIDAY');
    const stats = {};
    const extraSvcs = ["‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î", "‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤", "‡∏™‡∏£‡∏∞‡∏ú‡∏°"];
    let tot = 0, trans = 0, cash = 0, tips = 0;
    let listHtml = "";

    today
    .slice()
    .sort((a,b) => a.time.localeCompare(b.time))
    .forEach((r, i) => {
        const p = Number(r.price) || 0;
        const t = Number(r.tip) || 0;
        tot += p;
        tips += t;
        (r.pay === 'Trans') ? trans += (p + t) : cash += p;
        const currentSvcs = Array.isArray(r.svcs) ? r.svcs : [];
        const hasRealHaircut = currentSvcs.some(s => s && !extraSvcs.includes(s));
        currentSvcs.forEach(s => {
            if (!s) return;
            stats[s] = (stats[s] || 0) + 1;
        });

        if (hasRealHaircut) {
            stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"] = (stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"] || 0) + 1;
        }
        const timeShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        const payIcon = r.pay === 'Trans' ? 'üì±' : 'üíµ';

        listHtml += `
        <div class="history-row" style="padding:15px; border-bottom:1px solid #f1f5f9; background:#fff;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div style="width:28px; height:28px; background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; color:#64748b; flex-shrink:0;">
                        ${i+1}
                    </div>
                    <div style="display:flex; flex-direction:column;">
                        <div style="font-weight:800; font-size:14px; color:#1e293b; margin-bottom:2px;">
                            <span style="color:#64748b; font-weight:500;">[${timeShow}]</span> ${currentSvcs.join(' + ')}
                        </div>
                        <div style="display:flex; gap:8px; align-items:center;">
                            ${t ? `<small style="color:#be185d; font-weight:700; font-size:11px;">üîπ ‡∏ó‡∏¥‡∏õ: ‡∏ø${t}</small>` : '<small style="color:#94a3b8; font-size:11px;">(‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏¥‡∏õ)</small>'}
                        </div>
                    </div>
                </div>
                <div style="text-align:right;">
                    <b style="font-size:16px; display:block; color:#1e293b;">
                        <span style="font-size:14px;">${payIcon}</span> ‡∏ø${p}${t ? ` <span style="color:#be185d;">(+${t})</span>` : ''}
                    </b>
                    <span style="font-size:11px; font-weight:700; color:#ef4444; cursor:pointer;" onclick="delRec(${r.id})">
                        ‡∏•‡∏ö <i class="fas fa-trash-alt"></i>
                    </span>
                </div>
            </div>
        </div>`;
    });

    const bEarn = isHoliday ? 0 : Math.max(tot * (conf.perc / 100), conf.guar) + tips;
    const sEarn = isHoliday ? 0 : tot - (bEarn - tips);
    const settle = isHoliday ? 0 : cash - bEarn;

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Card ‡∏ö‡∏ô ---
    if($("dTotal")) $("dTotal").innerText  = tot.toLocaleString();
    if($("dTrans")) $("dTrans").innerText  = trans.toLocaleString();
    if($("dCash")) $("dCash").innerText   = cash.toLocaleString();
    if($("dBarber")) $("dBarber").innerText = Math.floor(bEarn).toLocaleString();
    if($("dShop")) $("dShop").innerText   = Math.floor(sEarn).toLocaleString();
    if($("dCounts")) $("dCounts").innerText = isHoliday ? "üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î" : `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`;

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ---
    let sH = `<div style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-bottom:10px;">`;
    const priority = ["‡∏ï‡∏±‡∏î‡∏ú‡∏°", "‡πÄ‡∏î‡πá‡∏Å"];
    priority.forEach(k => { if (stats[k]) sH += `<span style="background:#4338ca;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${k}: ${stats[k]}</span>`; });
    for (let s in stats) { if (!priority.includes(s)) sH += `<span style="background:#64748b;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${s}: ${stats[s]}</span>`; }
    if($("dServiceStats")) $("dServiceStats").innerHTML = sH + `</div>`;

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ñ‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° ---
    let txt = "", statusColor = "", icon = "";
    if (isHoliday) { 
        txt = "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"; statusColor = "#1e40af"; icon = "üèñÔ∏è"; 
    } else if (tot === 0) { 
        txt = "‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"; statusColor = "#0369a1"; icon = "üõ°Ô∏è"; 
    } else if (settle > 0) { 
        txt = `‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle).toLocaleString()}`; statusColor = "#b91c1c"; icon = "üë®‚Äçüé®"; 
    } else if (settle < 0) { 
        txt = `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}`; statusColor = "#4338ca"; icon = "üè†"; 
    } else { 
        txt = "‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ"; statusColor = "#15803d"; icon = "‚úÖ"; 
    }

   const silverBG = "#f1f5f9"; // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏ß‡πà‡∏≤‡∏á
const btnBlue  = "#2563eb"; // ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô Royal Blue ‡∏ó‡∏µ‡πà‡∏°‡∏∂‡∏á‡∏ä‡∏≠‡∏ö

const actionBox = document.getElementById("settleBarContainer");
if (actionBox) {
    actionBox.style.display = "flex";
    actionBox.style.gap = "10px";
    actionBox.innerHTML = `
        <div id="settleBar" style="flex:8; height:55px; background:${silverBG}; display:flex; align-items:center; justify-content:center; border-radius:18px; font-weight:800; font-size:14px; color:${statusColor}; border:1px solid #e2e8f0; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);">
            <span style="margin-right:8px; font-size:18px;">${icon}</span> ${txt}
        </div>
        
        <button onclick="saveAndGo('${dInp}', ${tot})" style="flex:2.2; height:55px; background:${btnBlue}; color:#fff; border-radius:18px; border:none; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 15px rgba(37, 99, 235, 0.3);">
            <i class="fas fa-paper-plane"></i>
        </button>
    `;
}
    // --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!) ---
   const dList = document.getElementById("dailyList");
if (dList) {
    dList.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin:10px 0; padding:0 5px;">
            <b style="font-size:16px; color: var(--text);">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</b>
            <i class="fab fa-line" style="color:#22c55e; font-size:32px; cursor:pointer" onclick="shareLine()"></i>
        </div>

            ${isHoliday ? `<center style='padding:40px; color:#64748b;'>üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</center>` : (listHtml || "<center style='padding:40px; opacity:0.3;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>")}
        `;
    }
} 
     function clearDailyData() {
    const confirmDelete = confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ)");
    
    if (confirmDelete) {
        localStorage.removeItem("barber_db"); 
    
        alert("‚úÖ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö");
    
        location.reload();
    }
}
function saveAndGo(date, total) {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á SERVICE ‡πÅ‡∏•‡∏∞ HOLIDAY)
    const allToday = db.filter(r => r.date === date);
    const todayData = allToday.filter(r => r.type === 'SERVICE');
    const isHoliday = allToday.some(r => r.type === 'HOLIDAY');

    let cash = 0, trans = 0, tips = 0, count = 0, stats = {};
    const extraSvcs = ["‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î", "‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤", "‡∏™‡∏£‡∏∞‡∏ú‡∏°"];

    todayData.forEach(r => {
        const p = Number(r.price) || 0, t = Number(r.tip) || 0;
        tips += t;
        r.pay === "Cash" ? cash += p : trans += (p + t);
        const svcs = Array.isArray(r.svcs) ? r.svcs : [r.svcs];
        const isRealCut = svcs.some(s => s && !extraSvcs.includes(s));
        if (isRealCut) count++;
        svcs.forEach(s => { if(s) stats[s] = (stats[s] || 0) + 1; });
    });

    // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    const bEarn = isHoliday ? 0 : Math.max(total * (conf.perc / 100), conf.guar) + tips;
    const settle = isHoliday ? 0 : cash - bEarn;

    const idx = archives.findIndex(a => a.date === date);

    // 3. ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• data ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° flag 'off' ‡∏´‡∏£‡∏∑‡∏≠ 'type' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    const data = {
        date,
        total: Number(total),
        cash,
        trans,
        tips,
        barber: Math.floor(bEarn),
        shop: isHoliday ? 0 : total - (bEarn - tips),
        settle,
        count,
        stats,
        details: allToday, // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏î‡πâ‡∏ß‡∏¢)
        off: isHoliday,     // ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î
        type: isHoliday ? "HOLIDAY" : "WORK"
    };    

    if (idx > -1) {
        account.balance = (Number(account.balance) || 0) + (settle - (archives[idx].settle || 0));
        archives[idx] = data;
    } else {
        account.balance = (Number(account.balance) || 0) + settle;
        archives.push(data);
    }

    // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô db ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î
    db = db.filter(r => r.date !== date);
    save(); 
    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
    go(3);
}
    function toggleAccHistory() {const w = $("accHistoryWrapper"); w.style.display = w.style.display === "none" ? "block" : "none";$("accHistory").innerHTML = account.logs.map(l => `<div style="padding:5px; border-bottom:1px solid #eee;">${l.date}: ‡∏ø${l.amount} (${l.note})</div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";}    
    function loadAccountHistory() {let h = account.logs.map(l => `<div style="padding:15px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between; align-items:center;"><div><b style="font-size:14px; color:#1e293b;">${l.date}</b><br><small style="color:#64748b;">${l.note}</small></div><b style="color:${l.amount >= 0 ? '#16a34a' : '#dc2626'};">${l.amount >= 0 ? '+' : ''}‡∏ø${Math.abs(l.amount).toLocaleString()}</b></div> `).join('');if($("accHistory")) {$("accHistory").innerHTML = h || '<center style="padding:40px; color:#94a3b8;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</center>';}}     
    function loadAccountStatus() {
    const net = Number(account.balance) || 0;
   
    if ($("accOldVal")) $("accOldVal").innerText = `‡∏ø${net.toLocaleString()}`;
    if ($("accTodayVal")) $("accTodayVal").innerText = `‡∏ø0`; 
    if ($("accNet")) $("accNet").innerText = Math.abs(net).toLocaleString();

    const badge = $("statusBadge"); 
    let bgColor = "#f8fafc"; 
    let textColor = "#64748b";
    let statusTxt = "‚öñÔ∏è ‡∏¢‡∏≠‡∏î‡∏•‡∏á‡∏ï‡∏±‡∏ß";

    if (net > 0) {
        bgColor = "#fef2f2"; 
        textColor = "#dc2626"; 
        statusTxt = "üë®‚Äçüé® ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô";
    } else if (net < 0) {
        bgColor = "#eff6ff"; 
        textColor = "#1e3a8a"; 
        statusTxt = "üè† ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á";
    }
    if (badge) {
        badge.innerText = statusTxt;
        badge.style.background = bgColor;
        badge.style.color = textColor;
    }
    if ($("accLight")) {
        const lightColor = net > 0 ? "#dc2626" : (net < 0 ? "#1e3a8a" : "#16a34a");
        $("accLight").style.background = lightColor;
        $("accLight").style.boxShadow = `0 0 12px ${lightColor}`;
    }
}
function clearAccount() {
    const d = $("accDate").value || new Date().toISOString().split('T')[0];
    
    const net = Number(account.balance) || 0;

    if (net === 0) {
        alert("üíé ‡∏¢‡∏≠‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå");
        return;
    }

    const confirmMsg = net > 0 
        ? `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏≤‡∏á "‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" ‡πÉ‡∏´‡πâ‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${net.toLocaleString()} ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?`
        : `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô "‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô" ‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.abs(net).toLocaleString()} ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?`;

    if (!confirm(confirmMsg)) return;
    if (!account.logs) account.logs = [];
    account.logs.unshift({
        date: d,
        amount: net,
        note: $("accNote")?.value || "‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á"
    });
    account.balance = 0;
    save(); 
    alert("‚úÖ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
    
    if ($("accNote")) $("accNote").value = "";
    loadAccountHistory(); 
    loadAccountStatus();  
}
function renderHistoryList() {
    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if (!account.logs || account.logs.length === 0) {
        $("accHistory").innerHTML = '<center style="padding:50px; color:#94a3b8; font-size:15px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡∏£‡∏±‡∏ö</center>';
        return;
    }

    // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤ (‡πÉ‡∏ä‡πâ loop ‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ó‡∏ô reverse ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô index ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô)
    let h = "";
    for (let i = account.logs.length - 1; i >= 0; i--) {
        let l = account.logs[i];
        h += `
            <div style="padding:20px 15px; border-bottom:1px solid #e2e8f0; background:#ffffff; display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; border-radius:15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                <div style="flex: 1;">
                    <b style="font-size:17px; color:#0f172a; display:block; margin-bottom:5px;">üìÖ ${l.date}</b>
                    <span style="color:#475569; font-size:15px; font-weight:500;">üìå ${l.note || '‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á'}</span>
                </div>
                <div style="text-align:right; min-width:120px;">
                    <b style="color:${l.amount >= 0 ? '#16a34a' : '#dc2626'}; font-size:20px; display:block; margin-bottom:10px;">
                        ‡∏ø${Math.abs(l.amount).toLocaleString()}
                    </b>
                    
                    <button onclick="editAccountLog(${i})" style="background:#fef3c7; color:#92400e; border:1px solid #fcd34d; border-radius:10px; padding:10px 20px; font-size:14px; font-weight:800; cursor:pointer; width:100%;">
                        <i class="fas fa-edit"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                </div>
            </div>
        `;
    }
    
    $("accHistory").innerHTML = h;
}
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô
function editAccountLog(index) {
    // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ .reverse() ‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ß‡∏≤‡∏î ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ logs ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
    let l = account.logs[index];
    
    const newNote = prompt("üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:", l.note);
    const newAmount = prompt("üí∞ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:", Math.abs(l.amount));

    if (newNote !== null && newAmount !== null) {
        // ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ö‡∏ß‡∏Å/‡∏•‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ (‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏ä‡πà‡∏≤‡∏á)
        const isNegative = l.amount < 0;
        const val = parseFloat(newAmount.replace(/,/g, '')) || 0;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å
        account.logs[index].note = newNote;
        account.logs[index].amount = isNegative ? -val : val;

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô save() ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô localStorage
        if (typeof save === "function") {
            save();
        }

        alert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
        renderHistoryList();
        if (typeof loadAccountStatus === "function") {
            loadAccountStatus();
        }
    }
}
function loadHistDaily() {
    const d = $("histDate").value;
    if (!d) return;

    const f = archives.find(a => a.date === d);
    if (!f) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ");

    let cashTotal = f.cash || 0;
    let transTotal = f.trans || 0;
    let totalRevenue = cashTotal + transTotal;
    
    let customerCount = (f.details) ? f.details.length : (f.count || 0);
    
    const barberEarn = Math.floor(f.barber || 0);
    const shopEarn = Math.floor(f.shop || 0);
    const svcCounts = {};
    
    (f.details || []).forEach(r => {
        const services = Array.isArray(r.svcs) ? r.svcs : [r.svcs];
        services.forEach(s => {
            svcCounts[s] = (svcCounts[s] || 0) + 1;
        });
    });

    const svcHTML = Object.entries(svcCounts).map(([name, count]) => `
        <div style="background:rgba(203, 213, 225, 0.1); padding:6px 12px; border-radius:10px; font-size:12px; color:#cbd5e1; font-weight:600; display:inline-block; margin:3px; border:1px solid rgba(255, 255, 255, 0.1);">
            ${name} <span style="opacity:0.7; margin-left:4px;">x${count}</span>
        </div>
    `).join("");

    let settleHTML = "";
    if (cashTotal > barberEarn) {
        const toShop = cashTotal - barberEarn;
        settleHTML = `<div style="background:rgba(251,146,60,0.1); padding:16px; border-radius:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(251,146,60,0.3);">
            <div style="font-size:16px; color:#fdba74; font-weight:600; margin-bottom:4px;">üë®‚Äçüé® ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô</div>
            <div style="font-size:24px; color:#fb923c; font-weight:800;">‡∏ø${toShop.toLocaleString()}</div>
        </div>`;
    } else if (barberEarn > cashTotal) {
        const toBarber = barberEarn - cashTotal;
        settleHTML = `<div style="background:rgba(56,189,248,0.1); padding:16px; border-radius:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(56,189,248,0.3);">
            <div style="font-size:16px; color:#7dd3fc; font-weight:600; margin-bottom:4px;">üè† ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á</div>
            <div style="font-size:24px; color:#38bdf8; font-weight:800;">‡∏ø${toBarber.toLocaleString()}</div>
        </div>`;
    }

    const rows = (f.details || []).map((r, index) => {
        const p = Number(r.price) || 0;
        const t = Number(r.tip) || 0;
        const fullTime = (r.time && r.endTime) ? `${r.time}-${r.endTime}` : (r.time || "--:--");
        
        return `
        <div style="padding:14px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius:16px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
            <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:28px; height:28px; background:rgba(255,255,255,0.08); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:700; color:#94a3b8;">${index + 1}</div>
                <div>
                    <div style="font-weight:700; font-size:14px; color:#f8fafc;">${Array.isArray(r.svcs) ? r.svcs.join(' + ') : r.svcs}</div>
                    <div style="font-size:14px; color:#94a3b8; font-weight:500; margin-top:2px;">‚è± ${fullTime} ‚Ä¢ ${r.pay === 'Trans' ? '‡πÇ‡∏≠‡∏ô' : '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î'}</div>
                </div>
            </div>
            <div style="text-align:right;">
                <div style="font-size:16px; font-weight:800; color:#f8fafc;">‡∏ø${p.toLocaleString()}</div>
                ${t > 0 ? `<div style="font-size:12px; font-weight:600; color:#f472b6;">+ Tip ‡∏ø${t.toLocaleString()}</div>` : ''}
            </div>
        </div>`;
    }).join("");

   // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô #0f172a (‡πÄ‡∏Ç‡πâ‡∏°) ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≤‡∏ß/‡πÄ‡∏á‡∏¥‡∏ô ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
   openReportModal(`‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ${d}`, `
    <div style="font-family:'Inter', system-ui, sans-serif; background:#0f172a; margin:-16px; padding:24px; color:#f1f5f9; min-height:100vh;">
            
            <div style="text-align:center; padding:20px 0 30px 0;">
                <div style="font-size:16px; color:#94a3b8; font-weight:600; text-transform:uppercase; letter-spacing:1px;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°</div>
                <div style="font-size:48px; font-weight:900; color:#ffffff; margin-top:5px;">‡∏ø${totalRevenue.toLocaleString()}</div>
            </div>

            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin-bottom:24px;">
                <div style="background:#14532d; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</div>
                    <div style="font-size:16px; font-weight:800;">‡∏ø${cashTotal.toLocaleString()}</div>
                </div>
                <div style="background:#1e3a8a; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">üì± ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô</div>
                    <div style="font-size:16px; font-weight:800;">‡∏ø${transTotal.toLocaleString()}</div>
                </div>
                <div style="background:#78350f; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">üë• ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
                    <div style="font-size:16px; font-weight:800;">${customerCount}</div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;">
                <div style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:16px; border-radius:20px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:600; margin-bottom:4px;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏≤‡∏á</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">‡∏ø${barberEarn.toLocaleString()}</div>
                </div>
                <div style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:16px; border-radius:20px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:600; margin-bottom:4px;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">‡∏ø${shopEarn.toLocaleString()}</div>
                </div>
            </div>

            ${settleHTML}

            <div style="margin-bottom:30px;">
                <div style="font-size:14px; color:#94a3b8; font-weight:700; text-transform:uppercase; margin-bottom:12px; text-align:center;">‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</div>
                <div style="text-align:center;">${svcHTML}</div>
            </div>

            <div style="font-weight:800; font-size:16px; color:#f8fafc; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                <div style="width:4px; height:18px; background:#cbd5e1; border-radius:2px;"></div>
                ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô
            </div>
            <div style="max-height:400px; overflow-y:auto; padding-bottom:40px;">
                ${rows}
            </div>
        </div>
    `);
}
function loadHistMonth() {
    const $ = (id) => document.getElementById(id);
    const m = $("histMonth").value;
    if (!m) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");

    const filtered = archives.filter(a => a.date && a.date.startsWith(m));
    if (!filtered.length) {
        return openReportModal(
            "üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
            `<div style='padding:80px 20px; text-align:center; color:#0f172a; background:#94a3b8; height:100vh;'>
                <i class='fas fa-folder-open' style='font-size:40px;margin-bottom:10px;opacity:0.3;'></i><br>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
            </div>`
        );
    }

    const haircutList = ["‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô","‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î","‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á","‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á","‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£","‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡πÅ‡∏Å‡πâ‡∏ú‡∏°","‡πÇ‡∏Å‡∏ô‡∏ú‡∏°","‡πÄ‡∏î‡πá‡∏Å"];
    const serviceList = ["‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î","‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤","‡∏™‡∏£‡∏∞‡∏ú‡∏°","‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°"];
    const conf = window.conf || { guar: 0 };

    // --- üü¢ 1. ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ---
    let monthTotal = 0, monthBarber = 0, monthCount = 0;
    let hairStats = {}, serviceStats = {};
    let offDays = 0, workDays = 0, zeroCustomerDays = 0;
    let barberOver = 0, barberUnder = 0, barberFromGuarantee = 0, guaranteeDays = 0;
    let weeklyData = {}; // <--- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå

    // --- üü¢ 2. Loop ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
    filtered.forEach(day => {
        // ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏±‡πâ‡∏á property .off ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô (details) ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î" ‡πÑ‡∏´‡∏°
        const isDayOff = day.off === true || 
                 day.type === "HOLIDAY" || 
                 (day.details && day.details.some(r => r.type === "HOLIDAY"));


        workDays++;
        const real = Number(day.barber) || 0;
        const guar = conf.guar || 0;

        // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
        const dObj = new Date(day.date);
        let wIdx = Math.ceil(dObj.getDate() / 7);
        if (wIdx > 4) wIdx = 4;
        const wKey = `‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà ${wIdx}`;
        if (!weeklyData[wKey]) weeklyData[wKey] = { customers: 0, days: 0 };
        weeklyData[wKey].days++;

        if (day.useGuarantee === true) {
            barberFromGuarantee += (guar || real);
            guaranteeDays++;
        } else if (real > guar) {
            barberOver += real;
        } else if (real > 0) {
            barberUnder += real;
            guaranteeDays++;
        }

        monthTotal += Number(day.total) || 0;
        monthBarber += real;

        let hasHair = false;
        (day.details || []).forEach(d => {
            const svcs = Array.isArray(d.svcs) ? d.svcs : [];
            let dailyHasHair = false;
            svcs.forEach(s => {
                if (!s) return;
                s = s.trim();
                if (haircutList.includes(s)) {
                    hairStats[s] = (hairStats[s] || 0) + 1;
                    dailyHasHair = true;
                } else if (serviceList.includes(s)) {
                    serviceStats[s] = (serviceStats[s] || 0) + 1;
                }
            });
            if (dailyHasHair) { monthCount++; hasHair = true; weeklyData[wKey].customers++; }
        });
        if (!hasHair) zeroCustomerDays++;
    });

    const monthShop = monthTotal - monthBarber;
    const avgCustomerPerDay = workDays > 0 ? (monthCount / workDays) : 0;

    let insights = [];
    if (barberFromGuarantee > barberOver) insights.push("üìâ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏û‡∏∂‡πà‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏¢‡∏≠‡∏∞");
    if (barberOver > barberFromGuarantee) insights.push("üî• ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á");
    if (zeroCustomerDays > 0) insights.push(`üò¥ ‡∏°‡∏µ ${zeroCustomerDays} ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡∏¢`);
    if (offDays >= 6) insights.push("üìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÄ‡∏¢‡∏≠‡∏∞");
    if (avgCustomerPerDay >= 3) insights.push("üöÄ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ‡∏°‡∏≤‡∏Å");

    const renderStats = (obj, accentColor) => {
        const entries = Object.entries(obj).sort((a,b)=>b[1]-a[1]);
        if (!entries.length) return "<div style='color:rgba(255,255,255,0.2); padding:10px; font-size:13px;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>";
        return entries.map(([k,v]) => `
            <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 16px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius:16px; margin-bottom:8px;">
                <div style="font-weight:600; color:#f1f5f9; font-size:14px;">${k}</div>
                <div style="font-weight:800; color:${accentColor}; font-size:16px;">${v} <span style="font-size:11px; opacity:0.5; color:#fff; font-weight:400;">‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span></div>
            </div>`).join("");
    };

    // --- ‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÄ‡∏û‡∏¥‡πà‡∏° ---
    const weeklyHtml = Object.entries(weeklyData).map(([wk, data]) => {
        const avg = data.days > 0 ? (data.customers / data.days).toFixed(1) : 0;
        return `<div style="display:flex; justify-content:space-between; padding:10px 15px; background:rgba(255,255,255,0.04); border-radius:12px; margin-bottom:6px; font-size:13px;">
            <span style="color:#94a3b8;">${wk}</span>
            <span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ <b style="color:#facc15;">${avg}</b> ‡∏Ñ‡∏ô/‡∏ß‡∏±‡∏ô</span>
        </div>`;
    }).join("");

    // --- üü¢ 3. ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• UI (‡∏Ñ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡πÑ‡∏ß‡πâ) ---
    openReportModal(
        `‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${m}`,
        `
        <div style="background:#0f172a; padding:24px; font-family:'Inter', sans-serif; color:#f1f5f9; border-radius:20px; margin-bottom: 80px;">
            
            <div style="text-align:center; padding:10px 0 20px 0;">
                <div style="font-size:18px; color:#94a3b8; font-weight:700; text-transform:uppercase; letter-spacing:2px; margin-bottom:5px;">‚úÇÔ∏è ‡∏¢‡∏≠‡∏î‡∏ï‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                <div style="font-size:52px; font-weight:900; color:#ffffff; letter-spacing:-1px;">‡∏ø${monthTotal.toLocaleString()}</div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;">
                <div style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); padding:18px; border-radius:22px; text-align:center;">
                    <div style="font-size:12px; color:#94a3b8; font-weight:700; text-transform:uppercase; margin-bottom:6px;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á</div>
                    <div style="font-size:22px; font-weight:800; color:#f8fafc;">‡∏ø${Math.floor(monthBarber).toLocaleString()}</div>
                </div>
                <div style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); padding:18px; border-radius:22px; text-align:center;">
                    <div style="font-size:12px; color:#94a3b8; font-weight:700; text-transform:uppercase; margin-bottom:6px;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô</div>
                    <div style="font-size:22px; font-weight:800; color:#f8fafc;">‡∏ø${Math.floor(monthShop).toLocaleString()}</div>
                </div>
            </div>

            <div style="background:rgba(56,189,248,0.08); border:1px solid rgba(56,189,248,0.25); padding:18px; border-radius:20px; margin-bottom:25px;">
                <div style="font-size:14px; font-weight:800; color:#38bdf8; margin-bottom:10px;">ü§µ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á</div>
                <div style="font-size:13px; line-height:1.6; color:#cbd5e1;">
                    ‚Ä¢ ‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô: <span style="color:#fff;">‡∏ø${barberOver.toLocaleString()}</span><br>
                    ‚Ä¢ ‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô: <span style="color:#fff;">‡∏ø${barberUnder.toLocaleString()}</span><br>
                    ‚Ä¢ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô: <span style="color:#fff;">‡∏ø${barberFromGuarantee.toLocaleString()}</span><br>
                    ‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <span style="color:#fff;">${guaranteeDays} ‡∏ß‡∏±‡∏ô</span>
                </div>
            </div>

            <div style="display:flex; flex-wrap:wrap; justify-content:center; gap:8px; margin-bottom:25px;">
                <div style="background:rgba(56,189,248,0.15); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#38bdf8;">üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ${monthCount} ‡∏Ñ‡∏ô</div>
                <div style="background:rgba(255,255,255,0.08); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#f8fafc;">üìÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô ${workDays} ‡∏ß‡∏±‡∏ô</div>
                <div style="background:rgba(244,63,94,0.15); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#fb7185;">üõë ‡∏´‡∏¢‡∏∏‡∏î ${offDays} ‡∏ß‡∏±‡∏ô</div>
                <div style="background:rgba(250,204,21,0.15); padding:6px 14px; border-radius:12px; font-size:13px; font-weight:600; color:#facc15;">üìä ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${avgCustomerPerDay.toFixed(2)} ‡∏Ñ‡∏ô/‡∏ß‡∏±‡∏ô</div>
            </div>

            <div style="margin-bottom:25px;">
                <div style="font-size:14px; font-weight:800; color:#facc15; margin-bottom:12px;">üìÖ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                ${weeklyHtml}
            </div>

            <div style="background:rgba(250,204,21,0.08); border:1px solid rgba(250,204,21,0.25); padding:18px; border-radius:20px; margin-bottom:30px;">
                <div style="font-size:14px; font-weight:800; color:#facc15; margin-bottom:10px;">üí° ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</div>
                ${insights.map(i => `<div style="font-size:13px; color:#f8fafc; margin-bottom:6px;">‚Ä¢ ${i}</div>`).join("")}
            </div>

            <div style="margin-bottom:25px;">
                <div style="font-size:15px; font-weight:800; color:#bef264; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                    <div style="width:4px; height:16px; background:#bef264; border-radius:2px;"></div> ‡∏ó‡∏£‡∏á‡∏ú‡∏°‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                </div>
                ${renderStats(hairStats, "#bef264")}
            </div>

            <div style="padding-bottom:20px;">
                <div style="font-size:15px; font-weight:800; color:#38bdf8; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                    <div style="width:4px; height:16px; background:#38bdf8; border-radius:2px;"></div> ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                </div>
                ${renderStats(serviceStats, "#38bdf8")}
            </div>
        </div>
        `
    );
}
 function topN(obj, n = 5) {
  if (!obj || Object.keys(obj).length === 0) return [];
  return Object.entries(obj)
    .filter(([_, count]) => count > 0)
    .sort((a, b) => b[1] - a[1])
    .slice(0, n);
}
  function confirmShareLine() {
  const m = $("histMonth").value;
  if (!m) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö");

  if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${m} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà LINE ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?`)) {
    shareLineMonth();
  }
}

function shareLineMonth() {
¬† const m = $("histMonth").value;
¬† if (!m) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô");

¬† const records = archives.filter(r => r.date && r.date.startsWith(m));
¬† if (!records.length) return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ");

¬† const shopName = $("setShop").value || "Barber Shop";

¬† // ---------- 1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ (‡∏£‡∏ß‡∏° Logic ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô/‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô) ----------
¬† let total = 0, barberEarn = 0, clientCount = 0;
¬† let weekly = {};
¬† let monthHair = {}, monthSvc = {};
¬† const workDaysCount = records.length; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

¬† const weekOfMonth = d => Math.ceil((new Date(d).getDate()) / 7);
¬† const weekdayTH = d => ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"][new Date(d).getDay()];

¬† records.forEach(r => {
¬† ¬† const w = weekOfMonth(r.date);
¬† ¬† const day = weekdayTH(r.date);
¬† ¬† total += Number(r.total) || 0;
¬† ¬† barberEarn += Number(r.barber) || 0;

¬† ¬† // ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å Logic ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ‡πÉ‡∏ô UI)
¬† ¬† if (r.details && r.details.length > 0) {
¬† ¬† ¬† clientCount += r.details.length;
¬† ¬† } else {
¬† ¬† ¬† clientCount++; // Fallback ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ details
¬† ¬† }

¬† ¬† if (!weekly[w]) {
¬† ¬† ¬† weekly[w] = { customers: 0, days: new Set(), daily: {}, hair: {}, service: {} };
¬† ¬† }

¬† ¬† let dayCust = r.details ? r.details.length : 1;
¬† ¬† weekly[w].customers += dayCust;
¬† ¬† weekly[w].days.add(r.date);
¬† ¬† weekly[w].daily[day] = (weekly[w].daily[day] || 0) + dayCust;

¬† ¬† // ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏£‡∏á‡∏ú‡∏°/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
¬† ¬† (r.details || []).forEach(d => {
¬† ¬† ¬† (d.svcs || []).forEach(s => {
¬† ¬† ¬† ¬† if(!s) return;
¬† ¬† ¬† ¬† const haircutList = ["‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô","‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î","‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á","‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á","‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£","‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô","‡πÅ‡∏Å‡πâ‡∏ú‡∏°","‡πÇ‡∏Å‡∏ô‡∏ú‡∏°","‡πÄ‡∏î‡πá‡∏Å"];
¬† ¬† ¬† ¬† if(haircutList.includes(s.trim())) {
¬† ¬† ¬† ¬† ¬† monthHair[s] = (monthHair[s]||0)+1;
¬† ¬† ¬† ¬† ¬† weekly[w].hair[s] = (weekly[w].hair[s]||0)+1;
¬† ¬† ¬† ¬† } else {
¬† ¬† ¬† ¬† ¬† monthSvc[s] = (monthSvc[s]||0)+1;
¬† ¬† ¬† ¬† ¬† weekly[w].service[s] = (weekly[w].service[s]||0)+1;
¬† ¬† ¬† ¬† }
¬† ¬† ¬† });
¬† ¬† });
¬† });

¬† const shopEarn = total - barberEarn;
¬† const avgPerDay = workDaysCount > 0 ? (clientCount / workDaysCount) : 0;

¬† // ---------- 2. ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ----------
¬† let weekLines = Object.entries(weekly).map(([w, data]) => {
¬† ¬† const avgW = data.customers / data.days.size;
¬† ¬† let busy = Object.entries(data.daily).filter(([d, c]) => c >= avgW * 1.3).map(x => x[0]);
¬† ¬† return `üìç ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ${w}: ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${avgW.toFixed(1)} ‡∏Ñ‡∏ô/‡∏ß‡∏±‡∏ô\n¬† ¬†(‡πÄ‡∏¢‡∏≠‡∏∞: ${busy.join(",") || "-"})`;
¬† }).join("\n");

¬† // ---------- 3. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE (‡πÄ‡∏•‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö UI) ----------
const aiComments = buildMonthlyComments({ 
      weekly, 
      monthHair, 
      monthSvc, 
      avgPerDay, 
      total, 
      shopEarn,
      workDays: workDaysCount 
  });
  
  const aiSection = aiComments.length > 0 
    ? `üìù ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:\n${aiComments.map(c => `‚Ä¢ ${c}`).join("\n")}`
    : "üìù ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö";

  // ---------- 3. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô AI ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ) ----------
  const msg = `
üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: ${shopName}
üìÖ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${m}

‚úÇÔ∏è ‡∏¢‡∏≠‡∏î‡∏ï‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ‡∏ø${total.toLocaleString()}
ü§µ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á: ‡∏ø${Math.floor(barberEarn).toLocaleString()}
üè† ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô: ‡∏ø${Math.floor(shopEarn).toLocaleString()}

üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°:
üë§ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${clientCount} ‡∏Ñ‡∏ô
üìÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: ${workDaysCount} ‡∏ß‡∏±‡∏ô
üìà ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${avgPerDay.toFixed(2)} ‡∏Ñ‡∏ô/‡∏ß‡∏±‡∏ô

${aiSection} 

üìÖ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå:
${weekLines}

üèÜ ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°:
${Object.entries(monthSvc).sort((a,b)=>b[1]-a[1]).slice(0,3).map(([k,v])=>`‚Ä¢ ${k} (${v} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)`).join("\n") || "-"}

üí° ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
`.trim();

 const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
location.href = lineUrl;

    }
function buildMonthlyComments(data) {
  const { avgPerDay, total, shopEarn, workDays } = data;
  const comments = [];

  if (avgPerDay > 20) comments.push("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∂‡∏Å‡∏Ñ‡∏±‡∏Å‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö");
  if (shopEarn > total * 0.5) comments.push("‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ");
  if (workDays < 20 && workDays > 0) comments.push("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ ‡∏≠‡∏≤‡∏à‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡πâ‡∏≤‡∏ô");

  if (!comments.length) comments.push("‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö");
  return comments;
}
    function shareLine() {
    const dInp = $("dateInp").value, today = db.filter(r => r.date === dInp); if (!today.length) return;
    const dp = dInp.split('-'), fDate = `${dp[2]}/${dp[1]}/${dp[0]}`;
    let tot=0, cash=0, trans=0, tips=0, stats={};
    let clientList = today.sort((a,b)=>a.time.localeCompare(b.time)).map((r,i)=>{
        const p = Number(r.price)||0, t = Number(r.tip)||0; tot+=p; tips+=t;
        r.pay==='Trans' ? trans+=p : cash+=p;
        if(r.hair&&r.hair.includes("‡πÄ‡∏î‡πá‡∏Å")) stats["‡πÄ‡∏î‡πá‡∏Å"]=(stats["‡πÄ‡∏î‡πá‡∏Å"]||0)+1;
        (r.svcs||[]).forEach(s=>{ if(s) stats[s]=(stats[s]||0)+1; });
        const tShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        return `${i+1}. [${tShow}] ${(r.svcs||[]).join('+')} = ${p}${t?` (+‡∏ó‡∏¥‡∏õ ${t})`:''} ${r.pay==='Trans'?'üì±':'üíµ'}`;
    }).join('\n');
    const allowed = ["‡πÄ‡∏î‡πá‡∏Å","‡∏™‡∏£‡∏∞‡∏ú‡∏°","‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î","‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°","‡∏¢‡πâ‡∏≠‡∏°‡∏™‡∏µ"], icons = {"‡πÄ‡∏î‡πá‡∏Å":"üßí","‡∏™‡∏£‡∏∞":"üßº","‡πÇ‡∏Å‡∏ô":"ü™í","‡∏¢‡πâ‡∏≠‡∏°":"üé®"};
    let statText = Object.entries(stats).filter(([k])=>allowed.some(a=>k.includes(a))).map(([k,v])=>`${icons[Object.keys(icons).find(i=>k.includes(i))]||'üîπ'} ${k}: ${v}`).join('\n');
    let bEarn = Math.max(tot*(conf.perc/100), conf.guar) + tips; // ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ = ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á + ‡∏ó‡∏¥‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    let settle = cash - bEarn, settleMsg = settle > 0 ? `‚ö†Ô∏è ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ${Math.floor(Math.abs(settle))}` : `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ${Math.floor(Math.abs(settle))}`;
    let msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô: Barber Shop\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${fDate}\n-------------------------\nüìù ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (${today.length} ‡∏Ñ‡∏ô):\n${clientList}\n-------------------------\nüìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô:\n${statText}\n-------------------------\nüí∞ ‡∏¢‡∏≠‡∏î: ${tot} | üßß ‡∏ó‡∏¥‡∏õ: ${tips}\nüì± ‡πÇ‡∏≠‡∏ô: ${trans} | üíµ ‡∏™‡∏î: ${cash}\nü§µ ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ: ${Math.floor(bEarn)}\nüè† ‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ: ${Math.floor(tot-(bEarn-tips))}\n-------------------------\n${settleMsg}`;
    window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
}
function go(p) {
    document.querySelectorAll('.page').forEach(pg => {
        pg.classList.remove('active');
        pg.style.display = 'none'; 
    });
    const targetPage = document.getElementById('p' + p);
    if (targetPage) {
        targetPage.classList.add('active');
        targetPage.style.display = 'block';
    }
    document.querySelectorAll('.nav-item').forEach((btn, i) => {
        btn.classList.toggle('active', (i + 1) === p);
    });
    if (p === 3) { 
        // 1. ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏Å‡πà‡∏≠‡∏ô
        if($("accDate") && $("dateInp")) $("accDate").value = $("dateInp").value;
        // 2. ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        loadAccountStatus(); 
    }
}
    function saveDB() {localStorage.setItem("barber_db", JSON.stringify(db));localStorage.setItem("barber_conf", JSON.stringify(conf));}
    function delRec(id) { if (confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) { db = db.filter(r => r.id !== id); saveDB(); renderDay(); } }
    function editTime(id) {const rec = db.find(r => r.id === id);if (!rec) return;const newStart = prompt("‡πÅ‡∏Å‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° (HH:MM)", rec.time);if (!newStart) return;const newEnd = prompt("‡πÅ‡∏Å‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à (HH:MM)", rec.endTime || "");rec.time = newStart;rec.endTime = newEnd || addMinutes(newStart, 30);saveDB();renderDay();}
    
    window.onclick = function(e) {const modals = [{ id: "reportModal", close: closeReportModal },{ id: "historyModal", close: closeHistoryModal },{ id: "configModal", close: closeConfigModal } ]; 
    modals.forEach(m => {const modalEl = $(m.id);if (modalEl && e.target === modalEl && typeof m.close === "function") {m.close();}});};
   window.addEventListener('load', () => {
    const n = new Date(), 
          t = n.getHours().toString().padStart(2, '0') + ':' + n.getMinutes().toString().padStart(2, '0'); 
    if(document.getElementById('tStart')) document.getElementById('tStart').value = t; 
    if(document.getElementById('tEnd')) document.getElementById('tEnd').value = t;
    const savedName = localStorage.getItem('shopName');
    const savedTheme = localStorage.getItem('shopTheme');
    if (savedName) {
        document.getElementById('shopNameDisp').innerText = savedName.toUpperCase();
        if(document.getElementById('setShop')) document.getElementById('setShop').value = savedName;
    }
    if (savedTheme) {
        if(document.getElementById('setTheme')) document.getElementById('setTheme').value = savedTheme;
        const body = document.body;
        if (savedTheme === 'navy') {
            body.style.background = '#1e3a8a';
            body.style.color = '#ffffff';
        } else if (savedTheme === 'dark') {
            body.style.background = '#0f172a';
            body.style.color = '#e2e8f0';
        } else {
            body.style.background = '#f8fafc';
            body.style.color = '#1e293b';
        }
    }
});
     // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function exportBackup() {
            const data = {
                db: JSON.parse(localStorage.getItem("barber_db") || "[]"),
                archives: JSON.parse(localStorage.getItem("barber_archives") || "[]")
            };
            const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `backup-barber-${new Date().toLocaleDateString()}.json`;
            a.click();
        }
        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
       function importBackup(input) {
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);
            // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏∏‡∏†‡∏≤‡∏û
            const confirmImport = confirm("‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?");
            
            if(confirmImport) {
                localStorage.setItem("barber_db", JSON.stringify(data.db || []));
                localStorage.setItem("barber_archives", JSON.stringify(data.archives || []));
                alert("‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
                location.reload();
            }
        } catch(err) {
            alert("‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
        input.value = '';
    };

    if (input.files && input.files[0]) {
        reader.readAsText(input.files[0]);
    }
}
        // 3. ‡∏ï‡∏±‡∏ß‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡πÑ‡∏î‡πâ)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker ‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'))
                    .catch(err => console.log('‡∏à‡∏î‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', err));
            });
        }

    function clearData() {
    const confirmDelete = confirm("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î");
    
    if (confirmDelete) {
        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏≠‡∏õ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
        localStorage.clear(); 
        
        alert("‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö");
        location.reload(); // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô 0
    }
}
</script>
</body>
</html>
