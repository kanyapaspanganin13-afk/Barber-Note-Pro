 <!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.7.2.3</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
    :root { 
        --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0;
    }
    * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }

    /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô --- */
    .container { padding: 15px 15px 100px 15px !important; max-width: 500px; margin: auto; position: relative; z-index: 1; }
    
    .nav-bar {
        position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important;
        height: 75px !important; background: white !important; display: flex !important; 
        justify-content: space-around !important; align-items: center !important; 
        z-index: 99999 !important; /* ‡∏î‡∏±‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
        border-top: 1px solid #eee;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    .nav-item {
        flex: 1 !important; display: flex !important; flex-direction: column !important;
        align-items: center !important; justify-content: center !important; cursor: pointer !important;
        pointer-events: auto !important;
    }
    .nav-item.active { color: #6366f1; }
    .nav-item i { font-size: 24px; }
    .nav-item span { font-size: 13px; font-weight: 500; }
    body.deep-navy { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: #334155; }
    body.deep-navy .icon-card, body.deep-navy input, body.deep-navy select { background: #1e293b; color: white; border-color: #334155; }
    body.barber-dark { --bg: #121212; --card: #1a1a1a; --text: #e0e0e0; --primary: #fbbf24; --border: #333; }
    body.barber-dark .icon-card, body.barber-dark input, body.barber-dark select { background: #1a1a1a; color: #fbbf24; border-color: #333; }   
    
    .grid-3 {display: grid !important; grid-template-columns: repeat(3, 1fr) !important; gap: 6px; margin-bottom: 8px;}
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 8px; }
    .icon-card { position: relative; border-radius: 15px; padding: 15px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1.5px solid transparent; background: #fff; }
    
    input, select { width: 100%; height: 68px !important; border-radius: 14px !important; font-size: 18px !important; font-weight: 600; text-align: center; border: 1.5px solid var(--border); background: #f1f5f9; }
    .price-box { font-size: 55px !important; height: 90px !important; font-weight: 700 !important; margin-bottom: 12px !important; border: 2px solid var(--primary) !important; display: flex; align-items: center; justify-content: center; background: #fff; color: var(--text);}
    
    .btn { border: none; padding: 12px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.2s; }
    .btn-pay { background: #e2e8f0; color: #64748b; border:2px solid transparent; height: 70px; font-size: 18px;}
    .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
    .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }
    .btn-main { background: var(--primary); color: white; width: 100%; height: 85px; border-radius: 20px; font-size: 35px; margin-top: 10px; border:none; }

    .page { display: none; } 
    .page.active { display: block; }
    
    .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); display: none; z-index: 100000; align-items: center; justify-content: center; }
    .modal-content { background: #fff; width: 90%; max-width: 400px; border-radius: 25px; padding: 25px; max-height: 85vh; overflow-y: auto; }
    .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: 800; font-size: 14px; margin-bottom: 10px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
    .acc-main-card { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #fffbeb; }
    .btn-save { background: var(--success); color: white; border: none; width: 100%; padding: 15px; border-radius: 15px; font-weight: 700; font-size: 16px; cursor: pointer; }
    #accHistory { font-size: 12px; max-height: 150px; overflow-y: auto; }
</style>
</head>
<body>
    <div class="container">
        <h2 id="shopNameDisp" style="text-align:center; color:var(--primary); margin: 10px 0;">Barber Shop</h2>

        <div id="p1" class="page active">
            <div class="grid-3">
                <div class="icon-card" style="background: #fffbeb; border-color: #fde68a;" onclick="handleInsurance()"><span>üõ°Ô∏è</span><span style="color: #b45309;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span></div>
                <div class="icon-card" style="background: #fff1f2; border-color: #fecdd3;" onclick="handleHoliday()"><span>üèñÔ∏è</span><span style="color: #be185d;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span></div>
                <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1;" onclick="openSettings()"><span>‚öôÔ∏è</span><span style="color: #475569;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span></div>
            </div>

            <div class="grid-3">
                <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1; padding: 1px; height: 55px; position: relative;">
                    <span id="dateDisplay" style="font-size: 18px; font-weight: 700;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                    <input type="date" id="dateInp" onchange="document.getElementById('dateDisplay').innerText = this.value; if(window.updateDateDisplay) updateDateDisplay(this.value)" style="position: absolute; top: 0; left: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 2;">
                </div>
                <input type="time" id="tStart" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°" style="text-align:center; height: 50px;">
                <input type="time" id="tEnd" placeholder="‡πÄ‡∏™‡∏£‡πá‡∏à" style="text-align:center; height: 50px;">
            </div>

            <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 12px;">
                <select id="hairStyle" style="height: 70px;">
                    <option value="">üíá ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏°</option>
                    <option value="‡πÄ‡∏î‡πá‡∏Å">üë∂ ‡∏ï‡∏±‡∏î‡∏ú‡∏°‡πÄ‡∏î‡πá‡∏Å</option>
                    <option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    <option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option>
                </select>
                <select id="extra1" style="height: 50px;"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option></select>
                <select id="extra2" style="height: 50px;"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option></select>
            </div>

            <input type="number" id="priceInp" class="price-box" placeholder="0" inputmode="numeric">

            <div class="grid-2">
                <button id="btnCash" class="btn btn-pay" onclick="selectPay('Cash')">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
                <button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">üì± ‡πÇ‡∏≠‡∏ô</button>
            </div>
            <button class="btn btn-main" onclick="handleSave()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div> <div id="p2" class="page" style="padding: 15px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
                <div style="background: white; padding:18px 15px; border-radius:20px; text-align:center; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                    <small style="font-weight:800; color:#64748b; text-transform: uppercase;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</small>
                    <div id="dTotal" style="font-size:36px; font-weight:900; color:#4338ca; margin: 5px 0;">0</div>
                    <div id="dCounts" style="font-size:13px; font-weight:700; color:#1e293b; background:#e0e7ff; display:inline-block; padding:2px 10px; border-radius:10px;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 0 ‡∏Ñ‡∏ô</div>
                </div>
                <div style="background:white; padding:15px; border-radius:20px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; display:flex; flex-direction:column; justify-content:center; gap:8px;">
                    <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#0ea5e9;">üì± ‡πÇ‡∏≠‡∏ô:</span> <b id="dTrans">0</b></div>
                    <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#6366f1;">ü§µ ‡∏ä‡πà‡∏≤‡∏á:</span> <b id="dBarber">0</b></div>
                    <hr style="border:0; border-top:1px dashed #cbd5e1; margin:4px 0;">
                    <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:800;"><span style="color:#64748b;">üè† ‡∏£‡πâ‡∏≤‡∏ô:</span> <b id="dShop">0</b></div>
                </div>
            </div>

            <div style="display:flex; gap:10px; margin-bottom:18px; align-items: center;">
                <div id="settleBar" style="flex: 8; height: 50px; display:flex; align-items:center; justify-content:center; font-weight:900; border-radius:15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 14px;"></div>
                <button onclick="sendSummary()" style="flex: 2; height: 50px; background:#ff4500; color:white; border:none; border-radius:15px; font-size:20px; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 10px rgba(255, 69, 0, 0.3); cursor:pointer;"><i class="fas fa-paper-plane"></i></button>
            </div>

            <div id="dServiceStats" style="text-align:center; margin-bottom:20px; display:flex; flex-wrap:wrap; justify-content:center; gap:6px;"></div>
            <hr style="border:0; border-top:1px solid #e2e8f0; margin-bottom:15px;">
     <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
    <div style="font-weight:800; color:#1e293b; font-size:14px;">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</div>
</div>

<div id="dailyList" style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
    </div>

</button>
        </div>
         <div id="p3" class="page"> 
             <div class="acc-main-card">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0; font-size:16px; color:#b45309;"><i class="fas fa-wallet"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h3>
                    <div id="accLight" style="background:gray; width:12px; height:12px; border-radius:50%;"></div>
                </div>
                <div style="font-size:13px; color:#64748b; margin:15px 0; background:rgba(0,0,0,0.03); padding:12px; border-radius:15px;">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°:</span><b id="accOldVal">‡∏ø0</b></div>
                    <div style="display:flex; justify-content:space-between;"><span>‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</span><b id="accTodayVal" style="color:var(--primary)">‡∏ø0</b></div>
                </div>
                <div style="text-align:center; margin:20px 0;">
                    <div style="font-size:14px; opacity:0.6;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
                    <div style="font-size:48px; font-weight:900; color:var(--primary);">‡∏ø<span id="accNet">0</span></div>
                </div>
                <div id="accStatus" class="status-bar">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                <button class="btn" onclick="toggleAccHistory()" style="width:100%; border:1px dashed var(--primary); background:#f0f7ff; color:var(--primary); margin-bottom:15px;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</button>
                <div id="accHistoryWrapper" style="display:none; margin-bottom:15px;"><div id="accHistory" class="card" style="font-size:12px; max-height:150px; overflow-y:auto;"></div></div>
                <div style="background:#f8fafc; padding:15px; border-radius:20px; border:1px solid var(--border);">
                    <input type="date" id="accDate" style="margin-bottom:10px;">
                    <input type="text" id="accNote" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥" style="margin-bottom:10px;">
                    <button class="btn-save" onclick="clearAccount()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</button>
                </div>
            </div>
            <div class="card" style="margin-top:20px; padding: 15px;">
                <label>üìÖ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</label>
                <input type="date" id="histDate" onchange="loadHistDaily()" style="margin:10px 0;">
                <div id="histDailyArea"></div>
            </div>
        </div> </div> <div id="modalSet" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0; color:var(--primary); text-align: center;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3> 
            <label style="font-size:11px; font-weight:600;">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label> <input id="setShop" style="margin-bottom:10px;">
            <div class="grid-2">
                <div><label style="font-size:11px; font-weight:600;">% ‡∏ä‡πà‡∏≤‡∏á</label><input type="number" id="setPerc" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50"></div>
                <div><label style="font-size:11px; font-weight:600;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏ß‡∏±‡∏ô</label><input type="number" id="setGuar" placeholder="0"></div>
            </div>
            <div style="margin-top:10px">
                <label style="font-size:11px; font-weight:600;">‡∏ò‡∏µ‡∏°‡πÅ‡∏≠‡∏õ</label>
                <select id="setTheme">
                    <option value="neon-light">üå§ Neon Light</option>
                    <option value="deep-navy">üåå Deep Navy</option>
                    <option value="barber-dark">üåë Barber Dark</option>
                </select>
            </div>
            <div class="grid-2" style="margin-top:10px">
                <div><label style="font-size:11px; font-weight:600;">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label> <select id="setSound"><option value="on">üîä ‡πÄ‡∏õ‡∏¥‡∏î</option><option value="off">üîá ‡∏õ‡∏¥‡∏î</option></select></div>
                <div><label style="font-size:11px; font-weight:600;">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î</label><select id="setVoice"><option value="female">üë© ‡∏´‡∏ç‡∏¥‡∏á</option><option value="male">üë® ‡∏ä‡∏≤‡∏¢</option></select></div>
            </div>
            <div class="grid-2" style="margin-top:20px">
                <button class="btn" style="background:var(--primary); color:#fff" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                <button class="btn" style="background:#e2e8f0; color:var(--text)" onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
            </div>
            <button class="btn" style="width:100%; background:var(--danger); color:#fff; margin-top:10px; font-size:12px;" onclick="clearAllData()">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>
    </div>
      
    <nav class="nav-bar">
        <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i><span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span></div>
        <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-file-invoice"></i><span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span></div>
        <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-wallet"></i><span>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</span></div>
    </nav>
 <script>
 
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å LocalStorage (‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ)
    let db = JSON.parse(localStorage.getItem("barber_db")) || [];
    let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
    let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
    let payMethod = "";
    const $ = (id) => document.getElementById(id);
    window.onload = () => {
        const today = new Date().toISOString().split('T')[0];
        if($("dateInp")) $("dateInp").value = today;if($("accDate")) $("accDate").value = today;if($("histDate")) $("histDate").value = today;if($("shopNameDisp")) $("shopNameDisp").innerText = conf.shop; // ‡πÉ‡∏ä‡πâ conf.shop ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏ß‡πâ
        updateDateDisplay(today);
    };
function handleSave() {
        const p = parseInt($("priceInp").value);
        if(!p || !payMethod) return alert("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏µ‡πà!");
        const rec = {id: Date.now(),date: $("dateInp").value,time: $("tStart").value || new Date().toLocaleTimeString('th-TH', {hour12:false, hour:'2-digit', minute:'2-digit'}),svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(s => s !== ""),
        price: p,pay: payMethod,type: "SERVICE" // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó GUARANTEE_CLAIM ‡∏´‡∏£‡∏∑‡∏≠ HOLIDAY
        };
        db.push(rec);saveDB();alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö");$("priceInp").value = "";renderDay();
    }
    // --- 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ 
function handleInsurance() {
    const today = $("dateInp").value || new Date().toISOString().split('T')[0];
    const guaranteeAmount = parseInt(conf.guar) || 0;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î
    const speak = (txt) => {
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'th-TH';
        window.speechSynthesis.speak(msg);
    };

    // --- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏™‡∏±‡πà‡∏á: ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡πÄ‡∏õ‡πá‡∏ô 0) ‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ---
    if (guaranteeAmount <= 0) {
        speak("‡∏û‡∏µ‡πà‡∏Ñ‡∏∞ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞"); // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö' ‡∏Å‡πà‡∏≠‡∏ô");
        return;
    }

    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡πÑ‡∏´‡∏°
    const alreadyGuar = db.find(r => r.date === today && r.type === "GUARANTEE_CLAIM");
    if (alreadyGuar) {
        speak("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞");
        alert("üõ°Ô∏è ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà");
        return;
    }

    if (confirm(`üõ°Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ' ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏û‡∏µ‡πà?`)) {
        db.push({ 
            id: Date.now(), 
            date: today, 
            time: "00:00", 
            svcs: ["üõ°Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"], 
            price: 0, 
            pay: "N/A",
            type: "GUARANTEE_CLAIM" 
        });

        saveDB(); 
        speak(`‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô ${guaranteeAmount} ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞`);
        alert("‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        renderDay();
    }
}
    // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î ---
   function handleHoliday() {
    const today = $("dateInp").value;
    if (!today) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô");

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î
    const speak = (txt) => {
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'th-TH';
        window.speechSynthesis.speak(msg);
    };

    if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${today} ‡πÄ‡∏õ‡πá‡∏ô "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"?`)) {
        const holidayRecord = {
            id: Date.now(),
            date: today,
            time: "00:00",
            svcs: ["üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡πâ‡∏≤‡∏ô"], // ‡πÉ‡∏™‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î
            price: 0,
            pay: "N/A",
            type: "HOLIDAY" // ‡∏°‡∏≤‡∏£‡πå‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≥‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
        };
        
        db.push(holidayRecord);
        saveDB();
        
        speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏ö‡∏≤‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞"); // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î
        alert("üèñÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        renderDay();
    }
}

    // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ conf ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô) ---
    function openSettings() {
        const modal = $("modalSet");
        if (modal) {
            $("setShop").value = conf.shop || "";
            $("setPerc").value = conf.perc || 50;
            $("setGuar").value = conf.guar || 0;
            modal.style.display = 'flex'; 
        }
    }
    function saveSettings() {
    conf.shop = $("setShop").value;
    conf.perc = parseInt($("setPerc").value);
    conf.guar = parseInt($("setGuar").value);
    conf.theme = $("setTheme").value;
    conf.sound = $("setSound").value;
    conf.voice = $("setVoice").value;
    conf.bright = $("setBright").value;

    localStorage.setItem("barber_conf", JSON.stringify(conf));
    
    applyTheme(conf.theme);
    changeBrightness(conf.bright);
    $("shopNameDisp").innerText = conf.shop;
    
    speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    closeSettings();
}
    function closeSettings() {
        if ($("modalSet")) $("modalSet").style.display = 'none';
    }
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°
    function applyTheme(themeName) {
    document.body.className = themeName;
    }
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î
    function speak(text) {
    if (conf.sound === 'off') return;
    window.speechSynthesis.cancel();
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'th-TH';
    msg.pitch = (conf.voice === 'male') ? 0.8 : 1.2;
    window.speechSynthesis.speak(msg);
    }
    function clearAllData() {
        if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£!")) {
            localStorage.clear();
            location.reload();
        }
    }
function updateDateDisplay(val) {
    if (!val) return; // ‡∏Å‡∏±‡∏ô Error ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
    const d = new Date(val);
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô "20 ‡∏°.‡∏Ñ."
    document.getElementById("dateDisplay").innerText = d.toLocaleDateString('th-TH', { 
        day: 'numeric', 
        month: 'short',
        year: '2-digit' // ‡πÅ‡∏ñ‡∏°: ‡πÉ‡∏™‡πà‡∏õ‡∏µ‡∏ó‡πâ‡∏≤‡∏¢‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå
    });
    
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô renderDay ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢
    if (typeof renderDay === "function") renderDay();
}

// 2. *** ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏≠‡∏¢‡∏π‡πà ‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏£‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ ***
window.addEventListener('DOMContentLoaded', () => {
    const dateInp = document.getElementById("dateInp");
    const now = new Date();
    
    // ‡∏à‡∏±‡∏î‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡πÉ‡∏ô input ‡πÑ‡∏î‡πâ (YYYY-MM-DD)
    const today = now.getFullYear() + '-' + 
                  String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                  String(now.getDate()).padStart(2, '0');
    
    dateInp.value = today;       // ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
    updateDateDisplay(today);    // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô
});

    function selectPay(m) {
        payMethod = m;
        $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;
        $("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;
    }
function renderDay() {
    const d = $("dateInp").value, today = db.filter(r => r.date === d); 
    let tot = 0, trans = 0, cash = 0, stats = {}, listHtml = "";

    today.sort((a, b) => a.time.localeCompare(b.time)).forEach(r => {
        tot += r.price; 
        r.pay === 'Trans' ? trans += r.price : cash += r.price; 

        // 1. ‡∏ô‡∏±‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡∏ï‡∏±‡∏î‡∏ú‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏±‡∏ô‡πÅ‡∏£‡∏Å)
        const hasHair = r.hair && r.hair.trim() !== "";
        const hasCutSvc = r.svcs.includes("‡∏ï‡∏±‡∏î‡∏ú‡∏°") || r.svcs.includes("‡πÄ‡∏î‡πá‡∏Å");
        if (hasHair || hasCutSvc) stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"] = (stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"] || 0) + 1;
        if (hasHair) { let h = r.hair.trim(); stats[h] = (stats[h] || 0) + 1; }
        r.svcs.forEach(s => {
            if (s === "‡πÄ‡∏î‡πá‡∏Å") stats["‡πÄ‡∏î‡πá‡∏Å"] = (stats["‡πÄ‡∏î‡πá‡∏Å"] || 0) + 1;
            else if (s !== "‡∏ï‡∏±‡∏î‡∏ú‡∏°") stats[s] = (stats[s] || 0) + 1;
        });

        // 2. ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏∂‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡πÄ‡∏õ‡πä‡∏∞‡πÜ ‡∏Ñ‡∏•‡∏µ‡∏ô‡∏™‡∏∏‡∏î!)
        listHtml += `
        <div class="history-row" style="padding:10px; border-bottom:1px solid #eee;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span style="font-weight:700; font-size:14px;">${r.time} | ${r.svcs.join('+')}</span>
                <b style="font-size:16px;">‡∏ø${r.price}</b>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; opacity:0.7; font-size:12px; margin-top:4px;">
                <span>${r.hair || ''}</span>
                <span>
                    ${r.pay === 'Cash' ? 'üíµ ‡∏™‡∏î' : 'üì± ‡πÇ‡∏≠‡∏ô'} 
                    <i class="fas fa-trash" style="margin-left:10px; color:var(--danger); cursor:pointer;" onclick="delRec(${r.id})"></i>
                </span>
            </div>
        </div>`;
    });

    const bEarn = Math.max(tot * (conf.perc / 100), conf.guar), sEarn = tot - bEarn, settle = cash - bEarn;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ö‡∏ô
    $("dTotal").innerText = tot.toLocaleString(); 
    $("dTrans").innerText = trans.toLocaleString(); 
    $("dBarber").innerHTML = `${Math.floor(bEarn).toLocaleString()} <small style="font-size:10px; opacity:0.6;">(‡∏™‡∏î: ${cash})</small>`; 
    $("dShop").innerText = Math.floor(sEarn).toLocaleString(); 
    $("dCounts").innerText = `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`; 

    // 3. ‡∏û‡πà‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ Badge
    let sH = `<div style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:10px;">`;
    if(stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"]) sH += `<span class="badge" style="background:#1e3a8a; color:#fff; font-size:10px;">‡∏ï‡∏±‡∏î‡∏ú‡∏°: ${stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"]}</span>`;
    for(let s in stats) { 
        if(s !== "‡∏ï‡∏±‡∏î‡∏ú‡∏°") {
            let bg = "#64748b";
            if(s === "‡πÄ‡∏î‡πá‡∏Å") bg = "#f472b6"; else if(s.includes("‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô")) bg = "#8b5cf6"; 
            else if(s.includes("‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á")) bg = "#0ea5e9"; else if(s === "‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î") bg = "#10b981";
            sH += `<span class="badge" style="background:${bg}; color:#fff; font-size:10px;">${s}: ${stats[s]}</span>`; 
        }
    }
    sH += `</div>`;
    $("dServiceStats").innerHTML = sH;

    // 4. ‡∏û‡πà‡∏ô‡πÅ‡∏Ñ‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÉ‡∏ô dailyList (‡∏ï‡∏≤‡∏° HTML ‡∏Ç‡∏≠‡∏á‡∏°‡∏∂‡∏á)
    $("dailyList").innerHTML = listHtml || "<center style='padding:40px; opacity:0.3;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";

    // 5. ‡πÅ‡∏ñ‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏á (‡∏û‡πà‡∏ô‡πÅ‡∏Ñ‡πà‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÑ‡∏°‡πà‡πÅ‡∏ñ‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡πâ‡∏°)
    const b = $("settleBar"); 
    let statusTxt = "";
    if (tot === 0) { statusTxt = "üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô"; b.className = "status-bar status-blue"; } 
    else if (settle > 0) { statusTxt = `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle).toLocaleString()}`; b.className = "status-bar status-red"; } 
    else if (settle < 0) { statusTxt = `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle)).toLocaleString()}`; b.className = "status-bar status-indigo"; } 
    else { statusTxt = "‚úÖ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÄ‡∏õ‡πä‡∏∞"; b.className = "status-bar status-green"; }
    
    b.innerHTML = `<span style="font-weight:700; font-size:13px;">${statusTxt}</span>`;
}
    function sendDailyListToLine() {
    const d = document.getElementById("dateInp").value;
    const today = db.filter(r => r.date === d);
    
    if (today.length === 0) {
        alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà!");
        return;
    }
    let listText = `üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (${d})\n`;
    today.sort((a, b) => a.time.localeCompare(b.time)).forEach((r, idx) => {
        listText += `${idx + 1}. ${r.time} | ${r.svcs.join('+')} | ‡∏ø${r.price}\n`;
    });

    window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(listText)}`;
}
    function clearAccount() {
        const currentTodaySettle = Number($("accTodayVal").innerText.replace('‡∏ø','').replace(',','')) || 0;
        const net = (account.balance || 0) + currentTodaySettle;
        if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô ‡∏ø${net} ?`)) {
            account.logs.unshift({ date: $("accDate").value, amount: net, note: $("accNote").value });
            account.balance = 0; 
            localStorage.setItem("barber_account", JSON.stringify(account));
            alert("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            renderDay();
        }
    }
    function toggleAccHistory() {
        const w = $("accHistoryWrapper");
        w.style.display = w.style.display === "none" ? "block" : "none";
        $("accHistory").innerHTML = account.logs.map(l => `<div style="padding:5px; border-bottom:1px solid #eee;">${l.date}: ‡∏ø${l.amount} (${l.note})</div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";
    }
function closeDay() {
    const d = document.getElementById("dateInp").value;
    const today = db.filter(r => r.date === d);
    
    if (today.length === 0) {
        alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏à‡∏∞‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏ô‡∏∞‡πÑ‡∏≠‡πâ‡∏ä‡∏≤‡∏¢!");
        return;
    }

    // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏£‡∏á‡∏ú‡∏°
    let total = 0, trans = 0, cash = 0;
    let sStats = {};

    today.forEach(r => {
        total += r.price;
        if (r.pay === 'Trans') trans += r.price; else cash += r.price;
        
        if (r.svcs) {
            r.svcs.forEach(s => {
                let name = s.trim();
                if (name) sStats[name] = (sStats[name] || 0) + 1;
            });
        }
    });

    let shopNet = (total * 0.5) - 200; // ‡∏™‡∏π‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô 200 ‡∏Ç‡∏≠‡∏á‡∏°‡∏∂‡∏á
    let bEarn = total - shopNet;

    // 2. ‡∏õ‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (‡πÄ‡∏≠‡∏≤‡πÅ‡∏ö‡∏ö‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡πÉ‡∏ô LINE)
    let statsText = Object.entries(sStats).map(([name, count]) => `‚Ä¢ ${name}: ${count}`).join('\n');
    
    let msg = `üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏ú‡∏° (${d})\n` +
              `------------------------------\n` +
              `üíá ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏£‡∏á‡∏ú‡∏°:\n${statsText}\n` +
              `------------------------------\n` +
              `üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ‡∏ø${total.toLocaleString()}\n` +
              `üí≥ ‡πÇ‡∏≠‡∏ô: ‡∏ø${trans.toLocaleString()} | üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î: ‡∏ø${cash.toLocaleString()}\n` +
              `------------------------------\n` +
              `üíà ‡∏™‡πà‡∏ß‡∏ô‡∏ä‡πà‡∏≤‡∏á: ‡∏ø${Math.floor(bEarn).toLocaleString()}\n` +
              `üè† ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πâ‡∏≤‡∏ô (‡∏´‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô): ‡∏ø${Math.floor(shopNet).toLocaleString()}\n` +
              `------------------------------\n` +
              `‚úÖ ‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`;

    // 3. ‡∏¢‡∏¥‡∏á‡πÑ‡∏õ LINE
    const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
    window.open(lineUrl, '_blank');

    // 4. ‡∏™‡∏±‡πà‡∏á‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ 3 (‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô)
    go(3);
}
    function loadHistDaily() {
        const d = $("histDate").value;
        const data = db.filter(r => r.date === d);
        $("histDailyArea").innerHTML = data.map(r => `<div class="history-row" style="padding:8px; border-bottom:1px solid #eee;">${r.time} - ${r.svcs.join('+')} <b>‡∏ø${r.price}</b></div>`).join('') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
    }
    
    function shareLine() {
        const msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${$("dTotal").innerText}\n‡∏ä‡πà‡∏≤‡∏á: ${$("dBarber").innerText}\n‡∏£‡πâ‡∏≤‡∏ô: ${$("dShop").innerText}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
  
function saveDB() { localStorage.setItem("barber_db", JSON.stringify(db)); localStorage.setItem("barber_conf", JSON.stringify(conf)); }
function go(n) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); if(document.getElementById('p'+n)) document.getElementById('p'+n).classList.add('active'); if(document.getElementById('n'+n)) document.getElementById('n'+n).classList.add('active'); renderDay(); }
function delRec(id) { if (confirm("‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà?")) { db = db.filter(r => r.id !== id); saveDB(); renderDay(); } }

  
</script>
</body>
</html>
