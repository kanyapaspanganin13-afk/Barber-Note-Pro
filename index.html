<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.2.3.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
Â     </style>
        :root { --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; --warning: #f59e0b; }
Â  Â  Â  Â  * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
Â  Â  Â  Â  body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }
Â  Â  Â  Â  .container { padding: 10px; max-width: 500px; margin: auto; }
Â  Â  Â  Â  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
Â  Â  Â  Â  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
Â  Â  Â  Â  .icon-card { position: relative; border-radius: 12px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1.5px solid transparent; background: #fff; }
Â  Â  Â  Â  .icon-card span:first-child { font-size: 18px; }
Â  Â  Â  Â  .icon-card span:last-child { font-size: 10px; font-weight: 800; }
Â  Â  Â  Â  input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 12px; font-size: 14px; background: #f1f5f9; outline: none; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .price-box { font-size: 60px; font-weight: 800; text-align: center; color: #64748b; padding: 15px; border: 2px solid var(--primary); border-radius: 20px; margin-bottom: 15px; width: 100%; background: #fff; display: block; height: 100px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn { border: none; padding: 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 600; transition: 0.2s; }
Â  Â  Â  Â  .btn:active { transform: scale(0.95); }
Â  Â  Â  Â  .btn-pay { background: #e2e8f0; color: #64748b; border: 2px solid transparent; height: 60px; font-size: 16px; }
Â  Â  Â  Â  .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
Â  Â  Â  Â  .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }
Â  Â  Â  Â  .btn-main { background: var(--primary); color: white; width: 100%; height: 80px; border-radius: 20px; font-size: 32px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .nav { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid var(--border); z-index: 1000; }
Â  Â  Â  Â  .nav-item { border: none; background: none; color: #94a3b8; font-size: 11px; display: flex; flex-direction: column; align-items: center; gap: 4px; flex: 1; cursor: pointer; }
Â  Â  Â  Â  .nav-item.active { color: var(--primary); }
Â  Â  Â  Â  .nav-item i { font-size: 22px; }
        .page { display: none; } .page.active { display: block; }
    .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 14px; }
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
    .modal-content { background: #fff; padding: 20px; border-radius: 25px; width: 100%; max-width: 400px; }
</style>
</head>
<body>

<div class="container">
    <h2 id="shopNameDisp" style="text-align:center; color:var(--primary); margin: 10px 0;">Barber Shop</h2>
    
 <div class="grid-3">
    <div class="icon-card" style="background: #fffbeb; border-color: #fde68a;" onclick="handleInsurance()">
        <span>ğŸ›¡ï¸</span><span style="color: #b45309;">à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰</span>
    </div>
    <div class="icon-card" style="background: #fff1f2; border-color: #fecdd3;" onclick="handleHoliday()">
        <span>ğŸ–ï¸</span><span style="color: #be185d;">à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”</span>
    </div>
    <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1;" onclick="openSettings()">
        <span>âš™ï¸</span><span style="color: #475569;">à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š</span>
    </div>
</div>

        <div class="grid-3">
            <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1; padding: 5px; height: 50px;">
                <span id="dateDisplay" style="font-size: 12px; font-weight: 700;">à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ</span>
                <input type="date" id="dateInp" onchange="updateDateDisplay(this.value)" style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer;">
            </div>
            <input type="time" id="tStart" placeholder="à¹€à¸£à¸´à¹ˆà¸¡" style="text-align:center; height: 50px;">
            <input type="time" id="tEnd" placeholder="à¹€à¸ªà¸£à¹‡à¸ˆ" style="text-align:center; height: 50px;">
        </div>

        <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 12px;">
            <select id="hairStyle" style="height: 50px;">
                <option value="">ğŸ’‡ à¹€à¸¥à¸·à¸­à¸à¸—à¸£à¸‡à¸œà¸¡</option>
                <option value="à¹€à¸”à¹‡à¸">ğŸ‘¶ à¸•à¸±à¸”à¸œà¸¡à¹€à¸”à¹‡à¸</option>
                <option>à¸£à¸­à¸‡à¸—à¸£à¸‡</option><option>à¹à¸Ÿà¸Šà¸±à¹ˆà¸™</option><option>à¸ªà¸à¸´à¸™à¹€à¸Ÿà¸”</option><option>à¹€à¸›à¸´à¸”à¸‚à¹‰à¸²à¸‡</option><option>à¸•à¸³à¸£à¸§à¸ˆ/à¸—à¸«à¸²à¸£</option><option>à¸—à¸£à¸‡à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™</option>
                <option>à¹à¸à¹‰à¸œà¸¡</option><option>à¹‚à¸à¸™à¸œà¸¡</option></select>
            <select id="extra1" style="height: 50px;">
                <option value="">à¸šà¸£à¸´à¸à¸²à¸£ 1</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡</option><option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡</option> </select>
            <select id="extra2" style="height: 50px;">
                <option value="">à¸šà¸£à¸´à¸à¸²à¸£ 2</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡</option><option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡</option></select>
        </div>
        <input type="number" id="priceInp" class="price-box" placeholder="0" inputmode="numeric">
        <div class="grid-2">
            <button id="btnCash" class="btn btn-pay" onclick="selectPay('Cash')">ğŸ’µ à¹€à¸‡à¸´à¸™à¸ªà¸”</button>
            <button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">ğŸ“± à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™</button>
        </div>
        <button id="mainSaveBtn" class="btn btn-main" onclick="handleSave()"><i class="fas fa-save"></i></button>
    </div>

    <div id="p2" class="page">
        <div class="grid-2"><div class="card" style="text-align: center;">
                <label style="font-size: 13px; opacity: 0.8;">à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¸£à¸§à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰</label>
                <div id="dTotal" style="font-size:32px; font-weight:800; color:var(--primary);">0</div>
                <div id="dCounts" style="font-size:14px; font-weight:600; color:#64748b; margin-top:5px;">à¸¥à¸¹à¸à¸„à¹‰à¸²: 0 à¸„à¸™</div>
            </div>
            <div class="card" style="display: flex; flex-direction: column; justify-content: center; gap: 5px;">
                <div style="font-size:15px; font-weight:600;">ğŸ“± à¹‚à¸­à¸™: <b id="dTrans" style="color:#0284c7">0</b></div>
                <div style="font-size:15px; font-weight:600;">ğŸ¤µ à¸Šà¹ˆà¸²à¸‡: <b id="dBarber" style="color:var(--accent)">0</b></div>
                <div style="font-size:15px; font-weight:600;">ğŸ  à¸£à¹‰à¸²à¸™: <b id="dShop" style="color:var(--warning)">0</b></div>
            </div>
        </div>
        <div id="settleBar" class="status-bar status-indigo">à¸¢à¸­à¸”à¸à¸­à¸”à¸µ</div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <label style="font-weight: 600;">ğŸ“‹ à¸£à¸²à¸¢à¸à¸²à¸£à¸§à¸±à¸™à¸™à¸µà¹‰</label>
                <button onclick="shareLine()" style="background:#06C755; color:white; border:none; padding:8px 12px; border-radius:8px; font-size:12px;"><i class="fab fa-line"></i> à¸ªà¹ˆà¸‡ LINE</button>
            </div>
            <div id="dailyList"></div>
        </div>
        <button onclick="go(3)" style="position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--primary); color: white; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 24px;">
            <i class="fas fa-check-circle"></i>
        </button>
    </div>

    <div id="p3" class="page">
        <div class="acc-main-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; font-size:16px; color:#b45309;"><i class="fas fa-wallet"></i> à¸ªà¸£à¸¸à¸›à¸¢à¸­à¸”à¸šà¸±à¸à¸Šà¸µà¸ªà¸¸à¸—à¸˜à¸´</h3>
                <div id="accLight" style="background:gray; width:12px; height:12px; border-radius:50%;"></div>
            </div>
            <div style="font-size:13px; color:#64748b; margin:15px 0; background:rgba(0,0,0,0.03); padding:12px; border-radius:15px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>à¸¢à¸­à¸”à¸„à¹‰à¸²à¸‡à¹€à¸”à¸´à¸¡:</span><b id="accOldVal">à¸¿0</b></div>
                <div style="display:flex; justify-content:space-between;"><span>à¸¢à¸­à¸”à¸§à¸±à¸™à¸™à¸µà¹‰:</span><b id="accTodayVal" style="color:var(--primary)">à¸¿0</b></div>
            </div>
            <div style="text-align:center; margin:20px 0;">
                <div style="font-size:14px; opacity:0.6;">à¸ªà¸–à¸²à¸™à¸°à¸šà¸±à¸à¸Šà¸µ</div>
                <div style="font-size:48px; font-weight:900; color:var(--primary);">à¸¿<span id="accNet">0</span></div>
            </div>
            <div id="accStatus" class="status-bar">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>
            <button class="btn" onclick="toggleAccHistory()" style="width:100%; border:1px dashed var(--primary); background:#f0f7ff; color:var(--primary); margin-bottom:15px;">à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™</button>
            <div id="accHistoryWrapper" style="display:none; margin-bottom:15px;"><div id="accHistory" class="card" style="font-size:12px; max-height:150px; overflow:y:auto;"></div></div>
            <div style="background:#f8fafc; padding:15px; border-radius:20px; border:1px solid var(--border);">
                <input type="date" id="accDate" style="margin-bottom:10px;">
                <input type="text" id="accNote" placeholder="à¸šà¸±à¸™à¸—à¸¶à¸à¸Šà¹ˆà¸§à¸¢à¸ˆà¸³" style="margin-bottom:10px;">
                <button class="btn-save" onclick="clearAccount()">âœ… à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™</button>
            </div>
        </div>
        <div class="card" style="margin-top:20px;">
            <label>ğŸ“… à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸£à¸²à¸¢à¸§à¸±à¸™</label>
            <input type="date" id="histDate" onchange="loadHistDaily()" style="margin:10px 0;">
            <div id="histDailyArea"></div>
        </div>
    </div>
<div id="modalSet" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--primary);">âš™ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š</h3> <label style="font-size:11px; font-weight:600;">à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™</label> <input id="setShop" style="margin-bottom:10px;">
        <div class="grid-2">
            <div>
                <label style="font-size:11px; font-weight:600;">% à¸Šà¹ˆà¸²à¸‡</label><input type="number" id="setPerc" placeholder="à¹€à¸Šà¹ˆà¸™ 50"></div>
            <div>
                <label style="font-size:11px; font-weight:600;">à¸›à¸£à¸°à¸à¸±à¸™/à¸§à¸±à¸™</label> <input type="number" id="setGuar" placeholder="0"></div>
        </div>
        
        <div style="margin-top:10px">
            <label style="font-size:11px; font-weight:600;">à¸˜à¸µà¸¡à¹à¸­à¸›</label>
            <select id="setTheme">
                <option value="neon-light">ğŸŒ¤ Neon Light (Default)</option> <option value="deep-navy">ğŸŒŒ Deep Navy</option> <option value="barber-dark">ğŸŒ‘ Barber Dark</option> </select>
        </div>
        <div class="grid-2" style="margin-top:10px">
            <div>
                <label style="font-size:11px; font-weight:600;">à¸£à¸°à¸šà¸šà¹€à¸ªà¸µà¸¢à¸‡</label> <select id="setSound"> <option value="on">ğŸ”Š à¹€à¸›à¸´à¸”</option> <option value="off">ğŸ”‡ à¸›à¸´à¸”</option></select>
            </div>
            <div>
                <label style="font-size:11px; font-weight:600;">à¹€à¸ªà¸µà¸¢à¸‡à¸à¸¹à¸”</label><select id="setVoice"> <option value="female">ğŸ‘© à¸«à¸à¸´à¸‡</option> <option value="male">ğŸ‘¨ à¸Šà¸²à¸¢</option></select>
            </div>
        </div>
        <div class="grid-2" style="margin-top:20px">
            <button class="btn" style="background:var(--primary); color:#fff" onclick="saveSettings()">à¸šà¸±à¸™à¸—à¸¶à¸</button><button class="btn" style="background:#e2e8f0; color:var(--text)" onclick="closeSettings()">à¸›à¸´à¸”</button>
        </div>
         <button class="btn" style="width:100%; background:var(--danger); color:#fff; margin-top:10px; font-size:12px;" onclick="clearAllData()">âš ï¸ à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
    </div>
</div>
    <nav class="nav">
        <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>à¸šà¸±à¸™à¸—à¸¶à¸</div>
        <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-file-invoice"></i>à¸£à¸²à¸¢à¸‡à¸²à¸™</div>
        <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-wallet"></i>à¸šà¸±à¸à¸Šà¸µ</div>
    </nav>
</div>

<script>
    let db = JSON.parse(localStorage.getItem("barber_db")) || [];
    let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
    let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
    let payMethod = "";

    const $ = (id) => document.getElementById(id);

    window.onload = () => {
        const today = new Date().toISOString().split('T')[0];
        $("dateInp").value = today;
        $("accDate").value = today;
        $("histDate").value = today;
        updateDateDisplay(today);
    };

    function go(n) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        $(`p${n}`).classList.add('active');
        $(`n${n}`).classList.add('active');
        renderDay();
    }
    function handleInsurance() {
    const today = document.getElementById('dateInp').value;
    const guaranteeAmount = parseInt(db.settings.guar) || 0; // à¸”à¸¶à¸‡à¸„à¹ˆà¸²à¸›à¸£à¸°à¸à¸±à¸™à¸•à¹ˆà¸­à¸§à¸±à¸™à¸ˆà¸²à¸à¸—à¸µà¹ˆà¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹„à¸§à¹‰

    if (guaranteeAmount <= 0) {
        alert("âš ï¸ à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸¢à¸­à¸”à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰à¹ƒà¸™à¹€à¸¡à¸™à¸¹ 'à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š' à¸à¹ˆà¸­à¸™");
        return;
    }
    // à¸à¸£à¸­à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸‰à¸à¸²à¸°à¸‚à¸­à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸
    const todayRecords = db.records.filter(r => r.date === today);
    // à¸£à¸§à¸¡à¸¢à¸­à¸”à¸ªà¹ˆà¸§à¸™à¹à¸šà¹ˆà¸‡à¸‚à¸­à¸‡à¸Šà¹ˆà¸²à¸‡ (Barber Share) à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸‚à¸­à¸‡à¸§à¸±à¸™à¸™à¸µà¹‰
    const totalBarberShare = todayRecords.reduce((sum, r) => sum + (r.barberShare || 0), 0);

    if (totalBarberShare < guaranteeAmount) {
        const diff = guaranteeAmount - totalBarberShare;
        alert(`ğŸ›¡ï¸ à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰à¸§à¸±à¸™à¸—à¸µà¹ˆ ${today}\n------------------------\nà¸¢à¸­à¸”à¸Šà¹ˆà¸²à¸‡à¸—à¸³à¹„à¸”à¹‰: ${totalBarberShare} à¸šà¸²à¸—\nà¸›à¸£à¸°à¸à¸±à¸™à¹„à¸§à¹‰à¸—à¸µà¹ˆ: ${guaranteeAmount} à¸šà¸²à¸—\n\nâœ… à¸£à¹‰à¸²à¸™à¸•à¹‰à¸­à¸‡à¸ˆà¹ˆà¸²à¸¢à¹€à¸•à¸´à¸¡à¹ƒà¸«à¹‰à¸Šà¹ˆà¸²à¸‡: ${diff} à¸šà¸²à¸—`);
    } else {
        alert(`ğŸ›¡ï¸ à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰à¸§à¸±à¸™à¸—à¸µà¹ˆ ${today}\n------------------------\nà¸¢à¸­à¸”à¸Šà¹ˆà¸²à¸‡à¸—à¸³à¹„à¸”à¹‰: ${totalBarberShare} à¸šà¸²à¸—\n(à¹€à¸à¸´à¸™à¸¢à¸­à¸”à¸›à¸£à¸°à¸à¸±à¸™ ${guaranteeAmount} à¸šà¸²à¸—à¹à¸¥à¹‰à¸§ ğŸ‰)`);
    }
}

// --- 2. à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸” ---
function handleHoliday() {
    const today = document.getElementById('dateInp').value;
    if (!today) return alert("à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸à¹ˆà¸­à¸™");

    if (confirm(`à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸à¹ƒà¸«à¹‰à¸§à¸±à¸™à¸—à¸µà¹ˆ ${today} à¹€à¸›à¹‡à¸™ "à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”"?`)) {
        const holidayRecord = {
            id: Date.now(),
            date: today,
            style: "ğŸ–ï¸ à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”",
            price: 0,
            method: "N/A",
            barberShare: 0,
            shopShare: 0
        };
        db.records.push(holidayRecord);
        saveDB();
        alert("à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢");
        updateReportPage(); // à¸­à¸±à¸›à¹€à¸”à¸•à¸•à¸²à¸£à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸—à¸±à¸™à¸—à¸µ
    }
}
    // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸šà¸±à¸™à¸—à¸¶à¸à¸„à¹ˆà¸²à¸ˆà¸²à¸à¸Ÿà¸­à¸£à¹Œà¸¡à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²
function saveSettings() {
    db.settings.shopName = document.getElementById('setShop').value || "Barber Shop";
    db.settings.perc = parseInt(document.getElementById('setPerc').value) || 50;
    db.settings.guar = parseInt(document.getElementById('setGuar').value) || 0;

    saveDB(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸¥à¸‡ LocalStorage
    document.getElementById('shopNameDisp').innerText = db.settings.shopName;
    
    alert("âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢");
    closeSettings(); // à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²
}

// à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² (à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸²à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™à¸¥à¸‡à¹ƒà¸™à¸Šà¹ˆà¸­à¸‡)
function openSettings() {
    document.getElementById('setShop').value = db.settings.shopName;
    document.getElementById('setPerc').value = db.settings.perc;
    document.getElementById('setGuar').value = db.settings.guar;
    
    // à¹à¸ªà¸”à¸‡à¸ªà¹ˆà¸§à¸™à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š (à¹€à¸Šà¹ˆà¸™ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ class à¹ƒà¸«à¹‰ active à¸«à¸£à¸·à¸­ display: block)
    document.getElementById('modalSet').style.display = 'block'; 
}
    function closeSettings() {
        $("modalSet").style.display = "none";
    }


    function clearAllData() {
        if (confirm("à¸„à¸¸à¸“à¹à¸™à¹ˆà¹ƒà¸ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”? à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸«à¸²à¸¢à¸–à¸²à¸§à¸£!")) {
            localStorage.clear();
            location.reload();
        }
    }
    function updateDateDisplay(val) {
        const d = new Date(val);
        $("dateDisplay").innerText = d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
        renderDay();
    }

    function selectPay(m) {
        payMethod = m;
        $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;
        $("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;
    }

    function handleSave() {
        const p = $("priceInp").value;
        if (!p || !payMethod) { alert("à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸£à¸²à¸„à¸²à¹à¸¥à¸°à¹€à¸¥à¸·à¸­à¸à¸§à¸´à¸˜à¸µà¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™"); return; }
        const r = {
            id: Date.now(),
            date: $("dateInp").value,
            time: $("tStart").value || new Date().toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'}),
            svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(s => s),
            price: Number(p),
            pay: payMethod
        };
        db.push(r);
        localStorage.setItem("barber_db", JSON.stringify(db));
        $("priceInp").value = "";
        selectPay("");
        renderDay();
        alert("à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸³à¹€à¸£à¹‡à¸ˆ âœ…");
    }

    function renderDay() {
        const d = $("dateInp").value;
        const today = db.filter(r => r.date === d);
        let tot = 0, trans = 0, cash = 0, listHtml = "";

        today.forEach(r => {
            tot += r.price;
            r.pay === 'Trans' ? trans += r.price : cash += r.price;
            listHtml += `<div class="history-row">
                <span><b>${r.time}</b> | ${r.svcs.join('+')}</span>
                <span>à¸¿${r.price} <i class="fas fa-trash" style="color:red; margin-left:10px" onclick="delRec(${r.id})"></i></span>
            </div>`;
        });

        const bEarn = Math.max(tot * (conf.perc / 100), conf.guar);
        const sEarn = tot - bEarn;
        const settle = cash - bEarn;

        if($("dTotal")) $("dTotal").innerText = tot.toLocaleString();
        if($("dTrans")) $("dTrans").innerText = trans.toLocaleString();
        if($("dBarber")) $("dBarber").innerText = Math.floor(bEarn).toLocaleString();
        if($("dShop")) $("dShop").innerText = Math.floor(sEarn).toLocaleString();
        if($("dCounts")) $("dCounts").innerText = `à¸¥à¸¹à¸à¸„à¹‰à¸²: ${today.length} à¸„à¸™`;
        $("dailyList").innerHTML = listHtml || "<center style='opacity:0.3;padding:20px'>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>";

        const net = (account.balance || 0) + settle;
        $("accOldVal").innerText = `à¸¿${(account.balance || 0).toLocaleString()}`;
        $("accTodayVal").innerText = `à¸¿${Math.floor(settle).toLocaleString()}`;
        $("accNet").innerText = Math.abs(net).toLocaleString();
        $("accLight").style.background = net > 0 ? "red" : net < 0 ? "blue" : "green";
        $("accStatus").innerText = net > 0 ? "ğŸš© à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¸£à¹‰à¸²à¸™" : net < 0 ? "ğŸš© à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡" : "âœ… à¸¢à¸­à¸”à¸¥à¸‡à¸•à¸±à¸§";
        $("accStatus").className = "status-bar " + (net > 0 ? "status-red" : net < 0 ? "status-indigo" : "status-green");
    }

    function delRec(id) {
        if (confirm("à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸™à¸µà¹‰?")) {
            db = db.filter(r => r.id !== id);
            localStorage.setItem("barber_db", JSON.stringify(db));
            renderDay();
        }
    }

    function clearAccount() {
        const net = (account.balance || 0) + (Number($("accTodayVal").innerText.replace('à¸¿','')) || 0);
        if (confirm(`à¸¢à¸·à¸™à¸¢à¸±à¸™à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™ à¸¿${net} ?`)) {
            account.logs.unshift({ date: $("accDate").value, amount: net, note: $("accNote").value });
            account.balance = 0; 
            localStorage.setItem("barber_account", JSON.stringify(account));
            alert("à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸¢à¸­à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!");
            renderDay();
        }
    }

    function toggleAccHistory() {
        const w = $("accHistoryWrapper");
        w.style.display = w.style.display === "none" ? "block" : "none";
        $("accHistory").innerHTML = account.logs.map(l => `<div>${l.date}: à¸¿${l.amount} (${l.note})</div>`).join('') || "à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´";
    }

    function loadHistDaily() {
        const d = $("histDate").value;
        const data = db.filter(r => r.date === d);
        $("histDailyArea").innerHTML = data.map(r => `<div class="history-row">${r.time} - ${r.svcs.join('+')} <b>à¸¿${r.price}</b></div>`).join('') || "à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥";
    }
    
    function shareLine() {
        const msg = `ğŸ’ˆ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸£à¹‰à¸²à¸™\nà¸¢à¸­à¸”à¸£à¸§à¸¡: ${$("dTotal").innerText}\nà¸Šà¹ˆà¸²à¸‡: ${$("dBarber").innerText}\nà¸£à¹‰à¸²à¸™: ${$("dShop").innerText}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
</script>
</body>
</html>
