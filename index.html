<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BarberNote">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro V.04 </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker.register("./service-worker.js")
                    .then(reg => console.log("âœ… à¸£à¸°à¸šà¸šà¸­à¸­à¸Ÿà¹„à¸¥à¸™à¹Œà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™!"))
                    .catch(err => console.error("âŒ SW error:", err));
            });
        }
    </script>
</head>
<style>
    /* 1. à¸•à¸±à¸§à¹à¸›à¸£à¸«à¸¥à¸±à¸ */
    :root { 
        --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; 
        --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0;
    }
    /* 2. à¸£à¸°à¸šà¸šà¸˜à¸µà¸¡ (à¸•à¹‰à¸­à¸‡à¸­à¸¢à¸¹à¹ˆà¸šà¸™à¸ªà¸¸à¸”à¹€à¸à¸·à¹ˆà¸­à¹€à¸•à¸£à¸µà¸¢à¸¡à¸•à¸±à¸§à¹à¸›à¸£) */
    body.navy { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --accent: #38bdf8; }
    body.dark { --bg: #121212; --card: #1a1a1a; --text: #fbbf24; --accent: #fbbf24; }

    /* 3. à¸£à¸µà¹€à¸‹à¹‡à¸•à¸à¸·à¹‰à¸™à¸à¸²à¸™ */
    * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body { 
        margin: 0; background: var(--bg); color: var(--text); 
        padding-bottom: 90px; overflow-x: hidden; transition: all 0.3s ease; 
    }

    /* 4. à¸£à¸°à¸šà¸šà¹€à¸¥à¸¢à¹Œà¹€à¸­à¸²à¸•à¹Œ (Layout & Page) */
    .container { padding: 15px; max-width: 500px; margin: auto; position: relative; z-index: 1; }
    .page { display: none; } 
    .page.active { display: block; }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 8px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; margin-bottom: 8px; }

    /* 5. à¹€à¸¡à¸™à¸¹à¸šà¸²à¸£à¹Œ (à¹à¸à¹‰à¸—à¸µà¹ˆà¸‹à¹‰à¸³à¸‹à¹‰à¸­à¸™à¹€à¸«à¸¥à¸·à¸­à¸Šà¸¸à¸”à¹€à¸”à¸µà¸¢à¸§) */
    nav {
        position: fixed; bottom: 0; left: 0; right: 0;
        background: #1a237e !important; /* à¸ªà¸µà¸à¸£à¸¡à¸—à¹ˆà¸²à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡ */
        display: flex; justify-content: space-around; 
        height: 75px; align-items: center;
        box-shadow: 0 -10px 30px rgba(0,0,0,0.4); 
        z-index: 99999; border-top: 1px solid rgba(255,255,255,0.1);
        padding-bottom: env(safe-area-inset-bottom);
    }

    .nav-item { 
        flex: 1; text-align: center; color: rgba(255,255,255,0.5); 
        cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center;
    }

    .nav-item.active { color: #ffffff !important; opacity: 1; }
    
    .nav-item i { font-size: 22px; display: block; margin-bottom: 2px; }
    .nav-item span { font-size: 11px; font-weight: 700; }

    /* 6. à¸Ÿà¸­à¸£à¹Œà¸¡à¹à¸¥à¸°à¸­à¸´à¸™à¸à¸¸à¸• */
    .icon-card, input, select { background: var(--card); color: var(--text); }

    .icon-card { 
        border-radius: 15px; padding: 10px 2px; display: flex; flex-direction: column; 
        align-items: center; justify-content: center; gap: 4px; cursor: pointer; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); height: 75px; font-size: 14px; transition: 0.2s;
    }
    .icon-card:active { transform: scale(0.95); }

    input, select { 
        width: 100%; height: 75px; border-radius: 20px; font-size: 20px; font-weight: 700; 
        text-align: center; border: none; outline: none; box-shadow: 0 4px 10px rgba(0,0,0,0.03); 
        appearance: none; -webkit-appearance: none;
    }

    /* 7. à¸›à¸¸à¹ˆà¸¡à¹à¸¥à¸°à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ */
    .btn { 
        border: none; padding: 12px; border-radius: 15px; cursor: pointer; 
        display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.2s; 
    }
    .btn-save { background: var(--success); color: white; width: 100%; font-size: 16px; margin-top: 10px; }
    
    .btn-pay { background: #e2e8f0; color: #64748b; border: 2px solid transparent; height: 70px; font-size: 18px; width: 100%; }
    .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
    .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }

    /* 8. à¹‚à¸¡à¸”à¸­à¸¥à¹à¸¥à¸°à¸£à¸²à¸¢à¸‡à¸²à¸™ */
    .modal { 
        position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); 
        display: none; z-index: 1000000; align-items: center; justify-content: center; 
    }
    .modal-content { 
        background: var(--card); color: var(--text); width: 90%; max-width: 400px; 
        border-radius: 25px; padding: 25px; max-height: 85vh; overflow-y: auto; 
    }

    .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: 800; font-size: 14px; margin-bottom: 10px; }
    .acc-main-card { background: var(--card); padding: 20px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 15px; }
    #accHistory { font-size: 12px; max-height: 150px; overflow-y: auto; }
    @keyframes slideUp {
        from { transform: translateY(100%); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
</style>
</head>
<body>
<div class="container">
<div id="p1" class="page active" style="padding: 15px; background: #f8fafc;">
    <h2 id="shopNameDisp" style="text-align:center; color:#1e293b; font-weight:900; margin: 10px 0 20px 0; letter-spacing: 1px; text-transform: uppercase;">BARBER SHOP</h2>
    
    <div class="grid-3" style="gap: 12px; margin-bottom: 20px;">
        <div class="icon-card" style="background:#fff; border:none; box-shadow:0 8px 15px rgba(0,0,0,0.05); border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center;" onclick="handleInsurance()">
            <div style="background:linear-gradient(135deg, #fbbf24, #f59e0b); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                <i class="fas fa-shield-alt"></i>
            </div>
            <span style="color:#1e293b; font-weight:800; font-size:14px;">à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰</span>
        </div>
        
        <div class="icon-card" style="background:#fff; border:none; box-shadow:0 8px 15px rgba(0,0,0,0.05); border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center;" onclick="handleHoliday()">
            <div style="background:linear-gradient(135deg, #f87171, #ef4444); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                <i class="fas fa-umbrella-beach"></i>
            </div>
            <span style="color:#1e293b; font-weight:800; font-size:14px;">à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”</span>
        </div>

        <div class="icon-card" style="background:#fff; border:none; box-shadow:0 8px 15px rgba(0,0,0,0.05); border-radius:20px; height:90px; display:flex; flex-direction:column; align-items:center; justify-content:center;" onclick="openSettings()">
            <div style="background:linear-gradient(135deg, #94a3b8, #475569); width:38px; height:38px; border-radius:12px; display:flex; align-items:center; justify-content:center; margin-bottom:8px; color:#fff; font-size:18px;">
                <i class="fas fa-cog"></i>
            </div>
            <span style="color:#1e293b; font-weight:800; font-size:14px;">à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š</span>
        </div>
    </div>

   <div class="grid-3" style="gap:10px; margin-bottom:15px;">
        <div style="background:#fff; border-radius:18px; border:none; height:75px; position:relative; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
            <span id="dateDisplay" style="font-weight:800; color:#475569; font-size:18px;">ğŸ“… à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ</span>
           <input type="date" id="dateInp" onchange="document.getElementById('dateDisplay').innerText = this.value; if(window.updateDateDisplay) updateDateDisplay(this.value); renderDay();" style="position:absolute; opacity:0; width:100%; height:100%; cursor:pointer; z-index:2;">
        </div>
        <input type="time" id="tStart" style="height:75px; border-radius:22px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
        <input type="time" id="tEnd" style="height:75px; border-radius:22px; border:none; text-align:center; font-weight:700; background:#fff; color:#1e293b; box-shadow: 0 4px 10px rgba(0,0,0,0.03);">
    </div>
<div style="display: grid; grid-template-columns: 1.5fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
    <select id="hairStyle" style="height:70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#1e293b; box-shadow:0 4px 10px rgba(0,0,0,0.03); padding:0 10px;">
        <option value="">âœ‚ï¸ à¸—à¸£à¸‡à¸œà¸¡</option>
        <option>à¹à¸Ÿà¸Šà¸±à¹ˆà¸™</option><option>à¸ªà¸à¸´à¸™à¹€à¸Ÿà¸”</option><option>à¹€à¸›à¸´à¸”à¸‚à¹‰à¸²à¸‡</option><option>à¸£à¸­à¸‡à¸—à¸£à¸‡</option>
        <option>à¸•à¸³à¸£à¸§à¸ˆ/à¸—à¸«à¸²à¸£</option><option>à¸—à¸£à¸‡à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™</option><option>à¹à¸à¹‰à¸œà¸¡</option><option>à¹‚à¸à¸™à¸œà¸¡</option>
    </select>
    <select id="extra1" style="height:70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow:0 4px 10px rgba(0,0,0,0.03); padding:0 8px;">
        <option value="">à¸šà¸£à¸´à¸à¸²à¸£1</option>
        <option value="à¹€à¸”à¹‡à¸"> à¹€à¸”à¹‡à¸</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡</option><option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡</option>
    </select>
    <select id="extra2" style="height:70px; border-radius:14px; border:none; font-weight:700; background:#fff; color:#64748b; box-shadow:0 4px 10px rgba(0,0,0,0.03); padding:0 8px;">
        <option value="">à¸šà¸£à¸´à¸à¸²à¸£2</option>
        <option value="à¹€à¸”à¹‡à¸"> à¹€à¸”à¹‡à¸</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡</option><option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡</option>
    </select>
</div>

<div style="display: grid; grid-template-columns: 1.4fr 1fr; gap: 8px; margin: 10px 0;">
    <div style="position: relative; background: #ffffff; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.05);">
        <span style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 24px; color: #6366f1; font-weight: 900;">à¸¿</span>
        <input type="number" id="priceInp" placeholder="0" inputmode="numeric" 
            style="width: 100%; height: 85px !important; background: transparent !important; font-size: 45px !important; font-weight: 900 !important; color: #1e293b !important; padding-left: 40px !important; border: none !important;">
    </div>

    <input type="number" id="tipInp" placeholder="à¸—à¸´à¸›" inputmode="numeric" 
        style="width: 100%; height: 85px !important; background: #ccfbf1 !important; border-radius: 20px !important; font-size: 32px !important; font-weight: 900 !important; color: #0f766e !important; border: none !important;">
</div>

<div class="grid-2" style="display: grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
    <button id="btnCash" onclick="selectPay('Cash')" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #10b981, #059669); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(16,185,129,0.3); display:flex; align-items:center; justify-content:center; gap:10px;">
        <i class="fas fa-money-bill-wave"></i> à¹€à¸‡à¸´à¸™à¸ªà¸”
    </button>
    <button id="btnTrans" onclick="selectPay('Trans')" style="height:75px; border-radius:22px; border:none; background:linear-gradient(135deg, #6366f1, #4338ca); color:#fff; font-weight:900; font-size:22px; box-shadow:0 8px 20px rgba(99,102,241,0.3); display:flex; align-items:center; justify-content:center; gap:10px;">
        <i class="fas fa-qrcode"></i> à¸ªà¹à¸à¸™à¸ˆà¹ˆà¸²à¸¢
    </button>
</div>
<button class="btn-main" onclick="handleSave(event)" style="width:100%; height:90px; border-radius:28px; background:linear-gradient(135deg, #4338ca, #3730a3); color:#fff; border:none; box-shadow:0 15px 35px rgba(67,56,202,0.4); display:flex; align-items:center; justify-content:center; gap:15px;">
    <i class="fas fa-save" style="font-size: 38px;"></i>
    <span style="font-size: 32px; font-weight: 900; letter-spacing:1px;">à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</span>
</button>  
</div>
    <div id="p2" class="page" style="max-width:480px; margin:0 auto; padding: 15px; padding-bottom: 100px;">
Â  Â  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
Â  Â  Â  Â  <div style="background: #102d8d; padding:18px 15px; border-radius:20px; text-align:center; box-shadow:0 10px 15px -3px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);">
Â  Â  Â  Â  Â  Â  <small style="font-weight:800; color:#cbd5e1; text-transform: uppercase; letter-spacing: 0.5px;">à¸¢à¸­à¸”à¸£à¸§à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰</small>
Â  Â  Â  Â  Â  Â  <div id="dTotal" style="font-size:36px; font-weight:900; color:#cbd5e1; margin: 5px 0;">0</div>
Â  Â  Â  Â  Â  Â  <div id="dCounts" style="font-size:16px; font-weight:700; color:#cbd5e1; background:rgba(255,255,255,0.15); display:inline-block; padding:2px 10px; border-radius:10px;">à¸¥à¸¹à¸à¸„à¹‰à¸² 0 à¸„à¸™</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div style="background:#102d8d; padding:15px; border-radius:20px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); display:flex; flex-direction:column; justify-content:center; gap:8px;">
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; font-size:15px; font-weight:700;">
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:#cbd5e1;">ğŸ“± à¹‚à¸­à¸™:</span> <b id="dTrans" style="color:#ffffff;">0</b>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; font-size:15px; font-weight:700;">
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:#cbd5e1;">ğŸ’µ à¸ªà¸”:</span> <b id="dCash" style="color:#ffffff;">0</b>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; font-size:15px; font-weight:700;">
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:#cbd5e1;">ğŸ‘¨â€ğŸ¨ à¸Šà¹ˆà¸²à¸‡:</span> <b id="dBarber" style="color:#ffffff;">0</b>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; font-size:15px; font-weight:800; border-top: 1px dashed rgba(255,255,255,0.2); padding-top: 5px; margin-top: 2px;">
Â  Â  Â  Â  Â  Â  Â  Â  <span style="color:#cbd5e1;">ğŸ  à¸£à¹‰à¸²à¸™:</span> <b id="dShop" style="color:#ffffff;">0</b>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="settleBarContainer" style="margin-bottom:18px;"><div id="settleBar"></div> </div>
Â  Â  <div id="dServiceStats"></div>
Â  Â  <hr style="border:0; border-top:1px solid #e2e8f0; margin-top:15px;">
Â  Â  <div id="dailyList"></div>
</div>
<div id="p3" class="page" style="max-width:480px; margin:0 auto; padding: 12px; padding-bottom: 100px; background: #f8fafc;">
    <div class="card" style="background:#fff; border-radius:25px; padding:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); border:1px solid #fff; margin-bottom: 15px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <b style="font-size:22px; color:#92400e;"><i class="fas fa-wallet"></i> à¸ªà¸–à¸²à¸™à¸°à¸šà¸±à¸à¸Šà¸µ</b>
            <div id="accLight" style="background:#22c55e; width:10px; height:10px; border-radius:50%; box-shadow:0 0 8px #22c55e;"></div>
        </div>

        <div style="display:flex; gap:12px; margin-bottom:25px;">
            <div style="flex:1; background:#fff; border-radius:22px; padding:18px 10px; text-align:center; box-shadow: 0 8px 20px rgba(0,0,0,0.04); border: 1px solid #f1f5f9;">
                <small style="font-size:16px; color:#64748b; font-weight:700; text-transform:uppercase;">à¸„à¹‰à¸²à¸‡à¹€à¸”à¸´à¸¡</small>
                <b style="font-size:22px; color:#1e293b; font-weight:900; display:block;" id="accOldVal">à¸¿0</b>
            </div>
            <div style="flex:1; background:#fff; border-radius:22px; padding:18px 10px; text-align:center; box-shadow: 0 8px 20px rgba(0,0,0,0.04); border: 1px solid #f1f5f9;">
                <small style="font-size:16px; color:#64748b; font-weight:700; text-transform:uppercase;">à¸§à¸±à¸™à¸™à¸µà¹‰</small>
                <b style="font-size:22px; color:#1e293b; font-weight:900; display:block;" id="accTodayVal">à¸¿0</b>
            </div>
        </div>
            <div style="text-align:center; margin-bottom:20px;">
    <div style="font-size:48px; font-weight:900; color:#1a237e; letter-spacing:-1px;">à¸¿<span id="accNet">0</span></div>
    <div id="statusBadge" style="display:inline-block; padding:6px 16px; border-radius:20px; font-size:14px; font-weight:bold; margin-top:8px;">
        à¸à¸³à¸¥à¸±à¸‡à¸„à¸³à¸™à¸§à¸“...
    </div>
     </div>
        <div style="margin-bottom:15px;">
            <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; margin-bottom:8px; height:50px;">
                <i class="fas fa-calendar-alt" style="color:#6366f1;"></i>
                <input type="date" id="accDate" style="flex:1; border:none; background:none; font-size:16px; font-weight:600; padding-left:10px; outline:none;">
            </div>
            <div style="display:flex; align-items:center; background:#f1f5f9; border-radius:15px; padding:0 15px; height:50px;">
                <i class="fas fa-pen-nib" style="color:#94a3b8;"></i>
                <input type="text" id="accNote" placeholder="à¸šà¸±à¸™à¸—à¸¶à¸à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸..." style="flex:1; border:none; background:none; font-size:15px; padding-left:10px; outline:none;">
            </div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="clearAccount()" style="background:linear-gradient(135deg, #10b981, #059669); color:#fff; border:none; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800;">
                <i class="fas fa-check-double"></i> à¸¢à¸·à¸™à¸¢à¸±à¸™à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™
            </button>
            <button onclick="openHistoryModal()" style="background:#fff; color:#3b82f6; border:2px solid #3b82f6; border-radius:18px; padding:15px 5px; font-size:14px; font-weight:800;">
                <i class="fas fa-history"></i> à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™
            </button>
        </div>
    </div>
 <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
        <div onclick="$('histDate').showPicker()" style="background:linear-gradient(135deg, #f59e0b, #d97706); border-radius:25px; padding:20px 10px; text-align:center; color:#fff; position:relative; box-shadow:0 8px 15px rgba(245,158,11,0.2);">
            <i class="fas fa-search-dollar" style="font-size:28px; margin-bottom:5px; display:block;"></i>
            <b style="font-size:16px;">à¹€à¸£à¸µà¸¢à¸à¸”à¸¹à¸£à¸²à¸¢à¸§à¸±à¸™</b>
            <input type="date" id="histDate" onchange="loadHistDaily()" style="position:absolute; inset:0; opacity:0;">
        </div>
        <div onclick="$('histMonth').showPicker()" style="background:linear-gradient(135deg, #6366f1, #4338ca); border-radius:25px; padding:20px 10px; text-align:center; color:#fff; position:relative; box-shadow:0 8px 15px rgba(99,102,241,0.2);">
            <i class="fas fa-calendar-check" style="font-size:28px; margin-bottom:5px; display:block;"></i>
            <b style="font-size:16px;">à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™</b>
            <input type="month" id="histMonth" onchange="loadHistMonth()" style="position:absolute; inset:0; opacity:0;">
        </div>
    </div>
</div>
<div id="modalSet" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); backdrop-filter:blur(15px); -webkit-backdrop-filter:blur(15px); z-index:9999; display:flex; align-items:center; justify-content:center; padding:15px;">
    
    <div style="background:#ffffff; width:95%; max-width:420px; border-radius:35px; display:flex; flex-direction:column; overflow:hidden; animation: slideUp 0.3s ease-out; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
        
        <div style="padding:25px 20px 15px; text-align:center;">
            <h3 style="margin:0; font-size:24px; color:#1e3a8a; font-weight:900;">âš™ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š</h3>
        </div>

        <div style="padding:10px 25px 35px;">
            <input type="text" id="setShop" placeholder="à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700; color:#1e3a8a; margin-bottom:12px; outline:none;">

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px;">
                <input type="number" id="setPerc" placeholder="% à¸Šà¹ˆà¸²à¸‡" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700; outline:none;">
                <input type="number" id="setGuar" placeholder="à¸›à¸£à¸°à¸à¸±à¸™" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:18px; font-weight:700; outline:none;">
            </div>

            <div style="margin-bottom:12px;">
                <select id="setTheme" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:16px; font-weight:700; color:#475569; outline:none;">
                    <option value="light">ğŸŒ¤ à¸˜à¸µà¸¡à¸ªà¸§à¹ˆà¸²à¸‡</option>
                    <option value="navy">ğŸŒŒ à¸˜à¸µà¸¡à¸™à¹‰à¸³à¹€à¸‡à¸´à¸™</option>
                    <option value="dark">ğŸŒ‘ à¸˜à¸µà¸¡à¸”à¸³-à¸—à¸­à¸‡</option>
                </select>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:20px;">
                 <select id="setSound" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:15px; font-weight:700; outline:none;">
                    <option value="on">ğŸ”” à¹€à¸›à¸´à¸”à¹€à¸ªà¸µà¸¢à¸‡</option>
                    <option value="off">ğŸ”• à¸›à¸´à¸”à¹€à¸ªà¸µà¸¢à¸‡</option>
                </select>
                <select id="setVoice" style="width:100%; height:55px; border-radius:18px; border:1px solid #e2e8f0; background:#f1f5f9; text-align:center; font-size:15px; font-weight:700; outline:none;">
                    <option value="female">ğŸ‘¸ à¹€à¸ªà¸µà¸¢à¸‡à¸«à¸à¸´à¸‡</option>
                    <option value="male">ğŸ¤µ à¹€à¸ªà¸µà¸¢à¸‡à¸Šà¸²à¸¢</option>
                </select>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; margin-bottom:25px;">
                <button onclick="exportBackup()" style="height:45px; background:#fff; border:1px solid #cbd5e1; border-radius:12px; font-size:13px; font-weight:800; color:#475569;"><i class="fas fa-file-download"></i> à¸ªà¸³à¸£à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
                <button onclick="importBackup()" style="height:45px; background:#fff; border:1px solid #cbd5e1; border-radius:12px; font-size:13px; font-weight:800; color:#475569;"><i class="fas fa-file-upload"></i> à¸„à¸·à¸™à¸„à¹ˆà¸²</button>
                <button onclick="clearData()" style="height:45px; background:#fff1f2; border:1px solid #fecaca; border-radius:12px; font-size:13px; font-weight:800; color:#e11d48;"><i class="fas fa-trash-alt"></i> à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
            </div>

            <div style="display:grid; grid-template-columns: 2fr 1.2fr; gap:12px;">
                <button onclick="saveSettings()" style="background:#1e3a8a; color:#fff; height:65px; border-radius:22px; border:none; font-weight:800; font-size:20px; box-shadow: 0 10px 25px rgba(30,58,138,0.3);">à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
                <button onclick="$('modalSet').style.display='none'" style="background:#f1f5f9; color:#64748b; height:65px; border-radius:22px; border:none; font-weight:800; font-size:18px;">à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸™à¸µà¹‰</button>
            </div>
        </div>
    </div>
</div>
    <div id="reportModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 id="reportTitle" style="margin:0; color:#1a237e;">ğŸ“Š à¸£à¸²à¸¢à¸‡à¸²à¸™</h3>
            <button onclick="closeReportModal()" style="background:#fee2e2; color:#dc2626; border:none; width:35px; height:35px; border-radius:50%; font-size:18px; cursor:pointer;">âœ•</button>
        </div>
        <div id="reportContent" style="max-height:400px; overflow-y:auto;"></div>
    </div>
</div>

<div id="historyModal" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; color:#1a237e;">ğŸ“œ à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</h3>
            <button onclick="closeHistoryModal()" style="background:#fee2e2; color:#dc2626; border:none; width:35px; height:35px; border-radius:50%; font-size:18px; cursor:pointer;">âœ•</button>
        </div>
        <div id="accHistory" style="max-height:400px; overflow-y:auto;"></div>
    </div>
</div>
 <nav>
    <div onclick="go(1)" class="nav-item active"><i class="fas fa-edit"></i><span>à¸šà¸±à¸™à¸—à¸¶à¸</span></div>
    <div onclick="go(2)" class="nav-item"><i class="fas fa-history"></i><span>à¸£à¸²à¸¢à¸‡à¸²à¸™</span></div>
    <div onclick="go(3)" class="nav-item"><i class="fas fa-wallet"></i><span>à¸šà¸±à¸à¸Šà¸µ</span></div>
</nav>
 <script>
const $ = (id) => document.getElementById(id);
let db = JSON.parse(localStorage.getItem("barber_db")) || [];
let archives = JSON.parse(localStorage.getItem("barber_archives")) || [];
let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
let payMethod = "";
function save() {
    localStorage.setItem("barber_db", JSON.stringify(db));
    localStorage.setItem("barber_archives", JSON.stringify(archives));
    localStorage.setItem("barber_account", JSON.stringify(account));
    localStorage.setItem("barber_conf", JSON.stringify(conf));
}
window.onload = () => {
    const today = new Date().toISOString().split('T')[0];

    if ($("dateInp")) $("dateInp").value = today;
    if ($("accDate")) $("accDate").value = today;
    if ($("histDate")) $("histDate").value = today;
    if (conf.shop) $("shopNameDisp").innerText = conf.shop;
    if (conf.theme) applyTheme(conf.theme);

    renderDay();
    loadAccountStatus();
};

    function addMinutes(time, mins) {
    if (!time) return "";
    const [h, m] = time.split(":").map(Number);
    const d = new Date();
    d.setHours(h, m + mins, 0, 0);
    return d.toTimeString().slice(0, 5);
}
function openReportModal(title, htmlContent) {
    const modal = $("reportModal");
    const modalTitle = $("reportTitle");     
    const modalContent = $("reportContent"); 
    const modalInner = modalContent.parentElement; 

    if (!modal || !modalTitle || !modalContent) {
        console.error("âŒ à¸«à¸² ID Modal à¹„à¸¡à¹ˆà¹€à¸ˆà¸­ à¹€à¸Šà¹‡à¸„ HTML à¸”à¹ˆà¸§à¸™!");
        return;
    }
    modalTitle.innerText = title;
    modalContent.innerHTML = htmlContent;
    modalInner.style.width = "95%";            
    modalInner.style.maxWidth = "650px";       
    modalInner.style.maxHeight = "85vh";       
    modalInner.style.overflowY = "auto";       
    modalInner.style.borderRadius = "24px";    
    modalInner.style.padding = "20px";
    modalInner.style.margin = "auto";
    modal.style.display = "flex";
    modal.style.alignItems = "center";
    modal.style.justifyContent = "center";
}
function closeReportModal() {
    $("reportModal").style.display = "none";
}
  function openHistoryModal() { 
    $("historyModal").style.display = "flex"; 
    if (typeof renderHistoryList === "function") {
        renderHistoryList(); 
    } else {
        console.error("à¸«à¸²à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ renderHistoryList à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¹‚à¸§à¹‰à¸¢!");
    }
}

function closeHistoryModal() { 
    $("historyModal").style.display = "none"; 
}
  function handleSave() {
    const p = parseInt($("priceInp").value), t = parseInt($("tipInp").value) || 0;
    if (!p || !payMethod) return alert("à¹ƒà¸ªà¹ˆà¸£à¸²à¸„à¸²à¹à¸¥à¸°à¹€à¸¥à¸·à¸­à¸à¸§à¸´à¸˜à¸µà¸ˆà¹ˆà¸²à¸¢à¸à¹ˆà¸­à¸™!");
    const start = $("tStart").value || new Date().toTimeString().slice(0, 5);
    const rec = {
        id: Date.now(), date: $("dateInp").value, time: start, endTime: $("tEnd").value || addMinutes(start, 30),
        svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(Boolean),
        hair: $("hairStyle").value, price: p, tip: t, pay: payMethod, type: "SERVICE"
    };
    db.push(rec); saveDB(); renderDay(); 
    ["priceInp", "tipInp", "tStart", "tEnd"].forEach(id => $(id).value = ""); 
}
function handleInsurance() {
    const d = $("dateInp").value || new Date().toISOString().split('T')[0], g = parseInt(conf.guar) || 0;
    const speak = (t) => { const m = new SpeechSynthesisUtterance(t); m.lang = 'th-TH'; window.speechSynthesis.speak(m); };
    if (g <= 0) return (speak("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸›à¸£à¸°à¸à¸±à¸™"), alert("âš ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸¢à¸­à¸”à¸›à¸£à¸°à¸à¸±à¸™à¹ƒà¸™ 'à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š' à¸à¹ˆà¸­à¸™"));
    if (db.find(r => r.date === d && r.type === "GUARANTEE_CLAIM")) return (speak("à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸›à¸´à¸”à¸›à¸£à¸°à¸à¸±à¸™à¹„à¸›à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸°"), alert("ğŸ›¡ï¸ à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸à¸±à¸™à¹„à¸›à¹à¸¥à¹‰à¸§"));
    if (confirm(`ğŸ›¡ï¸ à¸¢à¸·à¸™à¸¢à¸±à¸™à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸š 'à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰'?`)) {
        db.push({ id: Date.now(), date: d, time: "00:00", svcs: ["ğŸ›¡ï¸ à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¸§à¸±à¸™"], price: 0, pay: "N/A", type: "GUARANTEE_CLAIM" });
        saveDB(); speak(`à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸à¸±à¸™ ${g} à¸šà¸²à¸— à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢`); alert("âœ… à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸à¸±à¸™à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"); renderDay();
    }
}
 function handleHoliday(){const d=$("dateInp").value;if(!d)return alert("à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸à¹ˆà¸­à¸™");if(confirm(`à¸¢à¸·à¸™à¸¢à¸±à¸™à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ ${d} à¹€à¸›à¹‡à¸™ "à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”"?`)){db.push({id:Date.now(),date:d,time:"00:00",svcs:["ğŸ–ï¸ à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”"],price:0,pay:"N/A",type:"HOLIDAY"});saveDB();const m=new SpeechSynthesisUtterance("à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢");m.lang='th-TH';if(conf.voice==='male'){const v=window.speechSynthesis.getVoices().find(x=>x.name.includes('Male')||x.name.includes('Google'));if(v)m.voice=v}window.speechSynthesis.speak(m);alert("ğŸ–ï¸ à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢");renderDay()}}   
function openSettings() {
    if ($("setShop"))  $("setShop").value  = conf.shop  || "";
    if ($("setTheme")) $("setTheme").value = conf.theme || "light";
    if ($("setVoice")) $("setVoice").value = conf.voice || "female";
    if ($("setSound")) $("setSound").value = conf.sound || "on"; 
    if ($("setPerc"))  $("setPerc").value  = conf.perc  || 50;
    if ($("setGuar"))  $("setGuar").value  = conf.guar  || 0;

    $("modalSet").style.display = "flex";
}
function applyTheme(t) {
    document.body.className = t;
    const oldStyle = document.getElementById("navyStyle");
    if (oldStyle) oldStyle.remove();

    const s = document.documentElement.style;

    // --- â˜€ï¸ à¸˜à¸µà¸¡à¸ªà¸§à¹ˆà¸²à¸‡ (Default) ---
    s.setProperty('--card', '#ffffff');
    s.setProperty('--text', '#1a237e');
    s.setProperty('--modal-bg', '#f3f4f6'); // à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸µà¸ªà¸§à¹ˆà¸²à¸‡
    document.body.style.background = '#f3f4f6';

    if (t === 'dark') {
        // --- ğŸŒ‘ à¸˜à¸µà¸¡à¸¡à¸·à¸”-à¸—à¸­à¸‡ ---
        s.setProperty('--card', '#262626');
        s.setProperty('--text', '#fbbf24');
        s.setProperty('--modal-bg', '#171717'); // à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸µà¸”à¸³
        document.body.style.background = '#171717';
    } 
    else if (t === 'navy') {
        // --- ğŸŒŒ à¸˜à¸µà¸¡à¸™à¹‰à¸³à¹€à¸‡à¸´à¸™ ---
        s.setProperty('--card', '#ffffff');
        s.setProperty('--text', '#1a237e');
        s.setProperty('--modal-bg', '#1a237e'); // à¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸µà¸™à¹‰à¸³à¹€à¸‡à¸´à¸™
        document.body.style.background = '#1a237e';

        const st = document.createElement("style");
        st.id = "navyStyle";
        st.innerHTML = `
            body.navy { background: #1a237e !important; color: #ffffff !important; }
            .navy .card b, .navy .card span { color: #1e293b !important; }
            .navy #dTotal, .navy #accNet { color: #1a237e !important; }
            .nav-item { color: #ffffff !important; opacity: 0.7; }
            .nav-item.active { color: #facc15 !important; opacity: 1; font-weight: bold; }
        `;
        document.head.appendChild(st);
    }
}
function saveSettings() {
    const shopName = $("setShop").value;
    const shopPerc = $("setPerc").value;
    const shopGuar = $("setGuar").value;
    const shopTheme = $("setTheme").value;
    conf.shop = shopName;
    conf.perc = parseFloat(shopPerc) || 0; // à¸à¸±à¸™à¸„à¹ˆà¸²à¸§à¹ˆà¸²à¸‡à¸à¸±à¸‡
    conf.guar = parseFloat(shopGuar) || 0; // à¸à¸±à¸™à¸„à¹ˆà¸²à¸§à¹ˆà¸²à¸‡à¸à¸±à¸‡
    conf.theme = shopTheme;
    localStorage.setItem('shopName', shopName);
    localStorage.setItem('shopPerc', shopPerc);
    localStorage.setItem('shopGuar', shopGuar);
    localStorage.setItem('shopTheme', shopTheme);

    if($("shopNameDisp")) {
        $("shopNameDisp").innerText = shopName.toUpperCase();
    }
    if (typeof applyTheme === "function") {
        applyTheme(shopTheme); 
    }
    if (typeof calculateMoney === "function") {
        calculateMoney(); 
    }
    if (typeof renderDay === "function") {
        renderDay(); 
    }
    $("modalSet").style.display = 'none';
    alert("à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!");
}
 function closeAndGoHome(){const m=document.getElementById("modalSet");if(m)m.style.display='none';if(typeof go==='function')go(1);else location.reload()}
 function speak(txt) {if ('speechSynthesis' in window) {const msg = new SpeechSynthesisUtterance(txt); msg.lang = 'th-TH'; window.speechSynthesis.speak(msg);}}       
 function clearAllData(){if(confirm("à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”?")){localStorage.clear();location.reload()}}
 function updateDateDisplay(v){if(!v)return;const d=new Date(v);const el=$("dateDisplay");if(el)el.innerText=d.toLocaleDateString('th-TH',{day:'numeric',month:'short',year:'2-digit'});if(typeof renderDay==="function")renderDay()}window.addEventListener('DOMContentLoaded',()=>{const i=$("dateInp"),t=new Date().toISOString().split('T')[0];if(i){i.value=t;updateDateDisplay(t)}});
 function selectPay(m) {payMethod = m; $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;$("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;}
function renderDay() {
    const dInp = $("dateInp").value;
    const allRec = db.filter(r => r.date === dInp);
    const today = allRec.filter(r => r.type !== 'HOLIDAY');
    const isHoliday = allRec.some(r => r.type === 'HOLIDAY');
    const stats = {};
    const extraSvcs = ["à¹‚à¸à¸™à¸«à¸™à¸§à¸”", "à¸à¸±à¸™à¸«à¸™à¹‰à¸²", "à¸ªà¸£à¸°à¸œà¸¡"];
    let tot = 0, trans = 0, cash = 0, tips = 0;
    let listHtml = "";

    today
    .slice()
    .sort((a,b) => a.time.localeCompare(b.time))
    .forEach((r, i) => {
        const p = Number(r.price) || 0;
        const t = Number(r.tip) || 0;
        tot += p;
        tips += t;
        (r.pay === 'Trans') ? trans += (p + t) : cash += p;
        const currentSvcs = Array.isArray(r.svcs) ? r.svcs : [];
        const hasRealHaircut = currentSvcs.some(s => s && !extraSvcs.includes(s));
        currentSvcs.forEach(s => {
            if (!s) return;
            stats[s] = (stats[s] || 0) + 1;
        });

        if (hasRealHaircut) {
            stats["à¸•à¸±à¸”à¸œà¸¡"] = (stats["à¸•à¸±à¸”à¸œà¸¡"] || 0) + 1;
        }
        const timeShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        const payIcon = r.pay === 'Trans' ? 'ğŸ“±' : 'ğŸ’µ';

        listHtml += `
        <div class="history-row" style="padding:15px; border-bottom:1px solid #f1f5f9; background:#fff;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div style="width:28px; height:28px; background:#f8fafc; border:1px solid #e2e8f0; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:800; color:#64748b; flex-shrink:0;">
                        ${i+1}
                    </div>
                    <div style="display:flex; flex-direction:column;">
                        <div style="font-weight:800; font-size:14px; color:#1e293b; margin-bottom:2px;">
                            <span style="color:#64748b; font-weight:500;">[${timeShow}]</span> ${currentSvcs.join(' + ')}
                        </div>
                        <div style="display:flex; gap:8px; align-items:center;">
                            ${t ? `<small style="color:#be185d; font-weight:700; font-size:11px;">ğŸ”¹ à¸—à¸´à¸›: à¸¿${t}</small>` : '<small style="color:#94a3b8; font-size:11px;">(à¹„à¸¡à¹ˆà¸¡à¸µà¸—à¸´à¸›)</small>'}
                        </div>
                    </div>
                </div>
                <div style="text-align:right;">
                    <b style="font-size:16px; display:block; color:#1e293b;">
                        <span style="font-size:14px;">${payIcon}</span> à¸¿${p}${t ? ` <span style="color:#be185d;">(+${t})</span>` : ''}
                    </b>
                    <span style="font-size:11px; font-weight:700; color:#ef4444; cursor:pointer;" onclick="delRec(${r.id})">
                        à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£ <i class="fas fa-trash-alt"></i>
                    </span>
                </div>
            </div>
        </div>`;
    });

    const bEarn = isHoliday ? 0 : Math.max(tot * (conf.perc / 100), conf.guar) + tips;
    const sEarn = isHoliday ? 0 : tot - (bEarn - tips);
    const settle = isHoliday ? 0 : cash - bEarn;

    // --- à¸ªà¹ˆà¸§à¸™à¸­à¸±à¸›à¹€à¸”à¸• Card à¸šà¸™ ---
    if($("dTotal")) $("dTotal").innerText  = tot.toLocaleString();
    if($("dTrans")) $("dTrans").innerText  = trans.toLocaleString();
    if($("dCash")) $("dCash").innerText   = cash.toLocaleString();
    if($("dBarber")) $("dBarber").innerText = Math.floor(bEarn).toLocaleString();
    if($("dShop")) $("dShop").innerText   = Math.floor(sEarn).toLocaleString();
    if($("dCounts")) $("dCounts").innerText = isHoliday ? "ğŸ–ï¸ à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”" : `à¸¥à¸¹à¸à¸„à¹‰à¸²: ${today.length} à¸„à¸™`;

    // --- à¸ªà¹ˆà¸§à¸™à¸ªà¸–à¸´à¸•à¸´ ---
    let sH = `<div style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-bottom:10px;">`;
    const priority = ["à¸•à¸±à¸”à¸œà¸¡", "à¹€à¸”à¹‡à¸"];
    priority.forEach(k => { if (stats[k]) sH += `<span style="background:#4338ca;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${k}: ${stats[k]}</span>`; });
    for (let s in stats) { if (!priority.includes(s)) sH += `<span style="background:#64748b;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${s}: ${stats[s]}</span>`; }
    if($("dServiceStats")) $("dServiceStats").innerHTML = sH + `</div>`;

    // --- à¸ªà¹ˆà¸§à¸™à¸„à¸³à¸™à¸§à¸“à¹à¸–à¸šà¸ªà¸–à¸²à¸™à¸°à¹à¸¥à¸°à¸›à¸¸à¹ˆà¸¡ ---
    let txt = "", statusColor = "", icon = "";
    if (isHoliday) { 
        txt = "à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”"; statusColor = "#1e40af"; icon = "ğŸ–ï¸"; 
    } else if (tot === 0) { 
        txt = "à¸£à¹‰à¸²à¸™à¸ˆà¹ˆà¸²à¸¢à¸›à¸£à¸°à¸à¸±à¸™"; statusColor = "#0369a1"; icon = "ğŸ›¡ï¸"; 
    } else if (settle > 0) { 
        txt = `à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™ à¸¿${Math.floor(settle).toLocaleString()}`; statusColor = "#b91c1c"; icon = "ğŸ‘¨â€ğŸ¨"; 
    } else if (settle < 0) { 
        txt = `à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡ à¸¿${Math.floor(Math.abs(settle)).toLocaleString()}`; statusColor = "#4338ca"; icon = "ğŸ "; 
    } else { 
        txt = "à¸¢à¸­à¸”à¸à¸­à¸”à¸µ"; statusColor = "#15803d"; icon = "âœ…"; 
    }

   const silverBG = "#f1f5f9"; // à¸ªà¸µà¹€à¸—à¸²à¹€à¸‡à¸´à¸™à¸ªà¸§à¹ˆà¸²à¸‡
const btnBlue  = "#2563eb"; // à¸ªà¸µà¸™à¹‰à¸³à¹€à¸‡à¸´à¸™ Royal Blue à¸—à¸µà¹ˆà¸¡à¸¶à¸‡à¸Šà¸­à¸š

const actionBox = document.getElementById("settleBarContainer");
if (actionBox) {
    actionBox.style.display = "flex";
    actionBox.style.gap = "10px";
    actionBox.innerHTML = `
        <div id="settleBar" style="flex:8; height:55px; background:${silverBG}; display:flex; align-items:center; justify-content:center; border-radius:18px; font-weight:800; font-size:14px; color:${statusColor}; border:1px solid #e2e8f0; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);">
            <span style="margin-right:8px; font-size:18px;">${icon}</span> ${txt}
        </div>
        
        <button onclick="saveAndGo('${dInp}', ${tot})" style="flex:2.2; height:55px; background:${btnBlue}; color:#fff; border-radius:18px; border:none; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow:0 6px 15px rgba(37, 99, 235, 0.3);">
            <i class="fas fa-paper-plane"></i>
        </button>
    `;
}
    // --- à¸ªà¹ˆà¸§à¸™à¹à¸ªà¸”à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡ (à¸ªà¸³à¸„à¸±à¸!) ---
   const dList = document.getElementById("dailyList");
if (dList) {
    dList.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin:10px 0; padding:0 5px;">
            <b style="font-size:16px; color: var(--text);">ğŸ“‹ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸§à¸±à¸™à¸™à¸µà¹‰:</b>
            <i class="fab fa-line" style="color:#22c55e; font-size:32px; cursor:pointer" onclick="shareLine()"></i>
        </div>
        
        <div style="margin-top: 20px;">
            <button onclick="clearDailyData()" style="width:100%; height:45px; background:#fff1f2; border:1px solid #fecaca; border-radius:12px; font-size:14px; font-weight:800; color:#e11d48; cursor:pointer;">
                <i class="fas fa-trash-alt"></i> à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸§à¸±à¸™à¸™à¸µà¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
            </button>
        </div>

            ${isHoliday ? `<center style='padding:40px; color:#64748b;'>ğŸ–ï¸ à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¸£à¹‰à¸²à¸™</center>` : (listHtml || "<center style='padding:40px; opacity:0.3;'>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>")}
        `;
    }
} function clearDailyData() {
    // à¸›à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸¢à¸·à¸™à¸¢à¸±à¸™à¹ƒà¸«à¹‰à¸”à¸¹à¹€à¸›à¹‡à¸™à¸—à¸²à¸‡à¸à¸²à¸£
    const confirmDelete = confirm("âš ï¸ à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸²à¸¢à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸§à¸±à¸™à¸™à¸µà¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ? (à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸¥à¸šà¹à¸¥à¹‰à¸§à¸ˆà¸°à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸£à¸µà¸¢à¸à¸„à¸·à¸™à¹„à¸”à¹‰)");
    
    if (confirmDelete) {
        // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸Šà¸·à¹ˆà¸­ Key à¹ƒà¸«à¹‰à¸•à¸£à¸‡à¸à¸±à¸šà¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸ˆà¸£à¸´à¸‡ (à¹€à¸Šà¹ˆà¸™ 'barber_db')
        localStorage.removeItem("barber_db"); 
        
        // à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸ˆà¹‰à¸‡à¸œà¸¥à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸ªà¸¸à¸ à¸²à¸
        alert("âœ… à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š");
        
        // à¸£à¸µà¹‚à¸«à¸¥à¸”à¸«à¸™à¹‰à¸²à¸ˆà¸­à¹€à¸à¸·à¹ˆà¸­à¸­à¸±à¸›à¹€à¸”à¸•à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥
        location.reload();
    }
}
function saveAndGo(date, total) {
    const todayData = db.filter(r => r.date === date && r.type === 'SERVICE');
    const isHoliday = db.some(r => r.date === date && r.type === 'HOLIDAY');
    let cash = 0, trans = 0, tips = 0, count = 0, stats = {};
    const extraSvcs = ["à¹‚à¸à¸™à¸«à¸™à¸§à¸”", "à¸à¸±à¸™à¸«à¸™à¹‰à¸²", "à¸ªà¸£à¸°à¸œà¸¡"];
    todayData.forEach(r => {
        const p = Number(r.price) || 0, t = Number(r.tip) || 0;
        tips += t;
        r.pay === "Cash" ? cash += p : trans += (p + t);
        const svcs = Array.isArray(r.svcs) ? r.svcs : [r.svcs];
        const isRealCut = svcs.some(s => s && !extraSvcs.includes(s));
        if (isRealCut) count++;
        svcs.forEach(s => { if(s) stats[s] = (stats[s] || 0) + 1; });
    });
    const bEarn = isHoliday ? 0 : Math.max(total * (conf.perc / 100), conf.guar) + tips;
    const settle = isHoliday ? 0 : cash - bEarn;
    const idx = archives.findIndex(a => a.date === date);
    const data = {date,total: Number(total),cash,trans,tips,barber: Math.floor(bEarn),shop: total - (bEarn - tips),settle,count,stats,details: todayData };    
    if (idx > -1) {account.balance = (Number(account.balance) || 0) + (settle - (archives[idx].settle || 0));archives[idx] = data;
    } else {account.balance = (Number(account.balance) || 0) + settle;archives.push(data);}
    db = db.filter(r => r.date !== date);save();alert("âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸¢à¸­à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢!");go(3);}

    function toggleAccHistory() {const w = $("accHistoryWrapper"); w.style.display = w.style.display === "none" ? "block" : "none";$("accHistory").innerHTML = account.logs.map(l => `<div style="padding:5px; border-bottom:1px solid #eee;">${l.date}: à¸¿${l.amount} (${l.note})</div>`).join('') || "à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´";}    
    function loadAccountHistory() {let h = account.logs.map(l => `<div style="padding:15px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between; align-items:center;"><div><b style="font-size:14px; color:#1e293b;">${l.date}</b><br><small style="color:#64748b;">${l.note}</small></div><b style="color:${l.amount >= 0 ? '#16a34a' : '#dc2626'};">${l.amount >= 0 ? '+' : ''}à¸¿${Math.abs(l.amount).toLocaleString()}</b></div> `).join('');if($("accHistory")) {$("accHistory").innerHTML = h || '<center style="padding:40px; color:#94a3b8;">à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</center>';}}     
    function loadAccountStatus() {
    const net = Number(account.balance) || 0;
   
    if ($("accOldVal")) $("accOldVal").innerText = `à¸¿${net.toLocaleString()}`;
    if ($("accTodayVal")) $("accTodayVal").innerText = `à¸¿0`; 
    if ($("accNet")) $("accNet").innerText = Math.abs(net).toLocaleString();

    const badge = $("statusBadge"); 
    let bgColor = "#f8fafc"; 
    let textColor = "#64748b";
    let statusTxt = "âš–ï¸ à¸¢à¸­à¸”à¸¥à¸‡à¸•à¸±à¸§";

    if (net > 0) {
        bgColor = "#fef2f2"; 
        textColor = "#dc2626"; 
        statusTxt = "ğŸ‘¨â€ğŸ¨ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™";
    } else if (net < 0) {
        bgColor = "#eff6ff"; 
        textColor = "#1e3a8a"; 
        statusTxt = "ğŸ  à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡";
    }
    if (badge) {
        badge.innerText = statusTxt;
        badge.style.background = bgColor;
        badge.style.color = textColor;
    }
    if ($("accLight")) {
        const lightColor = net > 0 ? "#dc2626" : (net < 0 ? "#1e3a8a" : "#16a34a");
        $("accLight").style.background = lightColor;
        $("accLight").style.boxShadow = `0 0 12px ${lightColor}`;
    }
}
function clearAccount() {
    const d = $("accDate").value || new Date().toISOString().split('T')[0];
    
    const net = Number(account.balance) || 0;

    if (net === 0) {
        alert("ğŸ’ à¸¢à¸­à¸”à¹€à¸›à¹‡à¸™à¸¨à¸¹à¸™à¸¢à¹Œ à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ");
        return;
    }

    const confirmMsg = net > 0 
        ? `à¸¢à¸·à¸™à¸¢à¸±à¸™à¸§à¹ˆà¸²à¸Šà¹ˆà¸²à¸‡ "à¸„à¸·à¸™à¹€à¸‡à¸´à¸™" à¹ƒà¸«à¹‰à¸£à¹‰à¸²à¸™ à¸¿${net.toLocaleString()} à¹ƒà¸Šà¹ˆà¹„à¸«à¸¡?`
        : `à¸¢à¸·à¸™à¸¢à¸±à¸™à¸§à¹ˆà¸²à¸£à¹‰à¸²à¸™ "à¸ˆà¹ˆà¸²à¸¢à¹€à¸‡à¸´à¸™" à¹ƒà¸«à¹‰à¸Šà¹ˆà¸²à¸‡ à¸¿${Math.abs(net).toLocaleString()} à¹ƒà¸Šà¹ˆà¹„à¸«à¸¡?`;

    if (!confirm(confirmMsg)) return;
    if (!account.logs) account.logs = [];
    account.logs.unshift({
        date: d,
        amount: net,
        note: $("accNote")?.value || "à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸¢à¸­à¸”à¸„à¹‰à¸²à¸‡"
    });
    account.balance = 0;
    save(); 
    alert("âœ… à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¸šà¸±à¸à¸Šà¸µà¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢!");
    
    if ($("accNote")) $("accNote").value = "";
    loadAccountHistory(); 
    loadAccountStatus();  
}
function renderHistoryList() {
    let h = account.logs.map(l => `
        <div style="padding:12px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between; align-items:center;">
            <div>
                <b style="font-size:14px; color:#1e293b;">${l.date}</b><br>
                <small style="color:#64748b;">${l.note}</small>
            </div>
            <b style="color:#16a34a;">à¸¿${Math.abs(l.amount).toLocaleString()}</b>
        </div>
    `).join('');
    
    $("accHistory").innerHTML = h || '<center style="padding:40px; color:#94a3b8;">à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œ</center>';
}
function loadHistDaily() {
    const d = $("histDate").value;
    if (!d) return;

    const f = archives.find(a => a.date === d);
    if (!f) return alert("à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¸§à¸±à¸™à¸™à¸µà¹‰");

    let cashTotal = f.cash || 0;
    let transTotal = f.trans || 0;
    let totalRevenue = cashTotal + transTotal;
    
    let customerCount = (f.details) ? f.details.length : (f.count || 0);
    
    const barberEarn = Math.floor(f.barber || 0);
    const shopEarn = Math.floor(f.shop || 0);
    const svcCounts = {};
    
    (f.details || []).forEach(r => {
        const services = Array.isArray(r.svcs) ? r.svcs : [r.svcs];
        services.forEach(s => {
            svcCounts[s] = (svcCounts[s] || 0) + 1;
        });
    });

    const svcHTML = Object.entries(svcCounts).map(([name, count]) => `
        <div style="background:rgba(203, 213, 225, 0.1); padding:6px 12px; border-radius:10px; font-size:12px; color:#cbd5e1; font-weight:600; display:inline-block; margin:3px; border:1px solid rgba(255, 255, 255, 0.1);">
            ${name} <span style="opacity:0.7; margin-left:4px;">x${count}</span>
        </div>
    `).join("");

    let settleHTML = "";
    if (cashTotal > barberEarn) {
        const toShop = cashTotal - barberEarn;
        settleHTML = `<div style="background:rgba(251,146,60,0.1); padding:16px; border-radius:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(251,146,60,0.3);">
            <div style="font-size:16px; color:#fdba74; font-weight:600; margin-bottom:4px;">ğŸ‘¨â€ğŸ¨ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™</div>
            <div style="font-size:24px; color:#fb923c; font-weight:800;">à¸¿${toShop.toLocaleString()}</div>
        </div>`;
    } else if (barberEarn > cashTotal) {
        const toBarber = barberEarn - cashTotal;
        settleHTML = `<div style="background:rgba(56,189,248,0.1); padding:16px; border-radius:16px; margin-bottom:20px; text-align:center; border:1px solid rgba(56,189,248,0.3);">
            <div style="font-size:16px; color:#7dd3fc; font-weight:600; margin-bottom:4px;">ğŸ  à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡</div>
            <div style="font-size:24px; color:#38bdf8; font-weight:800;">à¸¿${toBarber.toLocaleString()}</div>
        </div>`;
    }

    const rows = (f.details || []).map((r, index) => {
        const p = Number(r.price) || 0;
        const t = Number(r.tip) || 0;
        const fullTime = (r.time && r.endTime) ? `${r.time}-${r.endTime}` : (r.time || "--:--");
        
        return `
        <div style="padding:14px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius:16px; margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
            <div style="display:flex; align-items:center; gap:12px;">
                <div style="width:28px; height:28px; background:rgba(255,255,255,0.08); border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:700; color:#94a3b8;">${index + 1}</div>
                <div>
                    <div style="font-weight:700; font-size:14px; color:#f8fafc;">${Array.isArray(r.svcs) ? r.svcs.join(' + ') : r.svcs}</div>
                    <div style="font-size:14px; color:#94a3b8; font-weight:500; margin-top:2px;">â± ${fullTime} â€¢ ${r.pay === 'Trans' ? 'à¹‚à¸­à¸™' : 'à¹€à¸‡à¸´à¸™à¸ªà¸”'}</div>
                </div>
            </div>
            <div style="text-align:right;">
                <div style="font-size:16px; font-weight:800; color:#f8fafc;">à¸¿${p.toLocaleString()}</div>
                ${t > 0 ? `<div style="font-size:12px; font-weight:600; color:#f472b6;">+ Tip à¸¿${t.toLocaleString()}</div>` : ''}
            </div>
        </div>`;
    }).join("");

   // à¹à¸à¹‰à¹„à¸‚à¸ªà¸µà¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡à¹€à¸›à¹‡à¸™ #0f172a (à¹€à¸‚à¹‰à¸¡) à¹à¸¥à¸°à¸•à¸±à¸§à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸‚à¸²à¸§/à¹€à¸‡à¸´à¸™ à¸•à¸²à¸¡à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£
   openReportModal(`à¸£à¸²à¸¢à¸‡à¸²à¸™ ${d}`, `
    <div style="font-family:'Inter', system-ui, sans-serif; background:#0f172a; margin:-16px; padding:24px; color:#f1f5f9; min-height:100vh;">
            
            <div style="text-align:center; padding:20px 0 30px 0;">
                <div style="font-size:16px; color:#94a3b8; font-weight:600; text-transform:uppercase; letter-spacing:1px;">à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¸£à¸§à¸¡</div>
                <div style="font-size:48px; font-weight:900; color:#ffffff; margin-top:5px;">à¸¿${totalRevenue.toLocaleString()}</div>
            </div>

            <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; margin-bottom:24px;">
                <div style="background:#14532d; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">ğŸ’µ à¹€à¸‡à¸´à¸™à¸ªà¸”</div>
                    <div style="font-size:16px; font-weight:800;">à¸¿${cashTotal.toLocaleString()}</div>
                </div>
                <div style="background:#1e3a8a; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">ğŸ“± à¹€à¸‡à¸´à¸™à¹‚à¸­à¸™</div>
                    <div style="font-size:16px; font-weight:800;">à¸¿${transTotal.toLocaleString()}</div>
                </div>
                <div style="background:#78350f; padding:14px 8px; border-radius:18px; text-align:center; color:#ffffff;">
                    <div style="font-size:13px; opacity:0.8; font-weight:600; margin-bottom:4px;">ğŸ‘¥ à¸¥à¸¹à¸à¸„à¹‰à¸²</div>
                    <div style="font-size:16px; font-weight:800;">${customerCount}</div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;">
                <div style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:16px; border-radius:20px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:600; margin-bottom:4px;">à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¸Šà¹ˆà¸²à¸‡</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">à¸¿${barberEarn.toLocaleString()}</div>
                </div>
                <div style="background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); padding:16px; border-radius:20px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:600; margin-bottom:4px;">à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¸£à¹‰à¸²à¸™</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">à¸¿${shopEarn.toLocaleString()}</div>
                </div>
            </div>

            ${settleHTML}

            <div style="margin-bottom:30px;">
                <div style="font-size:14px; color:#94a3b8; font-weight:700; text-transform:uppercase; margin-bottom:12px; text-align:center;">à¸ªà¸£à¸¸à¸›à¸›à¸£à¸°à¹€à¸ à¸—à¸‡à¸²à¸™</div>
                <div style="text-align:center;">${svcHTML}</div>
            </div>

            <div style="font-weight:800; font-size:16px; color:#f8fafc; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                <div style="width:4px; height:18px; background:#cbd5e1; border-radius:2px;"></div>
                à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸‡à¸²à¸™
            </div>
            <div style="max-height:400px; overflow-y:auto; padding-bottom:40px;">
                ${rows}
            </div>
        </div>
    `);
}
function loadHistMonth() {
    const m = $("histMonth").value;
    if (!m) return alert("à¸à¸£à¸¸à¸“à¸²à¹€à¸¥à¸·à¸­à¸à¹€à¸”à¸·à¸­à¸™à¸à¹ˆà¸­à¸™");

    const filtered = archives.filter(a => a.date && a.date.startsWith(m));
    if (!filtered.length) {
        return openReportModal(
            "ğŸ“Š à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™",
            `<div style='padding:80px 20px; text-align:center; color:#0f172a; background:#94a3b8; height:100vh;'>
                <i class='fas fa-folder-open' style='font-size:40px;margin-bottom:10px;opacity:0.3;'></i><br>à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¹€à¸”à¸·à¸­à¸™à¸™à¸µà¹‰
            </div>`
        );
    }

    const haircutList = ["à¹à¸Ÿà¸Šà¸±à¹ˆà¸™","à¸ªà¸à¸´à¸™à¹€à¸Ÿà¸”","à¹€à¸›à¸´à¸”à¸‚à¹‰à¸²à¸‡","à¸£à¸­à¸‡à¸—à¸£à¸‡","à¸•à¸³à¸£à¸§à¸ˆ/à¸—à¸«à¸²à¸£","à¸—à¸£à¸‡à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™","à¹à¸à¹‰à¸œà¸¡","à¹‚à¸à¸™à¸œà¸¡","à¹€à¸”à¹‡à¸"];
    const serviceList = ["à¹‚à¸à¸™à¸«à¸™à¸§à¸”","à¸à¸±à¸™à¸«à¸™à¹‰à¸²","à¸ªà¸£à¸°à¸œà¸¡","à¸¢à¹‰à¸­à¸¡à¸œà¸¡"];

    let monthTotal = 0, monthBarber = 0, monthCount = 0;
    let hairStats = {}, serviceStats = {};

    // --- à¸ªà¹ˆà¸§à¸™à¸„à¸³à¸™à¸§à¸“ Logic à¹€à¸”à¸´à¸¡à¸‚à¸­à¸‡à¸„à¸¸à¸“ ---
    filtered.forEach(day => {
        monthTotal += Number(day.total) || 0;
        monthBarber += Number(day.barber) || 0;
        (day.details || []).forEach(d => {
            const svcs = Array.isArray(d.svcs) ? d.svcs : [];
            let countedHair = false;
            svcs.forEach(s => {
                if (!s) return;
                s = s.trim();
                if (haircutList.includes(s)) {
                    hairStats[s] = (hairStats[s] || 0) + 1;
                    if (!countedHair) { monthCount++; countedHair = true; }
                } else if (serviceList.includes(s)) {
                    serviceStats[s] = (serviceStats[s] || 0) + 1;
                }
            });
        });
    });

    const monthShop = monthTotal - monthBarber;

    // --- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ Render List à¸ªà¸–à¸´à¸•à¸´à¹à¸šà¸šà¹ƒà¸«à¸¡à¹ˆ (à¸”à¸µà¹„à¸‹à¸™à¹Œà¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸šà¸£à¸²à¸¢à¸§à¸±à¸™) ---
    const renderStats = (obj, accentColor) => {
        const entries = Object.entries(obj).sort((a,b)=>b[1]-a[1]);
        if (!entries.length) return "<div style='color:rgba(255,255,255,0.2); padding:10px; font-size:13px;'>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</div>";
        return entries.map(([k,v]) => `
            <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 16px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08); border-radius:16px; margin-bottom:8px;">
                <div style="font-weight:600; color:#f1f5f9; font-size:14px;">${k}</div>
                <div style="font-weight:800; color:${accentColor}; font-size:16px;">${v} <span style="font-size:11px; opacity:0.5; color:#fff; font-weight:400;">à¸„à¸£à¸±à¹‰à¸‡</span></div>
            </div>`
        ).join("");
    };
    // --- à¸ªà¹ˆà¸§à¸™à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥ UI à¹ƒà¸«à¸¡à¹ˆà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ---
    openReportModal(
        `à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¸‡à¸²à¸™à¹€à¸”à¸·à¸­à¸™ ${m}`,
        `
        <div style="background:#0f172a; margin:-16px; padding:24px; font-family:'Inter', sans-serif; color:#f1f5f9; min-height:100vh;">
            
            <div style="text-align:center; padding:10px 0 30px 0;">
                <div style="font-size:20px; color:#94a3b8; font-weight:700; text-transform:uppercase; letter-spacing:2px; margin-bottom:5px;">âœ‚ï¸à¸¢à¸­à¸”à¸•à¸±à¸”à¸—à¸±à¹‰à¸‡à¹€à¸”à¸·à¸­à¸™</div>
                <div style="font-size:52px; font-weight:900; color:#ffffff; letter-spacing:-1px;">à¸¿${monthTotal.toLocaleString()}</div>
                
                <div style="display:flex; justify-content:center; gap:8px; margin-top:15px;">
                    <div style="background:rgba(255,255,255,0.08); padding:6px 14px; border-radius:12px; font-size:16px; font-weight:600; color:#38bdf8;">
                        ğŸ‘¤ à¸¥à¸¹à¸à¸„à¹‰à¸² ${monthCount} à¸„à¸™
                    </div>
                    <div style="background:rgba(255,255,255,0.08); padding:6px 14px; border-radius:12px; font-size:16px; font-weight:600; color:#94a3b8;">
                        ğŸ“… à¸§à¸±à¸™à¸—à¸³à¸‡à¸²à¸™ ${filtered.length} à¸§à¸±à¸™
                    </div>
                </div>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:30px;">
                <div style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); padding:18px; border-radius:22px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:700; text-transform:uppercase; margin-bottom:6px;">à¸£à¸²à¸¢à¹„à¸”à¹‰à¸Šà¹ˆà¸²à¸‡</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">à¸¿${Math.floor(monthBarber).toLocaleString()}</div>
                </div>
                <div style="background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.1); padding:18px; border-radius:22px; text-align:center;">
                    <div style="font-size:14px; color:#94a3b8; font-weight:700; text-transform:uppercase; margin-bottom:6px;">à¸£à¸²à¸¢à¹„à¸”à¹‰à¸£à¹‰à¸²à¸™</div>
                    <div style="font-size:20px; font-weight:800; color:#f8fafc;">à¸¿${Math.floor(monthShop).toLocaleString()}</div>
                </div>
            </div>

            <div style="margin-bottom:25px;">
                <div style="font-size:15px; font-weight:800; color:#bef264; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                    <div style="width:4px; height:16px; background:#bef264; border-radius:2px;"></div>
                    à¸—à¸£à¸‡à¸œà¸¡à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡
                </div>
                ${renderStats(hairStats, "#bef264")}
            </div>

            <div style="padding-bottom:40px;">
                <div style="font-size:15px; font-weight:800; color:#38bdf8; margin-bottom:15px; display:flex; align-items:center; gap:8px;">
                    <div style="width:4px; height:16px; background:#38bdf8; border-radius:2px;"></div>
                    à¸šà¸£à¸´à¸à¸²à¸£à¸¢à¸­à¸”à¸™à¸´à¸¢à¸¡
                </div>
                ${renderStats(serviceStats, "#38bdf8")}
            </div>
            
        </div>
        `
    );
}
  function shareLine() {
    const dInp = $("dateInp").value, today = db.filter(r => r.date === dInp); if (!today.length) return;
    const dp = dInp.split('-'), fDate = `${dp[2]}/${dp[1]}/${dp[0]}`;
    let tot=0, cash=0, trans=0, tips=0, stats={};
    let clientList = today.sort((a,b)=>a.time.localeCompare(b.time)).map((r,i)=>{
        const p = Number(r.price)||0, t = Number(r.tip)||0; tot+=p; tips+=t;
        r.pay==='Trans' ? trans+=p : cash+=p;
        if(r.hair&&r.hair.includes("à¹€à¸”à¹‡à¸")) stats["à¹€à¸”à¹‡à¸"]=(stats["à¹€à¸”à¹‡à¸"]||0)+1;
        (r.svcs||[]).forEach(s=>{ if(s) stats[s]=(stats[s]||0)+1; });
        const tShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        return `${i+1}. [${tShow}] ${(r.svcs||[]).join('+')} = ${p}${t?` (+à¸—à¸´à¸› ${t})`:''} ${r.pay==='Trans'?'ğŸ“±':'ğŸ’µ'}`;
    }).join('\n');
    const allowed = ["à¹€à¸”à¹‡à¸","à¸ªà¸£à¸°à¸œà¸¡","à¹‚à¸à¸™à¸«à¸™à¸§à¸”","à¸¢à¹‰à¸­à¸¡à¸œà¸¡","à¸¢à¹‰à¸­à¸¡à¸ªà¸µ"], icons = {"à¹€à¸”à¹‡à¸":"ğŸ§’","à¸ªà¸£à¸°":"ğŸ§¼","à¹‚à¸à¸™":"ğŸª’","à¸¢à¹‰à¸­à¸¡":"ğŸ¨"};
    let statText = Object.entries(stats).filter(([k])=>allowed.some(a=>k.includes(a))).map(([k,v])=>`${icons[Object.keys(icons).find(i=>k.includes(i))]||'ğŸ”¹'} ${k}: ${v}`).join('\n');
    let bEarn = Math.max(tot*(conf.perc/100), conf.guar) + tips; // à¸Šà¹ˆà¸²à¸‡à¹„à¸”à¹‰ = à¸ªà¹ˆà¸§à¸™à¹à¸šà¹ˆà¸‡ + à¸—à¸´à¸›à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
    let settle = cash - bEarn, settleMsg = settle > 0 ? `âš ï¸ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™ ${Math.floor(Math.abs(settle))}` : `ğŸŸ¦ à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡ ${Math.floor(Math.abs(settle))}`;
    let msg = `ğŸ’ˆ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸£à¹‰à¸²à¸™: Barber Shop\nğŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆ: ${fDate}\n-------------------------\nğŸ“ à¸¥à¸¹à¸à¸„à¹‰à¸² (${today.length} à¸„à¸™):\n${clientList}\n-------------------------\nğŸ“Š à¸ªà¸£à¸¸à¸›à¸‡à¸²à¸™:\n${statText}\n-------------------------\nğŸ’° à¸¢à¸­à¸”: ${tot} | ğŸ§§ à¸—à¸´à¸›: ${tips}\nğŸ“± à¹‚à¸­à¸™: ${trans} | ğŸ’µ à¸ªà¸”: ${cash}\nğŸ¤µ à¸Šà¹ˆà¸²à¸‡à¹„à¸”à¹‰: ${Math.floor(bEarn)}\nğŸ  à¸£à¹‰à¸²à¸™à¹„à¸”à¹‰: ${Math.floor(tot-(bEarn-tips))}\n-------------------------\n${settleMsg}`;
    window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
}
function go(p) {
    document.querySelectorAll('.page').forEach(pg => {
        pg.classList.remove('active');
        pg.style.display = 'none'; 
    });
    const targetPage = document.getElementById('p' + p);
    if (targetPage) {
        targetPage.classList.add('active');
        targetPage.style.display = 'block';
    }
    document.querySelectorAll('.nav-item').forEach((btn, i) => {
        btn.classList.toggle('active', (i + 1) === p);
    });
    if (p === 3) { 
        // 1. à¸šà¸±à¸‡à¸„à¸±à¸šà¹ƒà¸«à¹‰à¸§à¸±à¸™à¸—à¸µà¹ˆà¹ƒà¸™à¸«à¸™à¹‰à¸²à¸šà¸±à¸à¸Šà¸µ à¸•à¸£à¸‡à¸à¸±à¸šà¸§à¸±à¸™à¸—à¸µà¹ˆà¸«à¸™à¹‰à¸²à¹à¸£à¸à¸à¹ˆà¸­à¸™
        if($("accDate") && $("dateInp")) $("accDate").value = $("dateInp").value;
        // 2. à¸ªà¸±à¹ˆà¸‡à¹ƒà¸«à¹‰à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸„à¸³à¸™à¸§à¸“à¹€à¸¥à¸‚à¸šà¸±à¸à¸Šà¸µà¸—à¸³à¸‡à¸²à¸™à¸—à¸±à¸™à¸—à¸µ
        loadAccountStatus(); 
    }
}
    function saveDB() {localStorage.setItem("barber_db", JSON.stringify(db));localStorage.setItem("barber_conf", JSON.stringify(conf));}
    function delRec(id) { if (confirm("à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸™à¸µà¹‰?")) { db = db.filter(r => r.id !== id); saveDB(); renderDay(); } }
    function editTime(id) {const rec = db.find(r => r.id === id);if (!rec) return;const newStart = prompt("à¹à¸à¹‰à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡ (HH:MM)", rec.time);if (!newStart) return;const newEnd = prompt("à¹à¸à¹‰à¹€à¸§à¸¥à¸²à¹€à¸ªà¸£à¹‡à¸ˆ (HH:MM)", rec.endTime || "");rec.time = newStart;rec.endTime = newEnd || addMinutes(newStart, 30);saveDB();renderDay();}
    
    window.onclick = function(e) {const modals = [{ id: "reportModal", close: closeReportModal },{ id: "historyModal", close: closeHistoryModal },{ id: "configModal", close: closeConfigModal } ]; 
    modals.forEach(m => {const modalEl = $(m.id);if (modalEl && e.target === modalEl && typeof m.close === "function") {m.close();}});};
   window.addEventListener('load', () => {
    const n = new Date(), 
          t = n.getHours().toString().padStart(2, '0') + ':' + n.getMinutes().toString().padStart(2, '0'); 
    if(document.getElementById('tStart')) document.getElementById('tStart').value = t; 
    if(document.getElementById('tEnd')) document.getElementById('tEnd').value = t;
    const savedName = localStorage.getItem('shopName');
    const savedTheme = localStorage.getItem('shopTheme');
    if (savedName) {
        document.getElementById('shopNameDisp').innerText = savedName.toUpperCase();
        if(document.getElementById('setShop')) document.getElementById('setShop').value = savedName;
    }
    if (savedTheme) {
        if(document.getElementById('setTheme')) document.getElementById('setTheme').value = savedTheme;
        const body = document.body;
        if (savedTheme === 'navy') {
            body.style.background = '#1e3a8a';
            body.style.color = '#ffffff';
        } else if (savedTheme === 'dark') {
            body.style.background = '#0f172a';
            body.style.color = '#e2e8f0';
        } else {
            body.style.background = '#f8fafc';
            body.style.color = '#1e293b';
        }
    }
});
     // 1. à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¹ˆà¸‡à¸­à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
        function exportBackup() {
            const data = {
                db: JSON.parse(localStorage.getItem("barber_db") || "[]"),
                archives: JSON.parse(localStorage.getItem("barber_archives") || "[]")
            };
            const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `backup-barber-${new Date().toLocaleDateString()}.json`;
            a.click();
        }
        // 2. à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸™à¸³à¹€à¸‚à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
        function importBackup(input) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if(confirm("âš ï¸ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸”à¸´à¸¡à¸ˆà¸°à¸–à¸¹à¸à¹€à¸‚à¸µà¸¢à¸™à¸—à¸±à¸š à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸•à¹ˆà¸­à¹ƒà¸Šà¹ˆà¹„à¸«à¸¡?")) {
                        localStorage.setItem("barber_db", JSON.stringify(data.db || []));
                        localStorage.setItem("barber_archives", JSON.stringify(data.archives || []));
                        alert("âœ… à¸™à¸³à¹€à¸‚à¹‰à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!");
                        location.reload();
                    }
                } catch(err) {
                    alert("âŒ à¹„à¸Ÿà¸¥à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡");
                }
            };
            if (input.files[0]) {
                reader.readAsText(input.files[0]);
            }
        }
        // 3. à¸•à¸±à¸§à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™ Service Worker (à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸­à¸­à¸Ÿà¹„à¸¥à¸™à¹Œà¹„à¸”à¹‰)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker à¸ˆà¸”à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!'))
                    .catch(err => console.log('à¸ˆà¸”à¸—à¸°à¹€à¸šà¸µà¸¢à¸™à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ:', err));
            });
        }

     function clearData() {
    if (confirm("âš ï¸ à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”? à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸–à¸¹à¸à¸¥à¸šà¸ˆà¸²à¸à¸£à¸°à¸šà¸š!")) {
    
        localStorage.removeItem("barber_db");
        localStorage.removeItem("barber_archives");
        
        alert("âœ… à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!");
        location.reload();
    }
}
</script>
</body>
</html>
