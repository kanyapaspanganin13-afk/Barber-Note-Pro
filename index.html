<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.1.1.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #00CCFF; --accent: #16a34a; --danger: #dc2626; --warning: #f59e0b;
            --main-bg: #f1f5f9; --card: #ffffff; --text: #1e293b; --input-bg: #f8fafc; --border: #e2e8f0;
            --bg-brightness: 1;
        }
        body.theme-deep { --main-bg: #0f172a; --card: #1e293b; --text: #f8fafc; --input-bg: #334155; --border: #475569; }
        body.theme-dark { --main-bg: #000000; --card: #111111; --text: #00CCFF; --input-bg: #222; --border: #333; }
        body.theme-pastel { --main-bg: #faf5ff; --card: #ffffff; --text: #4c1d95; --input-bg: #f5f3ff; --border: #e9d5ff; }

        body { 
            margin: 0; font-family: 'Kanit', sans-serif; background: var(--main-bg); color: var(--text); 
            padding-bottom: 90px; transition: 0.3s; font-weight: 300;
            filter: brightness(var(--bg-brightness));
        }

        header { padding: 12px 15px; background: var(--card); display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top:0; z-index:100; }
        header h1 { flex: 1; text-align: center; font-size: 18px; margin: 0; font-weight: 500; }

        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; border-top: 1px solid rgba(0,0,0,0.1); height: 70px; align-items: center; justify-content: space-around; z-index: 9999; }
        .nav-item { flex: 1; text-align: center; color: #94a3b8; font-size: 12px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: 0.2s; }
        .nav-item.active { color: var(--primary); font-weight: 500; transform: translateY(-2px); }
        .nav-item i { font-size: 20px; }

        .page { display: none; padding: 12px; animation: fadeIn 0.2s; } 
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); border-radius: 18px; padding: 14px; margin-bottom: 10px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        input, select, button { font-family: 'Kanit'; outline: none; }
        input, select { width: 100%; height: 45px; padding: 8px 12px; border-radius: 12px; border: 1px solid var(--border); font-size: 15px; background: var(--input-bg); color: var(--text); }

        .btn-pay { border: 2px solid var(--border); background: var(--input-bg); color: var(--text); padding: 10px; border-radius: 12px; font-weight: 500; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .active-cash { border: 2px solid #16a34a !important; color: #16a34a !important; background: #dcfce7 !important; }
        .active-transfer { border: 2px solid #0284c7 !important; color: #0284c7 !important; background: #e0f2fe !important; }
        .btn-save { background: var(--primary); color: white; width: 100%; padding: 12px; border-radius: 12px; font-size: 16px; font-weight: 600; border: none; cursor: pointer; }
        
        .status-bar { width: 100%; padding: 12px; border-radius: 12px; text-align: center; font-weight: 600; font-size: 14px; margin-bottom: 10px; }
        .status-blue { background: #e0f2fe; color: #0284c7; }
        .status-red { background: #fee2e2; color: #dc2626; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px; }
        .modal-content { background: var(--card); width: 100%; border-radius: 20px; padding: 20px; max-height: 85vh; overflow-y: auto; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 8px; background: var(--input-bg); font-size: 11px; margin: 2px; border: 1px solid var(--border); }
        
        .history-row { padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .btn-toggle-history { width: 100%; padding: 12px; border-radius: 12px; border: 1px dashed var(--primary); background: rgba(0,204,255,0.05); color: var(--primary); cursor: pointer; margin-top: 10px; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body id="mainBody">

<header>
    <div style="width:40px"></div>
    <h1 id="shopNameDisp">Barber Note</h1>
    <div onclick="openSettings()" style="cursor:pointer; font-size: 20px;"><i class="fas fa-cog"></i></div>
</header>

<div id="p1" class="page active">
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px;">
        <div style="position: relative; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 10px; text-align: center; cursor: pointer;">
            <span style="font-size: 18px;">üìÖ</span>
            <input type="date" id="dateInp" onchange="updateDateDisplay(this.value)" style="position: absolute; inset:0; opacity:0; cursor:pointer;">
            <div id="dateDisplay" style="font-size: 10px; font-weight: 700;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</div>
        </div>
        <div onclick="alert('‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ 2')" style="background: #fffbeb; border: 1px solid #fde68a; border-radius: 12px; padding: 10px; text-align: center; color: #b45309;">
            <span style="font-size: 18px;">üõ°Ô∏è</span><div style="font-size: 10px; font-weight: 800;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</div>
        </div>
        <div onclick="saveHoliday()" style="background: #fff1f2; border: 1px solid #fecdd3; border-radius: 12px; padding: 10px; text-align: center; color: #be185d;">
            <span style="font-size: 18px;">üèñÔ∏è</span><div style="font-size: 10px; font-weight: 800;">‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</div>
        </div>
    </div>

    <div class="card" style="border-left: 5px solid var(--primary);">
        <select id="hairStyle" onchange="autoPrice(this.value)">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏° --</option>
            <option value="‡πÄ‡∏î‡πá‡∏Å">üë∂ ‡∏ï‡∏±‡∏î‡∏ú‡∏°‡πÄ‡∏î‡πá‡∏Å (‡∏û‡∏¥‡πÄ‡∏®‡∏©)</option>
            <option value="‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á">‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option>
            <option value="‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î">‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option>
            <option value="‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô">‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô/‡πÅ‡∏Å‡∏∞‡∏•‡∏≤‡∏¢</option>
            <option value="‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
            <option value="‡πÇ‡∏Å‡∏ô/‡∏Å‡∏±‡∏ô">‡πÇ‡∏Å‡∏ô‡∏ú‡∏°/‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option>
        </select>
        <div class="grid-2" style="margin-top:10px;">
            <select id="extra1"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô 1</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option></select>
            <select id="extra2"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô 2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡πÄ‡∏ã‡πá‡∏ï‡∏ú‡∏°</option></select>
        </div>
    </div>

    <div class="card" style="border-left: 5px solid var(--warning);">
        <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="font-size:40px; font-weight:600; text-align:center; height:80px; color:var(--warning);">
        <div class="grid-2" style="margin-top:10px;">
            <input type="time" id="tStart" style="text-align:center;">
            <input type="time" id="tEnd" style="text-align:center;">
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 8px; margin-top: 15px;">
            <button id="btnCash" class="btn-pay" onclick="selectPay('Cash')">‡∏™‡∏î</button>
            <button id="btnTrans" class="btn-pay" onclick="selectPay('Trans')">‡πÇ‡∏≠‡∏ô</button>
            <button class="btn-save" id="mainSaveBtn" onclick="handleSave()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<div id="p2" class="page">
    <div class="grid-2">
        <div class="card" style="text-align: center;">
            <label>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
            <div id="dTotal" style="font-size:28px; font-weight:700">0</div>
            <div id="dCounts" style="font-size:14px; color:var(--primary);">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: 0 ‡∏Ñ‡∏ô</div>
        </div>
        <div class="card" style="font-size: 13px;">
            <div>üì± ‡πÇ‡∏≠‡∏ô: <b id="dTrans">0</b></div>
            <div>ü§µ ‡∏ä‡πà‡∏≤‡∏á: <b id="dBarber">0</b></div>
            <div>üè† ‡∏£‡πâ‡∏≤‡∏ô: <b id="dShop">0</b></div>
        </div>
    </div>
    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 10px;">
        <div id="settleBar" class="status-bar status-blue" style="margin:0; flex: 1;">‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ</div>
        <button onclick="closeDay()" style="background:var(--primary); color:white; border:none; width:50px; height:45px; border-radius:12px; font-size:20px;">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
            <i class="fab fa-line" style="color:#06C755; font-size:24px; cursor:pointer;" onclick="shareLine()"></i>
        </div>
        <div id="dServiceStats" style="margin-bottom:10px;"></div>
        <div id="dailyList"></div>
    </div>
</div>

<div id="p3" class="page">
    <div class="card" style="background: linear-gradient(135deg, var(--card) 0%, var(--input-bg) 100%);">
        <div style="display:flex; justify-content:space-between; font-size:12px; opacity:0.7;">
            <span>‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢</span>
            <span id="accDateNow"></span>
        </div>
        <div style="text-align:center; margin:15px 0;">
            <span style="font-size:40px; font-weight:800;">‡∏ø<span id="accNet">0</span></span>
        </div>
        <div id="accStatus" class="status-bar" style="margin-bottom:15px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...</div>
        
        <input type="text" id="accNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ô‡∏µ‡πâ)" style="margin-bottom:10px;">
        <button class="btn-save" onclick="clearAccount()" style="background:var(--accent);">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏®‡∏π‡∏ô‡∏¢‡πå)</button>
    </div>

    <div class="grid-2" style="margin-top:10px;">
        <button class="btn-toggle-history" onclick="toggleAcc('dailyAcc')"><i class="fas fa-calendar-day"></i> ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
        <button class="btn-toggle-history" onclick="toggleAcc('monthlyAcc')"><i class="fas fa-chart-line"></i> ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
    </div>

    <div id="dailyAcc" class="page" style="padding:10px 0;">
        <input type="date" id="histDate" onchange="loadHistDaily()">
        <div id="histDailyArea" style="margin-top:10px;"></div>
    </div>
    <div id="monthlyAcc" class="page" style="padding:10px 0;">
        <input type="month" id="histMonth" onchange="loadHistMonth()">
        <div id="histMonthArea" style="margin-top:10px;"></div>
    </div>
</div>

<div id="modalSet" class="modal">
    <div class="modal-content">
        <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô / ‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á</label>
        <input id="setShop">
        <div class="grid-2" style="margin-top:10px">
            <div><label>% ‡∏ä‡πà‡∏≤‡∏á</label><input type="number" id="setPerc"></div>
            <div><label>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</label><input type="number" id="setGuar"></div>
        </div>
        <div class="grid-2" style="margin-top:15px">
            <div><label>üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label><select id="setSound"><option value="on">‡πÄ‡∏õ‡∏¥‡∏î</option><option value="off">‡∏õ‡∏¥‡∏î</option></select></div>
            <div><label>‡∏ò‡∏µ‡∏°</label><select id="setTheme" onchange="applyTheme(this.value)">
                <option value="neon">Neon Light</option>
                <option value="deep">Deep Navy</option>
                <option value="dark">Barber Dark</option>
                <option value="pastel">Pastel</option>
            </select></div>
        </div>
        <div style="margin-top:15px;">
            <label>üîÜ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á (<span id="brightVal">100</span>%)</label>
            <input type="range" id="setBright" min="0.3" max="1.2" step="0.1" oninput="updateBrightness(this.value)">
        </div>
        <div class="grid-2" style="margin-top:20px;">
            <button class="btn-save" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button onclick="closeSettings()" style="background:none; border:1px solid var(--border); border-radius:12px;">‡∏õ‡∏¥‡∏î</button>
        </div>
        <button onclick="localStorage.clear(); location.reload();" style="width:100%; border:none; background:none; color:red; margin-top:20px; font-size:10px; opacity:0.5;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
</div>

<nav class="nav">
    <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-cut"></i><span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</span></div>
    <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-clipboard-list"></i><span>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span></div>
    <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-chart-pie"></i><span>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span></div>
</nav>

<script>
    let payMethod = "", 
        conf = JSON.parse(localStorage.getItem("barber_conf")) || {shop:"Barber Shop", perc:50, guar:0, theme:"neon", bright:1, sound:"on", voice:"female"},
        db = JSON.parse(localStorage.getItem("barber_db")) || [],
        archives = JSON.parse(localStorage.getItem("barber_arc")) || [],
        account = JSON.parse(localStorage.getItem("barber_account")) || {balance:0, logs:[]};

    const $ = (id) => document.getElementById(id);

    window.onload = () => {
        $("dateInp").valueAsDate = new Date();
        updateDateDisplay($("dateInp").value);
        applySettings();
        autoTime();
    };

    function go(n) {
        document.querySelectorAll('.page, .nav-item').forEach(el => el.classList.remove('active'));
        if(n===1 || n===2 || n===3) $("p"+n).classList.add('active');
        $("n"+n).classList.add('active');
        if(n===2) renderDay();
        if(n===3) loadAccountStatus();
    }

    function applySettings() {
        $("shopNameDisp").innerText = conf.shop;
        document.body.className = "theme-" + conf.theme;
        updateBrightness(conf.bright);
    }

    function updateBrightness(val) {
        document.documentElement.style.setProperty('--bg-brightness', val);
        if($("brightVal")) $("brightVal").innerText = Math.round(val * 100);
    }

    function openSettings() {
        $("modalSet").style.display = "flex";
        $("setShop").value = conf.shop; $("setPerc").value = conf.perc;
        $("setGuar").value = conf.guar; $("setTheme").value = conf.theme;
        $("setBright").value = conf.bright;
    }

    function saveSettings() {
        conf.shop = $("setShop").value; conf.perc = $("setPerc").value;
        conf.guar = $("setGuar").value; conf.theme = $("setTheme").value;
        conf.bright = $("setBright").value;
        localStorage.setItem("barber_conf", JSON.stringify(conf));
        applySettings(); closeSettings();
    }

    function closeSettings() { $("modalSet").style.display = "none"; }

    function selectPay(m) {
        payMethod = m;
        $("btnCash").className = m==='Cash' ? 'btn-pay active-cash' : 'btn-pay';
        $("btnTrans").className = m==='Trans' ? 'btn-pay active-transfer' : 'btn-pay';
    }

    function autoTime() {
        let now = new Date();
        $("tStart").value = now.getHours().toString().padStart(2,'0')+":"+now.getMinutes().toString().padStart(2,'0');
    }

    function handleSave() {
        const p = $("priceInp").value;
        if(!p || !payMethod) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô");
        
        db.push({
            id: Date.now(),
            date: $("dateInp").value,
            time: $("tStart").value + "-" + ($("tEnd").value || $("tStart").value),
            hair: $("hairStyle").value,
            svcs: [ $("hairStyle").value, $("extra1").value, $("extra2").value ].filter(s => s !== ""),
            price: Number(p),
            pay: payMethod
        });
        localStorage.setItem("barber_db", JSON.stringify(db));
        
        $("mainSaveBtn").innerText = "‚úì ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        setTimeout(() => {
            $("mainSaveBtn").innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å";
            $("priceInp").value = "";
            autoTime(); selectPay("");
        }, 800);
    }

    function renderDay() {
        const d = $("dateInp").value, today = db.filter(r => r.date === d);
        let tot=0, trans=0, cash=0, stats={}, listHtml="";
        
        today.forEach(r => {
            tot += r.price;
            r.pay === 'Trans' ? trans += r.price : cash += r.price;
            if(r.hair === "‡πÄ‡∏î‡πá‡∏Å") stats["‡πÄ‡∏î‡πá‡∏Å"] = (stats["‡πÄ‡∏î‡πá‡∏Å"] || 0) + 1;
            r.svcs.forEach(s => { if(s) stats[s] = (stats[s] || 0) + 1; });

            listHtml += `<div class="history-row"><div style="display:flex; justify-content:space-between"><span>${r.time} | ${r.svcs.join('+')}</span><b>‡∏ø${r.price}</b></div><div style="font-size:11px; opacity:0.6">${r.pay==='Cash'?'üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î':'üì± ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô'} <i class="fas fa-trash" onclick="delRec(${r.id})" style="margin-left:10px; color:red"></i></div></div>`;
        });

        const bEarn = Math.max(tot * (conf.perc/100), conf.guar), settle = cash - bEarn;
        $("dTotal").innerText = tot.toLocaleString();
        $("dTrans").innerText = trans.toLocaleString();
        $("dBarber").innerText = Math.floor(bEarn).toLocaleString();
        $("dShop").innerText = Math.floor(tot - bEarn).toLocaleString();
        $("dCounts").innerText = `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`;
        $("dailyList").innerHTML = listHtml || "<center style='opacity:0.3; padding:20px;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";

        let sH = ""; for(let s in stats) sH += `<span class="badge">${s}: ${stats[s]}</span>`;
        $("dServiceStats").innerHTML = sH;

        const b = $("settleBar");
        if(settle > 0) { b.innerText = `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle)}`; b.className="status-bar status-red"; }
        else if(settle < 0) { b.innerText = `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle))}`; b.className="status-bar status-blue"; }
        else { b.innerText = "‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ"; b.className="status-bar status-blue"; }
    }

    function closeDay() {
        const d = $("dateInp").value, today = db.filter(r => r.date === d);
        if(!today.length) return;
        if(confirm("‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥?")) {
            const tot = today.reduce((a,b)=>a+b.price, 0);
            const cash = today.filter(r=>r.pay==='Cash').reduce((a,b)=>a+b.price, 0);
            const bEarn = Math.max(tot * (conf.perc/100), conf.guar);
            
            archives.push({date: d, total: tot, barber: bEarn, cash: cash, count: today.length});
            account.balance += (cash - bEarn);
            
            localStorage.setItem("barber_arc", JSON.stringify(archives));
            localStorage.setItem("barber_account", JSON.stringify(account));
            db = db.filter(r => r.date !== d);
            localStorage.setItem("barber_db", JSON.stringify(db));
            go(3);
        }
    }

    function loadAccountStatus() {
        const net = account.balance;
        $("accNet").innerText = Math.abs(net).toLocaleString();
        const b = $("accStatus");
        if(net > 0) { b.innerText = "üö© ‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô"; b.className="status-bar status-red"; }
        else if(net < 0) { b.innerText = "üö© ‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á"; b.className="status-bar status-blue"; }
        else { b.innerText = "‚úÖ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡πâ‡∏ß"; b.className="status-bar"; }
    }

    function clearAccount() {
        if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
            account.logs.unshift({date: new Date().toLocaleDateString(), amount: account.balance, note: $("accNote").value});
            account.balance = 0;
            localStorage.setItem("barber_account", JSON.stringify(account));
            loadAccountStatus();
            $("accNote").value = "";
        }
    }

    function toggleAcc(id) {
        $("dailyAcc").style.display = id==='dailyAcc'?'block':'none';
        $("monthlyAcc").style.display = id==='monthlyAcc'?'block':'none';
    }

    function updateDateDisplay(v) { $("dateDisplay").innerText = v; }
    function delRec(id) { if(confirm("‡∏•‡∏ö?")) { db = db.filter(r=>r.id!==id); localStorage.setItem("barber_db", JSON.stringify(db)); renderDay(); } }
    function autoPrice(v) { if(v==="‡πÄ‡∏î‡πá‡∏Å") $("priceInp").value = 100; else $("priceInp").value = ""; }
</script>
</body>
</html>
