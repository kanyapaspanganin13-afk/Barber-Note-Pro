<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.2.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; }
        
        /* --- Theme Definitions --- */
        body.theme-deep-navy { --primary: #38bdf8; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --border: #334155; }
        body.theme-barber-dark { --primary: #fbbf24; --bg: #18181b; --card: #27272a; --text: #f4f4f5; --border: #3f3f46; }
        body.theme-neon-light { --primary: #8b5cf6; --bg: #f5f3ff; --card: #ffffff; --text: #1e1b4b; --border: #ddd6fe; }

        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; transition: 0.3s; }
        .container { padding: 10px; max-width: 500px; margin: auto; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
        .icon-card { position: relative; border-radius: 12px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1.5px solid transparent; background: var(--card); }
        .icon-card span { font-size: 10px; font-weight: 800; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 12px; font-size: 14px; background: var(--card); color: inherit; outline: none; transition: 0.3s; }
        .price-box { font-size: 40px; font-weight: bold; text-align: center; color: var(--primary); padding: 10px; border: 2px solid var(--primary); border-radius: 15px; margin-bottom: 15px; width: 100%; background: var(--card); display: block; }
        .btn { border: none; padding: 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 600; transition: 0.2s; }
        .btn-pay { background: #e2e8f0; color: #64748b; }
        .btn-pay.active-cash { background: #dcfce7; color: #15803d; border: 2px solid #22c55e; }
        .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border: 2px solid #0ea5e9; }
        .btn-main { background: var(--primary); color: white; width: 100%; font-size: 28px; height: 60px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-item { border: none; background: none; color: #94a3b8; font-size: 11px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-item.active { color: var(--primary); }
        .page { display: none; } .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 14px; }
        .status-red { background: #fee2e2; color: #dc2626; }
        .status-indigo { background: #e0e7ff; color: #3730a3; }
        .status-green { background: #dcfce7; color: #16a34a; }
        .history-row { padding: 12px; border-bottom: 1px solid var(--border); font-size: 14px; background: var(--card); margin-bottom: 5px; border-radius: 10px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; backdrop-filter: blur(4px); }
        .modal-content { background: var(--card); padding: 20px; border-radius: 25px; width: 100%; max-width: 400px; color: var(--text); }
        .card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
    </style>
</head>
<body id="mainBody">

<div class="container">
    <h2 id="shopNameDisp" style="text-align:center; color:var(--primary); margin: 10px 0;">Barber Shop</h2>

    <div id="p1" class="page active">
        <div class="grid-3">
            <div class="icon-card" onclick="openSettings()">üõ°Ô∏è<span>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</span></div>
            <div class="icon-card" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô')">üèñÔ∏è<span>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span></div>
            <div class="icon-card" onclick="openSettings()">‚öôÔ∏è<span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span></div>
        </div>
        <div class="grid-3">
            <div class="icon-card">üìÖ<span id="dateDisplay">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span><input type="date" id="dateInp" onchange="updateDateDisplay(this.value)" style="position:absolute;inset:0;opacity:0"></div>
            <input id="tStart" type="tel" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°" style="text-align:center;">
            <input id="tEnd" type="tel" placeholder="‡πÄ‡∏™‡∏£‡πá‡∏à" style="text-align:center;">
        </div>
        <div class="grid-3">
            <select id="hairStyle"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏°</option><option value="‡πÄ‡∏î‡πá‡∏Å">üë∂ ‡πÄ‡∏î‡πá‡∏Å</option><option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option></select>
            <select id="extra1"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option></select>
            <select id="extra2"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 2</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option></select>
        </div>
        <input id="priceInp" class="price-box" type="number" placeholder="0">
        <div class="grid-2">
            <button id="btnCash" class="btn btn-pay" onclick="selectPay('Cash')">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
            <button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">üì± ‡πÇ‡∏≠‡∏ô</button>
        </div>
        <button class="btn btn-main" onclick="handleSave()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>

    <div id="p2" class="page">
        <div class="card" style="display:flex;gap:10px;">
            <div style="flex:8;font-size:13px">
                <div style="display:flex;justify-content:space-between"><span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span><b id="dTotal">‡∏ø0</b></div>
                <div style="display:flex;justify-content:space-between"><span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span><b id="dCustomer">0 ‡∏Ñ‡∏ô</b></div>
                <div style="display:flex;justify-content:space-between"><span>üì± ‡πÇ‡∏≠‡∏ô</span><b id="dTrans">‡∏ø0</b></div>
                <div style="display:flex;justify-content:space-between"><span>ü§µ ‡∏ä‡πà‡∏≤‡∏á</span><b id="dBarber">‡∏ø0</b></div>
            </div>
            <div style="flex:4">
                <div id="settleBar" class="status-bar status-indigo" style="padding:5px;font-size:10px">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                <button class="btn" style="background:var(--accent);color:#fff;width:100%" onclick="shareLinePreview()">üì± Line</button>
            </div>
        </div>
        <div id="dailyList"></div>
    </div>

    <div id="p3" class="page">
        <div class="card" style="text-align:center">
            <span>‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
            <h1 id="accNet" style="color:var(--primary);margin:5px 0">‡∏ø0</h1>
            <div class="grid-2" style="font-size:12px;opacity:0.7">
                <div>‡πÄ‡∏î‡∏¥‡∏°: <b id="accOldVal">0</b></div>
                <div>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: <b id="accTodayVal">0</b></div>
            </div>
        </div>
        <div class="grid-2">
            <input id="accNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
            <button class="btn" style="background:var(--success);color:#fff" onclick="clearAccount()">‚úî ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î</button>
        </div>
        <div id="accountList"></div>
    </div>
</div>

<nav class="nav-bar">
    <button id="n1" class="nav-item active" onclick="go(1)"><i class="fas fa-cut"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button id="n2" class="nav-item" onclick="go(2)"><i class="fas fa-file-lines"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    <button id="n3" class="nav-item" onclick="go(3)"><i class="fas fa-wallet"></i>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
</nav>

<div id="modalSet" class="modal">
    <div class="modal-content">
        <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <label style="font-size:11px">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label>
        <input id="setShop">
        <div class="grid-2" style="margin-top:8px">
            <input type="number" id="setPerc" placeholder="% ‡∏ä‡πà‡∏≤‡∏á">
            <input type="number" id="setGuar" placeholder="‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏ß‡∏±‡∏ô">
        </div>
        <div style="margin-top:8px">
            <select id="setTheme">
                <option value="neon-light">üå§ Neon Light</option>
                <option value="deep-navy">üåå Deep Navy</option>
                <option value="barber-dark">üåë Barber Dark</option>
            </select>
        </div>
        <div class="grid-2" style="margin-top:8px">
            <select id="setSound"><option value="on">üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡∏¥‡∏î</option><option value="off">üîá ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏¥‡∏î</option></select>
            <select id="setVoiceGender"><option value="female">üë© ‡∏´‡∏ç‡∏¥‡∏á</option><option value="male">üë® ‡∏ä‡∏≤‡∏¢</option></select>
        </div>
        <div class="grid-2" style="margin-top:15px">
            <button class="btn" style="background:var(--primary);color:#fff" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <button class="btn" style="background:#ccc" onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
        </div>
        <button class="btn" style="width:100%;background:var(--danger);color:#fff;margin-top:10px" onclick="clearAllData()">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
</div>

<script>
let db=JSON.parse(localStorage.getItem("barber_db"))||[],
conf=JSON.parse(localStorage.getItem("barber_conf"))||{shop:"Barber Shop",perc:50,guar:0,theme:"neon-light",sound:"on",voicegender:"female"},
account=JSON.parse(localStorage.getItem("barber_account"))||{balance:0,logs:[]}, payMethod="";

const $=id=>document.getElementById(id);

window.onload=()=>{
    let t=new Date().toISOString().split("T")[0];
    if($("dateInp")) $("dateInp").value=t;
    applySettings();
    renderDay();
};

function applySettings(){
    $("shopNameDisp").innerText = conf.shop;
    document.body.className = "theme-" + conf.theme;
}

function openSettings(){
    $("modalSet").style.display="flex";
    $("setShop").value = conf.shop;
    $("setPerc").value = conf.perc;
    $("setGuar").value = conf.guar;
    $("setTheme").value = conf.theme;
    $("setSound").value = conf.sound;
    $("setVoiceGender").value = conf.voicegender;
}

function closeSettings(){ $("modalSet").style.display="none"; }

function saveSettings(){
    conf.shop=$("setShop").value;
    conf.perc=+$("setPerc").value;
    conf.guar=+$("setGuar").value;
    conf.theme=$("setTheme").value;
    conf.sound=$("setSound").value;
    conf.voicegender=$("setVoiceGender").value;
    localStorage.setItem("barber_conf",JSON.stringify(conf));
    applySettings(); closeSettings(); speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); renderDay();
}

function speak(t){
    if(conf.sound!=="on") return;
    speechSynthesis.cancel();
    let u=new SpeechSynthesisUtterance(t);
    u.lang="th-TH";
    u.pitch = conf.voicegender==="male" ? 0.8 : 1.1;
    speechSynthesis.speak(u);
}

function go(n){
    document.querySelectorAll(".page, .nav-item").forEach(el=>el.classList.remove("active"));
    $("p"+n).classList.add("active");
    $("n"+n).classList.add("active");
    renderDay();
}

function selectPay(m){
    payMethod=m;
    $("btnCash").className=m==="Cash"?"btn btn-pay active-cash":"btn btn-pay";
    $("btnTrans").className=m==="Trans"?"btn btn-pay active-trans":"btn btn-pay";
}

function handleSave(){
    let p=+$("priceInp").value;
    if(!p||!payMethod) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô");
    db.push({
        id:Date.now(),
        date:$("dateInp").value,
        time:($("tStart").value||"--")+":"+($("tEnd").value||"--"),
        svcs:[$("hairStyle").value,$("extra1").value,$("extra2").value].filter(Boolean),
        price:p, pay:payMethod
    });
    localStorage.setItem("barber_db",JSON.stringify(db));
    speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å " + p + " ‡∏ö‡∏≤‡∏ó");
    $("priceInp").value=""; $("tEnd").value=""; selectPay(""); renderDay();
}

function renderDay(){
    let d=$("dateInp").value, list=db.filter(r=>r.date===d);
    let tot=0, cash=0, trans=0, html="";
    list.forEach(r=>{
        tot+=r.price; r.pay==="Cash"?cash+=r.price:trans+=r.price;
        html+=`<div class="history-row"><b>${r.time}</b> | ${r.svcs.join("+")} | ‡∏ø${r.price} <i onclick="delRec(${r.id})" style="float:right;color:red">üóëÔ∏è</i></div>`;
    });
    let earn=Math.max(tot*(conf.perc/100),conf.guar);
    let settle=cash-earn;

    if($("dTotal")) $("dTotal").innerText="‡∏ø"+tot.toLocaleString();
    if($("dCustomer")) $("dCustomer").innerText=list.length+" ‡∏Ñ‡∏ô";
    if($("dTrans")) $("dTrans").innerText="‡∏ø"+trans.toLocaleString();
    if($("dBarber")) $("dBarber").innerText="‡∏ø"+Math.floor(earn).toLocaleString();
    if($("dailyList")) $("dailyList").innerHTML=html||"<center style='padding:20px'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";
    
    let bar=$("settleBar");
    if(bar){
        bar.innerText = settle>=0 ? "‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø"+Math.floor(settle) : "‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô ‡∏ø"+Math.floor(-settle);
        bar.className = "status-bar " + (settle>=0?"status-red":"status-indigo");
    }

    $("accOldVal").innerText = "‡∏ø"+(account.balance||0).toLocaleString();
    $("accTodayVal").innerText = "‡∏ø"+Math.floor(settle).toLocaleString();
    let net=(account.balance||0)+settle;
    $("accNet").innerText = "‡∏ø"+Math.abs(Math.floor(net)).toLocaleString();
}

function delRec(id){
    if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")){
        db=db.filter(r=>r.id!==id);
        localStorage.setItem("barber_db",JSON.stringify(db));
        renderDay();
    }
}

function clearAccount(){
    let s=Math.floor(parseFloat($("accTodayVal").innerText.replace(/[^\d.-]/g, '')));
    let net=(account.balance||0)+s;
    account.logs.unshift({date:new Date().toLocaleDateString("th-TH"),amount:net,note:$("accNote").value});
    account.balance = 0-s; 
    localStorage.setItem("barber_account",JSON.stringify(account));
    $("accNote").value=""; renderDay(); speak("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
}

function shareLinePreview(){
    let d=$("dateInp").value, today=db.filter(r=>r.date===d);
    if(!today.length) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
    let msg=`üíà ${conf.shop}\nüìÖ ${d}\n---\n`;
    today.forEach((r,i)=>msg+=`${i+1}. ${r.svcs.join('+')} = ${r.price}\n`);
    window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
}

function clearAllData(){ if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){localStorage.clear();location.reload();}}
function updateDateDisplay(v){ $("dateDisplay").innerText=v; renderDay(); }
</script>
</body>
</html>
