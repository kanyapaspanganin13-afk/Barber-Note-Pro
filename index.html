<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.2.3.6</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
 <style>
    :root { 
        --primary: #6366f1; 
        --accent: #0ea5e9; 
        --danger: #ef4444; 
        --success: #22c55e; 
        --bg: #f8fafc; 
        --card: #ffffff; 
        --text: #1e293b; 
        --border: #e2e8f0; 
    }

    * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 100px; overflow-x: hidden; }
    
    .container { padding: 15px; max-width: 500px; margin: auto; }

    /* 1. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô Grid ‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° */
    .grid-3 { 
        display: grid; 
        grid-template-columns: 1fr 1fr 1fr; 
        gap: 10px; 
        margin-bottom: 20px; 
    }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }

    /* 2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏á input/select (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤) */
    input, select { 
        width: 100%; 
        height: 70px; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á */
        padding: 5px; 
        border: 1.5px solid var(--border); 
        border-radius: 15px; 
        font-size: 20px; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ */
        font-weight: 800; 
        background: #f1f5f9; 
        outline: none; 
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* ‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô */
    input[type="text"], input[type="date"] {
        font-size: 22px;
    }

    /* 3. ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î Price Box ‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏î‡∏∏‡∏• */
    .price-box { 
        font-size: 80px; 
        font-weight: 800; 
        text-align: center; 
        color: #64748b; 
        padding: 20px; 
        border: 2px solid var(--primary); 
        border-radius: 25px; 
        margin-bottom: 25px; 
        width: 100%; 
        background: #fff; 
        display: flex;
        align-items: center;
        justify-content: center;
        height: 130px; 
    }

    /* 4. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô */
    .btn { border: none; padding: 12px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.2s; }
    
    .btn-pay { background: #e2e8f0; height: 65px; font-size: 18px; }
    .btn-main { background: var(--primary); color: white; width: 100%; height: 80px; border-radius: 20px; font-size: 32px; }

    /* 5. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Navbar ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô (‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÑ‡∏ß‡πâ) */
    .nav-bar { 
        position: fixed; 
        bottom: 0; 
        left: 0; 
        right: 0; 
        background: #fff; 
        display: flex; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
        flex-direction: row; /* ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤ */
        justify-content: space-around; 
        padding: 10px 0; 
        border-top: 1px solid var(--border); 
        z-index: 1000;
        height: 75px;
    }
    
    .nav-item { 
        border: none; 
        background: none; 
        color: #94a3b8; 
        font-size: 12px; 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        justify-content: center;
        gap: 4px; 
        flex: 1; /* ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏°‡∏ô‡∏π‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÜ ‡∏Å‡∏±‡∏ô */
    }

    .nav-item.active { color: var(--primary); }
    .nav-item i { font-size: 24px; }

    /* ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ */
    .icon-card { border-radius: 15px; padding: 12px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .icon-card span:first-child { font-size: 20px; }
    .icon-card span:last-child { font-size: 11px; font-weight: 800; }
    .page { display: none; } .page.active { display: block; }
</style>
</head>
<body>

<div class="container">
    <h2 id="shopNameDisp" style="text-align:center; color:var(--primary); margin: 10px 0;">Barber Shop</h2>
    
    <div id="p1" class="page active">
        <div class="grid-3">
            <div class="icon-card" style="background: #fffbeb; border-color: #fde68a;" onclick="alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤')">
                <span>üõ°Ô∏è</span><span style="color: #b45309;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span>
            </div>
            <div class="icon-card" style="background: #fff1f2; border-color: #fecdd3;" onclick="alert('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏í‡∏ô‡∏≤')">
                <span>üèñÔ∏è</span><span style="color: #be185d;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span>
            </div>
            <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1;" onclick="alert('‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô Script')">
                <span>‚öôÔ∏è</span><span style="color: #475569;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
            </div>
        </div>

        <div class="grid-3">
            <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1; padding: 5px; height: 50px;">
                <span id="dateDisplay" style="font-size: 12px; font-weight: 700;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
                <input type="date" id="dateInp" onchange="updateDateDisplay(this.value)" style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer;">
            </div>
            <input type="time" id="tStart" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°" style="text-align:center; height: 50px;">
            <input type="time" id="tEnd" placeholder="‡πÄ‡∏™‡∏£‡πá‡∏à" style="text-align:center; height: 50px;">
        </div>

        <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 12px;">
            <select id="hairStyle" style="height: 50px;">
                <option value="">üíá ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏°</option>
                <option value="‡πÄ‡∏î‡πá‡∏Å">üë∂ ‡∏ï‡∏±‡∏î‡∏ú‡∏°‡πÄ‡∏î‡πá‡∏Å</option>
                <option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                <option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option></select>
            <select id="extra1" style="height: 50px;">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option> </select>
            <select id="extra2" style="height: 50px;">
                <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option></select>
        </div>
        <input type="number" id="priceInp" class="price-box" placeholder="0" inputmode="numeric">
        <div class="grid-2">
            <button id="btnCash" class="btn btn-pay" onclick="selectPay('Cash')">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
            <button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">üì± ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
        <button id="mainSaveBtn" class="btn btn-main" onclick="handleSave()"><i class="fas fa-save"></i></button>
    </div>

    <div id="p2" class="page">
        <div class="grid-2"><div class="card" style="text-align: center;">
                <label style="font-size: 13px; opacity: 0.8;">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
                <div id="dTotal" style="font-size:32px; font-weight:800; color:var(--primary);">0</div>
                <div id="dCounts" style="font-size:14px; font-weight:600; color:#64748b; margin-top:5px;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: 0 ‡∏Ñ‡∏ô</div>
            </div>
            <div class="card" style="display: flex; flex-direction: column; justify-content: center; gap: 5px;">
                <div style="font-size:15px; font-weight:600;">üì± ‡πÇ‡∏≠‡∏ô: <b id="dTrans" style="color:#0284c7">0</b></div>
                <div style="font-size:15px; font-weight:600;">ü§µ ‡∏ä‡πà‡∏≤‡∏á: <b id="dBarber" style="color:var(--accent)">0</b></div>
                <div style="font-size:15px; font-weight:600;">üè† ‡∏£‡πâ‡∏≤‡∏ô: <b id="dShop" style="color:var(--warning)">0</b></div>
            </div>
        </div>
        <div id="settleBar" class="status-bar status-indigo">‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ</div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <label style="font-weight: 600;">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
                <button onclick="shareLine()" style="background:#06C755; color:white; border:none; padding:8px 12px; border-radius:8px; font-size:12px;"><i class="fab fa-line"></i> ‡∏™‡πà‡∏á LINE</button>
            </div>
            <div id="dailyList"></div>
        </div>
        <button onclick="go(3)" style="position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--primary); color: white; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 24px;">
            <i class="fas fa-check-circle"></i>
        </button>
    </div>

    <div id="p3" class="page">
        <div class="acc-main-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; font-size:16px; color:#b45309;"><i class="fas fa-wallet"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h3>
                <div id="accLight" style="background:gray; width:12px; height:12px; border-radius:50%;"></div>
            </div>
            <div style="font-size:13px; color:#64748b; margin:15px 0; background:rgba(0,0,0,0.03); padding:12px; border-radius:15px;">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°:</span><b id="accOldVal">‡∏ø0</b></div>
                <div style="display:flex; justify-content:space-between;"><span>‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</span><b id="accTodayVal" style="color:var(--primary)">‡∏ø0</b></div>
            </div>
            <div style="text-align:center; margin:20px 0;">
                <div style="font-size:14px; opacity:0.6;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
                <div style="font-size:48px; font-weight:900; color:var(--primary);">‡∏ø<span id="accNet">0</span></div>
            </div>
            <div id="accStatus" class="status-bar">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            <button class="btn" onclick="toggleAccHistory()" style="width:100%; border:1px dashed var(--primary); background:#f0f7ff; color:var(--primary); margin-bottom:15px;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</button>
            <div id="accHistoryWrapper" style="display:none; margin-bottom:15px;"><div id="accHistory" class="card" style="font-size:12px; max-height:150px; overflow:y:auto;"></div></div>
            <div style="background:#f8fafc; padding:15px; border-radius:20px; border:1px solid var(--border);">
                <input type="date" id="accDate" style="margin-bottom:10px;">
                <input type="text" id="accNote" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥" style="margin-bottom:10px;">
                <button class="btn-save" onclick="clearAccount()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</button>
            </div>
        </div>
        <div class="card" style="margin-top:20px;">
            <label>üìÖ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</label>
            <input type="date" id="histDate" onchange="loadHistDaily()" style="margin:10px 0;">
            <div id="histDailyArea"></div>
        </div>
    </div>
<div id="modalSet" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--primary);">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3> <label style="font-size:11px; font-weight:600;">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label> <input id="setShop" style="margin-bottom:10px;">
        <div class="grid-2">
            <div>
                <label style="font-size:11px; font-weight:600;">% ‡∏ä‡πà‡∏≤‡∏á</label><input type="number" id="setPerc" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50"></div>
            <div>
                <label style="font-size:11px; font-weight:600;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏ß‡∏±‡∏ô</label> <input type="number" id="setGuar" placeholder="0"></div>
        </div>
        
        <div style="margin-top:10px">
            <label style="font-size:11px; font-weight:600;">‡∏ò‡∏µ‡∏°‡πÅ‡∏≠‡∏õ</label>
            <select id="setTheme">
                <option value="neon-light">üå§ Neon Light (Default)</option> <option value="deep-navy">üåå Deep Navy</option> <option value="barber-dark">üåë Barber Dark</option> </select>
        </div>
        <div class="grid-2" style="margin-top:10px">
            <div>
                <label style="font-size:11px; font-weight:600;">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label> <select id="setSound"> <option value="on">üîä ‡πÄ‡∏õ‡∏¥‡∏î</option> <option value="off">üîá ‡∏õ‡∏¥‡∏î</option></select>
            </div>
            <div>
                <label style="font-size:11px; font-weight:600;">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î</label><select id="setVoice"> <option value="female">üë© ‡∏´‡∏ç‡∏¥‡∏á</option> <option value="male">üë® ‡∏ä‡∏≤‡∏¢</option></select>
            </div>
        </div>
        <div class="grid-2" style="margin-top:20px">
            <button class="btn" style="background:var(--primary); color:#fff" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button class="btn" style="background:#e2e8f0; color:var(--text)" onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
        </div>
         <button class="btn" style="width:100%; background:var(--danger); color:#fff; margin-top:10px; font-size:12px;" onclick="clearAllData()">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
</div>
    <nav class="nav">
        <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
        <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-file-invoice"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
        <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-wallet"></i>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
    </nav>
</div>

<script>
    let db = JSON.parse(localStorage.getItem("barber_db")) || [];
    let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
    let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
    let payMethod = "";

    const $ = (id) => document.getElementById(id);

    window.onload = () => {
        const today = new Date().toISOString().split('T')[0];
        $("dateInp").value = today;
        $("accDate").value = today;
        $("histDate").value = today;
        updateDateDisplay(today);
    };

    function go(n) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        $(`p${n}`).classList.add('active');
        $(`n${n}`).classList.add('active');
        renderDay();
    }
    function openSettings() {
        $("setShop").value = conf.shop || "Barber Shop";
        $("setPerc").value = conf.perc || 50;
        $("setGuar").value = conf.guar || 0;
        $("modalSet").style.display = "block";
    }

    function closeSettings() {
        $("modalSet").style.display = "none";
    }

    function saveSettings() {
        conf.shop = $("setShop").value;
        conf.perc = Number($("setPerc").value);
        conf.guar = Number($("setGuar").value);
        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ò‡∏µ‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
        conf.theme = $("setTheme").value;
        conf.sound = $("setSound").value;
        
        localStorage.setItem("barber_conf", JSON.stringify(conf));
        $("shopNameDisp").innerText = conf.shop;
        
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        renderDay();
        closeSettings();
    }

    function clearAllData() {
        if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£!")) {
            localStorage.clear();
            location.reload();
        }
    }
    function updateDateDisplay(val) {
        const d = new Date(val);
        $("dateDisplay").innerText = d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' });
        renderDay();
    }

    function selectPay(m) {
        payMethod = m;
        $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;
        $("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;
    }

    function handleSave() {
        const p = $("priceInp").value;
        if (!p || !payMethod) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"); return; }
        const r = {
            id: Date.now(),
            date: $("dateInp").value,
            time: $("tStart").value || new Date().toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'}),
            svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(s => s),
            price: Number(p),
            pay: payMethod
        };
        db.push(r);
        localStorage.setItem("barber_db", JSON.stringify(db));
        $("priceInp").value = "";
        selectPay("");
        renderDay();
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
    }

    function renderDay() {
        const d = $("dateInp").value;
        const today = db.filter(r => r.date === d);
        let tot = 0, trans = 0, cash = 0, listHtml = "";

        today.forEach(r => {
            tot += r.price;
            r.pay === 'Trans' ? trans += r.price : cash += r.price;
            listHtml += `<div class="history-row">
                <span><b>${r.time}</b> | ${r.svcs.join('+')}</span>
                <span>‡∏ø${r.price} <i class="fas fa-trash" style="color:red; margin-left:10px" onclick="delRec(${r.id})"></i></span>
            </div>`;
        });

        const bEarn = Math.max(tot * (conf.perc / 100), conf.guar);
        const sEarn = tot - bEarn;
        const settle = cash - bEarn;

        if($("dTotal")) $("dTotal").innerText = tot.toLocaleString();
        if($("dTrans")) $("dTrans").innerText = trans.toLocaleString();
        if($("dBarber")) $("dBarber").innerText = Math.floor(bEarn).toLocaleString();
        if($("dShop")) $("dShop").innerText = Math.floor(sEarn).toLocaleString();
        if($("dCounts")) $("dCounts").innerText = `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`;
        $("dailyList").innerHTML = listHtml || "<center style='opacity:0.3;padding:20px'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";

        const net = (account.balance || 0) + settle;
        $("accOldVal").innerText = `‡∏ø${(account.balance || 0).toLocaleString()}`;
        $("accTodayVal").innerText = `‡∏ø${Math.floor(settle).toLocaleString()}`;
        $("accNet").innerText = Math.abs(net).toLocaleString();
        $("accLight").style.background = net > 0 ? "red" : net < 0 ? "blue" : "green";
        $("accStatus").innerText = net > 0 ? "üö© ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô" : net < 0 ? "üö© ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á" : "‚úÖ ‡∏¢‡∏≠‡∏î‡∏•‡∏á‡∏ï‡∏±‡∏ß";
        $("accStatus").className = "status-bar " + (net > 0 ? "status-red" : net < 0 ? "status-indigo" : "status-green");
    }

    function delRec(id) {
        if (confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
            db = db.filter(r => r.id !== id);
            localStorage.setItem("barber_db", JSON.stringify(db));
            renderDay();
        }
    }

    function clearAccount() {
        const net = (account.balance || 0) + (Number($("accTodayVal").innerText.replace('‡∏ø','')) || 0);
        if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô ‡∏ø${net} ?`)) {
            account.logs.unshift({ date: $("accDate").value, amount: net, note: $("accNote").value });
            account.balance = 0; 
            localStorage.setItem("barber_account", JSON.stringify(account));
            alert("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            renderDay();
        }
    }

    function toggleAccHistory() {
        const w = $("accHistoryWrapper");
        w.style.display = w.style.display === "none" ? "block" : "none";
        $("accHistory").innerHTML = account.logs.map(l => `<div>${l.date}: ‡∏ø${l.amount} (${l.note})</div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";
    }

    function loadHistDaily() {
        const d = $("histDate").value;
        const data = db.filter(r => r.date === d);
        $("histDailyArea").innerHTML = data.map(r => `<div class="history-row">${r.time} - ${r.svcs.join('+')} <b>‡∏ø${r.price}</b></div>`).join('') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
    }
    
    function shareLine() {
        const msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${$("dTotal").innerText}\n‡∏ä‡πà‡∏≤‡∏á: ${$("dBarber").innerText}\n‡∏£‡πâ‡∏≤‡∏ô: ${$("dShop").innerText}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
</script>
</body>
</html>
