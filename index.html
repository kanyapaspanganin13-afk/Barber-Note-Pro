<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; }
        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }
        .container { padding: 10px; max-width: 500px; margin: auto; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 12px; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
        .icon-card { position: relative; border-radius: 12px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1.5px solid transparent; background: #fff; }
        .icon-card span:first-child { font-size: 18px; }
        .icon-card span:last-child { font-size: 10px; font-weight: 800; }
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 12px; font-size: 14px; background: #f1f5f9; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--primary); background: #fff; }
        .price-box { font-size: 40px; font-weight: bold; text-align: center; color: var(--primary); padding: 10px; border: 2px solid var(--primary); border-radius: 15px; margin-bottom: 15px; width: 100%; background: #fff; display: block; }
        .btn { border: none; padding: 12px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 600; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-pay { background: #e2e8f0; color: #64748b; border: 2px solid transparent; }
        .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
        .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }
        .btn-main { background: var(--primary); color: white; width: 100%; font-size: 28px; height: 60px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-item { border: none; background: none; color: #94a3b8; font-size: 11px; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 22px; }
        .page { display: none; } .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: bold; margin-bottom: 10px; font-size: 14px; }
        .status-red { background: #fee2e2; color: #dc2626; }
        .status-indigo { background: #e0e7ff; color: #3730a3; }
        .status-green { background: #dcfce7; color: #16a34a; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 8px; font-size: 11px; margin: 2px; background: #eee; }
        .history-row { padding: 12px; border-bottom: 1px solid #f1f5f9; font-size: 14px; background: #fff; margin-bottom: 5px; border-radius: 10px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; backdrop-filter: blur(4px); }
        .modal-content { background: #fff; padding: 20px; border-radius: 25px; width: 100%; max-width: 400px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
    </style>
    </head>
    <body>
    <!-- PAGE 1 : ENTRY (COMPACT) -->
    <div id="p1" class="page active">
      <div class="grid-3">
    <div class="icon-card" onclick="setQuickGuar()">üõ°Ô∏è<span>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</span></div>
    <div class="icon-card" onclick="setHoliday()">üèñÔ∏è<span>‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span></div>
    <div class="icon-card" onclick="openSettings()">‚öôÔ∏è<span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span></div>
  </div>
  <!-- DATE / TIME -->
  <div class="grid-3">
    <div class="icon-card"> üìÖ<span id="dateDisplay">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span><input type="date" id="dateInp" onchange="updateDateDisplay(this.value)"style="position:absolute;inset:0;opacity:0"> </div>
    <input id="tStart" type="tel" maxlength="4" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°" style="text-align:center;font-size:17px">
    <input id="tEnd"   type="tel" maxlength="4" placeholder="‡πÄ‡∏™‡∏£‡πá‡∏à" style="text-align:center;font-size:17px">
  </div>
  <!-- SERVICE -->
  <div class="grid-3">
    <select id="hairStyle"><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏°</option><option value="‡πÄ‡∏î‡πá‡∏Å">üë∂ ‡πÄ‡∏î‡πá‡∏Å</option><option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option>‡πÅ‡∏Å‡πâ‡∏ó‡∏£‡∏á‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option></select>
    <select id="extra1">
      <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option></select>
    <select id="extra2">
      <option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 2</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option></select>
  </div>
  <!-- PRICE -->
  <input id="priceInp" class="price-box" type="number" placeholder="0">
  <!-- PAYMENT -->
  <div class="grid-2">
    <button id="btnCash"  class="btn btn-pay" onclick="selectPay('Cash')">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
    <button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">üì± ‡πÇ‡∏≠‡∏ô</button>
      </div>
      <!-- SAVE -->
      <button class="btn btn-main" onclick="handleSave()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
    <div id="p2" class="page">
    <!-- SUMMARY -->
    <div class="card" style="display:flex;gap:10px;align-items:stretch">
      <!-- LEFT 80% -->
      <div style="flex:8;font-size:13px">
        <div style="display:flex;justify-content:space-between"><span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span><b id="dTotal">‡∏ø0</b></div>
        <div style="display:flex;justify-content:space-between"><span>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span><b id="dCustomer">0 ‡∏Ñ‡∏ô</b></div>
        <div style="display:flex;justify-content:space-between"><span>üì± ‡πÇ‡∏≠‡∏ô</span><b id="dTrans">‡∏ø0</b></div>
        <div style="display:flex;justify-content:space-between"><span>ü§µ ‡∏ä‡πà‡∏≤‡∏á</span><b id="dBarber">‡∏ø0</b></div>
        <div style="display:flex;justify-content:space-between"><span>üè† ‡∏£‡πâ‡∏≤‡∏ô</span><b id="dShop">‡∏ø0</b></div>
  </div>
  <!-- RIGHT 20% -->
      <div style="flex:2;display:flex;flex-direction:column;gap:6px">
        <div id="settleBar" class="status-bar status-indigo" style="padding:6px;font-size:11px">
          üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô <b id="guarPay">0</b></div><button class="btn" style="background:#0ea5e9;color:#fff;flex:1" onclick="closeDayConfirm()">‚úàÔ∏è</button></div>
</div>
    <div class="card" style="padding:0"><div id="dailyList"></div>
</div>
</div>
<div id="p3" class="page">

  <div class="card" style="display:flex;align-items:center;">
    <span>‡∏Ñ‡∏á‡∏Ñ‡πâ‡∏≤‡∏á</span>
    <b id="accNet" style="margin-left:auto;font-size:26px;color:var(--primary)">‡∏ø0</b>
  </div>

  <div class="card" style="display:flex;font-size:13px;">
    <div style="flex:1">‡πÄ‡∏î‡∏¥‡∏° <b id="accOldVal">‡∏ø0</b></div>
    <div style="flex:1;text-align:right">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ <b id="accTodayVal">‡∏ø0</b></div>
  </div>

  <div class="card" style="display:flex;align-items:center;gap:6px;">
    <span id="accStatus" class="badge">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</span>
    <input id="accNote" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" style="flex:1">
    <button class="btn" style="width:46px;background:var(--success);color:#fff"
            onclick="clearAccount()">‚úî</button>
  </div>

  <div class="card" style="display:flex;gap:6px;align-items:center;">
    <span>üìÖ</span>
    <input type="date" id="accDateSearch" onchange="renderDayAccount()" style="flex:1">
    <button class="btn" style="width:46px" onclick="openMonthStat()">üìä</button>
  </div>
  <div id="accountList"></div>
</div>
<nav class="nav-bar">
    <button id="n1" class="nav-item active" onclick="go(1)"><i class="fas fa-cut"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    <button id="n2" class="nav-item" onclick="go(2)"><i class="fas fa-file-lines"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    <button id="n3" class="nav-item" onclick="go(3)"><i class="fas fa-wallet"></i>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</button>
</nav>

<div id="modalSet" class="modal">
  <div class="modal-content">
    <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
    <!-- SHOP -->
    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label>
    <input id="setShop" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô">
    <!-- PERCENT / GUARANTEE -->
    <div style="display:flex;gap:6px;margin-top:8px">
      <input type="number" id="setPerc" placeholder="% ‡∏ä‡πà‡∏≤‡∏á" style="flex:1">
      <input type="number" id="setGuar" placeholder="‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏ß‡∏±‡∏ô" style="flex:1">
    </div>
    <!-- SOUND / VOICE -->
    <div style="display:flex;gap:6px;margin-top:8px">
      <select id="setSound" style="flex:1">
        <option value="on">üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î</option>
        <option value="off">üîá ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡∏õ‡∏¥‡∏î</option>
      </select>
      <select id="setVoiceOn" style="flex:1">
        <option value="on">üé§ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î ‡πÄ‡∏õ‡∏¥‡∏î</option>
        <option value="off">üö´ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î ‡∏õ‡∏¥‡∏î</option>
      </select>
      <select id="setVoiceGender" style="flex:1">
        <option value="female">üë© ‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á</option>
        <option value="male">üë® ‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢</option>
      </select>
    </div>
    <!-- THEME / BRIGHTNESS -->
    <div style="display:flex;gap:6px;margin-top:8px">
      <select id="setTheme" style="flex:1">
        <option value="neon-light">üå§ Neon Light</option>
        <option value="deep-navy">üåå Deep Navy</option>
        <option value="barber-dark">üåë Barber Dark</option>
      </select>
      <input type="range" id="setBrightness" min="0" max="100" value="80" style="flex:1">
    </div>
    <!-- ACTION -->
    <div style="display:flex;gap:6px;margin-top:12px">
      <button class="btn" style="flex:1;background:var(--primary);color:#fff"
              onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      <button class="btn" style="flex:1;background:#ccc"
              onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
    </div>
    <hr style="opacity:.2;margin:12px 0">
    <!-- CLEAR -->
    <button class="btn" style="width:100%;background:var(--danger);color:#fff"
            onclick="clearAllData()">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
  </div>
</div>
<div id="modalHistory" class="modal">
    <div class="modal-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <b>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</b>
            <button onclick="closeHistoryPopup()" style="border:none; background:none; font-size:24px;">&times;</button>
        </div>
        <div id="historyListContent" style="max-height:300px; overflow-y:auto;"></div>
    </div>
</div>
<script>
   <script>
/* ===== GLOBAL ===== */
let db=JSON.parse(localStorage.getItem("barber_db"))||[],
conf=JSON.parse(localStorage.getItem("barber_conf"))||{shop:"Barber Shop",perc:50,guar:0,theme:"default",sound:"on",voice:"female"},
account=JSON.parse(localStorage.getItem("barber_account"))||{balance:0,logs:[]},payMethod="";
const $=id=>document.getElementById(id);

/* ===== INIT ===== */
window.onload=()=>{let t=new Date().toISOString().split("T")[0];
$("dateInp")&&($("dateInp").value=t);$("accDateSearch")&&($("accDateSearch").value=t);
applySettings();renderDay();};

/* ===== SETTINGS ===== */
function applySettings(){ $("shopNameDisp")&&($("shopNameDisp").innerText=conf.shop);
document.body.className=conf.theme==="default"?"":"theme-"+conf.theme;}
function openSettings(){ $("modalSet").style.display="flex";
["Shop","Perc","Guar","Theme","Sound","Voice"].forEach(k=>$("set"+k)&&( $("set"+k).value=conf[k.toLowerCase()] ));}
function closeSettings(){ $("modalSet").style.display="none"; }
function saveSettings(){ conf.shop=$("setShop").value;conf.perc=+$("setPerc").value;
conf.guar=+$("setGuar").value;conf.theme=$("setTheme").value;
conf.sound=$("setSound").value;conf.voice=$("setVoice").value;
localStorage.setItem("barber_conf",JSON.stringify(conf));
applySettings();closeSettings();speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß");}
function clearAllData(){ if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")){localStorage.clear();location.reload();}}

/* ===== VOICE ===== */
function speak(t){ if(conf.sound!=="on")return;
speechSynthesis.cancel();let u=new SpeechSynthesisUtterance(t);u.lang="th-TH";
u.pitch=conf.voice==="male"?0.7:1.1;speechSynthesis.speak(u);}

/* ===== NAV ===== */
function go(n){document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
document.querySelectorAll(".nav-item").forEach(b=>b.classList.remove("active"));
$("p"+n)&&$("p"+n).classList.add("active");$("n"+n)&&$("n"+n).classList.add("active");
renderDay();}

/* ===== PAYMENT ===== */
function selectPay(m){payMethod=m;
$("btnCash").className=m==="Cash"?"btn btn-pay active-cash":"btn btn-pay";
$("btnTrans").className=m==="Trans"?"btn btn-pay active-trans":"btn btn-pay";}

/* ===== SAVE ===== */
function handleSave(){
let p=+$("priceInp").value;if(!p||!payMethod)return alert("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢");
db.push({id:Date.now(),date:$("dateInp").value,
time:($("tStart").value||"--")+":"+($("tEnd").value||"--"),
svcs:[$("hairStyle").value,$("extra1").value,$("extra2").value].filter(Boolean),
price:p,pay:payMethod});
localStorage.setItem("barber_db",JSON.stringify(db));
speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å "+p+" ‡∏ö‡∏≤‡∏ó");
$("priceInp").value="";$("tStart").value=$("tEnd").value;$("tEnd").value="";
selectPay("");renderDay();}

/* ===== RENDER ===== */
function renderDay(){
let d=$("accDateSearch")?.value||$("dateInp")?.value,list=db.filter(r=>r.date===d);
let tot=0,cash=0,trans=0,html="";
list.forEach(r=>{tot+=r.price;r.pay==="Cash"?cash+=r.price:trans+=r.price;
html+=`<div class="history-row"><b>${r.time}</b> | ${r.svcs.join("+")} | ‡∏ø${r.price}
<span style="float:right">${r.pay==="Cash"?"üíµ":"üì±"}
<i onclick="delRec(${r.id})" style="color:red;cursor:pointer">üóëÔ∏è</i></span></div>`;});
let earn=Math.max(tot*(conf.perc/100),conf.guar),settle=cash-earn;
$("dTotal")&&($("dTotal").innerText=tot.toLocaleString());
$("dTrans")&&($("dTrans").innerText=trans.toLocaleString());
$("dBarber")&&($("dBarber").innerText=Math.floor(earn).toLocaleString());
$("dailyList")&&($("dailyList").innerHTML=html||"<center>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>");
let bar=$("settleBar");if(bar){
bar.innerText=tot===0?"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£":settle===0?"‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ":
settle>0?`‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle)}`:`‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(-settle)}`;
bar.className="status-bar "+(settle>0?"status-red":settle<0?"status-indigo":"status-green");}
let net=(account.balance||0)+settle;
$("accOldVal")&&($("accOldVal").innerText=(account.balance||0).toLocaleString());
$("accTodayVal")&&($("accTodayVal").innerText=Math.floor(settle).toLocaleString());
$("accNet")&&($("accNet").innerText=Math.abs(Math.floor(net)).toLocaleString());
$("accStatus")&&( $("accStatus").innerText=net===0?"‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ":net>0?"‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô":"‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏≤‡∏á");}

/* ===== DELETE ===== */
function delRec(id){if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?")){
db=db.filter(r=>r.id!==id);localStorage.setItem("barber_db",JSON.stringify(db));
speak("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß");renderDay();}}

/* ===== ACCOUNT ===== */
function clearAccount(){
let s=+$("accTodayVal").innerText.replace(/,/g,""),net=(account.balance||0)+s;
account.logs.unshift({date:new Date().toLocaleDateString("th-TH"),amount:net,note:$("accNote").value||"‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î"});
account.balance=0-s;localStorage.setItem("barber_account",JSON.stringify(account));
$("accNote").value="";speak("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß");renderDay();}

/* ===== HISTORY ===== */
function openHistoryPopup(){
$("modalHistory").style.display="flex";
$("historyListContent").innerHTML=account.logs.map(l=>`<div class="history-row"><b>${l.date}</b> ‡∏ø${l.amount}</div>`).join("")||"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";}
function closeHistoryPopup(){ $("modalHistory").style.display="none"; }

/* ===== SHARE PREVIEW ===== */
function shareLinePreview(){
let d=$("dateInp").value,today=db.filter(r=>r.date===d);if(!today.length)return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
let tot=0,cash=0,trans=0,c={‡πÄ‡∏î‡πá‡∏Å:0,‡∏™‡∏£‡∏∞‡∏ú‡∏°:0,‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î:0,‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°:0};
let msg=`üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î)\n‡∏£‡πâ‡∏≤‡∏ô: ${conf.shop}\nüìÖ ${d}\n-----------------\n`;
today.forEach((r,i)=>{tot+=r.price;r.pay==="Cash"?cash+=r.price:trans+=r.price;
msg+=`${i+1}. ${r.time} ${r.svcs.join("+")} = ${r.price} ${r.pay==="Cash"?"üíµ":"üì±"}\n`;
r.svcs.forEach(s=>{if(s.includes("‡πÄ‡∏î‡πá‡∏Å"))c.‡πÄ‡∏î‡πá‡∏Å++;else if(s.includes("‡∏™‡∏£‡∏∞"))c.‡∏™‡∏£‡∏∞‡∏ú‡∏°++;
else if(s.includes("‡πÇ‡∏Å‡∏ô")||s.includes("‡∏Å‡∏±‡∏ô"))c.‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î++;
else if(s.includes("‡∏¢‡πâ‡∏≠‡∏°")||s.includes("‡∏î‡∏±‡∏î"))c.‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°++;});});
let earn=Math.max(tot*(conf.perc/100),conf.guar),settle=Math.floor(cash-earn);
msg+=`-----------------\nüìä ‡∏™‡∏£‡∏∏‡∏õ\n`;
({‡πÄ‡∏î‡πá‡∏Å:"üßí",‡∏™‡∏£‡∏∞‡∏ú‡∏°:"üßº",‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î:"ü™í",‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°:"üé®"});
for(let k in c)if(c[k]>0)msg+=`${k}: ${c[k]}\n`;
msg+=`-----------------\nüí∞ ‡∏£‡∏ß‡∏° ${tot}\nüì± ‡πÇ‡∏≠‡∏ô ${trans}\nü§µ ‡∏ä‡πà‡∏≤‡∏á ${Math.floor(earn)}\nüè† ‡∏£‡πâ‡∏≤‡∏ô ${Math.floor(tot-earn)}\n`;
msg+=settle===0?"‚úÖ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ":`‚ö†Ô∏è ${settle>0?"‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô":"‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á"} ${Math.abs(settle)} ‡∏ö‡∏≤‡∏ó`;
window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);}
</script>
</body>
</html>
