 <!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.7.2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
    :root { 
        --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0;
    }
    * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }
   #brightnessOverlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: black;
    opacity: 0;
    /* 1. ‡∏ï‡∏≠‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏°‡∏∂‡∏á‡∏•‡∏á‡πÑ‡∏õ‡∏ô‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ï‡πâ‡∏î‡∏¥‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÇ‡∏ú‡∏•‡πà‡∏°‡∏≤‡∏ö‡∏±‡∏á‡∏ô‡∏¥‡πâ‡∏ß‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î */
    z-index: -1 !important; 
    /* 2. ‡∏ï‡∏≠‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏°‡∏∂‡∏á‡∏´‡πâ‡∏≤‡∏°‡∏£‡∏±‡∏ö‡πÅ‡∏£‡∏á‡∏Å‡∏î ‡∏ô‡∏¥‡πâ‡∏ß‡∏à‡∏¥‡πâ‡∏°‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏õ‡∏´‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ */
    pointer-events: none !important; 
    /* 3. ‡∏ï‡∏≠‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏°‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏ô */
    display: none; 
}

/* 4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏´‡∏£‡∏µ‡πà‡πÑ‡∏ü (‡∏ú‡πà‡∏≤‡∏ô JS) ‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡πÇ‡∏ú‡∏•‡πà‡∏°‡∏≤‡∏ö‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡∏ô‡∏±‡πâ‡∏ô */
.show-overlay #brightnessOverlay {
    display: block !important;
    z-index: 999999 !important;
    pointer-events: auto !important;
}
   
    body.deep-navy { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: #334155; }
    body.deep-navy .icon-card, body.deep-navy input, body.deep-navy select { background: #1e293b; color: white; border-color: #334155; }
    body.barber-dark { --bg: #121212; --card: #1a1a1a; --text: #e0e0e0; --primary: #fbbf24; --border: #333; }
    body.barber-dark .icon-card, body.barber-dark input, body.barber-dark select { background: #1a1a1a; color: #fbbf24; border-color: #333; }   
    
    .container { padding: 10px; max-width: 500px; margin: auto; }
    .grid-3 {display: grid !important;grid-template-columns: repeat(3, 1fr) !important;gap: 6px !important;margin-bottom: 8px !important;}
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 8px; }
    
    .icon-card { 
        position: relative; border-radius: 15px; padding: 15px 5px; display: flex; flex-direction: column; 
        align-items: center; justify-content: center; gap: 5px; cursor: pointer;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1.5px solid transparent; background: #fff;
    }
    .icon-card span:first-child { font-size: 22px; }
    .icon-card span:last-child { font-size: 13px; font-weight: 700; }
    
    input, select {
        width: 100%; height: 68px !important; border-radius: 14px !important; font-size: 18px !important; 
        font-weight: 600; text-align: center; border: 1.5px solid var(--border); background: #f1f5f9;
    }
    input[type="date"], input[type="time"], .grid-3 .icon-card {
        height: 60px !important; border-radius: 12px !important; font-size: 18px !important; margin: 0 !important;
    }
    
    .price-box {
        font-size: 55px !important; height: 90px !important; font-weight: 700 !important; margin-bottom: 12px !important; 
        border: 2px solid var(--primary) !important; display: flex; align-items: center; justify-content: center; 
        background: #fff; color: var(--text);
    }
    
    .btn { border: none; padding: 12px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.2s; }
    .btn:active { transform: scale(0.95); }
    
    .btn-pay { background: #e2e8f0; color: #64748b; border:2px solid transparent; height: 70px; font-size: 18px;}
    .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
    .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }
    
    .btn-main { background: var(--primary); color: white; width: 100%; height: 85px; border-radius: 20px; font-size: 35px; margin-top: 10px; border:none; }
    
    .nav-bar {
        position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: #ffffff; display: flex !important; 
        justify-content: space-around; align-items: center; border-top: 1px solid #eee; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 1000;
    }
    .nav-item { flex: 1; display: flex !important; flex-direction: column !important; align-items: center; justify-content: center; gap: 4px; color: #94a3b8; text-decoration: none; cursor: pointer; }
    .nav-item.active { color: #6366f1; }
    .nav-item i { font-size: 24px; }
    .nav-item span { font-size: 13px; font-weight: 500; }

    .page { display: none; } 
    .page.active { display: block; }
    
    .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); display: none; z-index: 999999; align-items: center; justify-content: center; }
    .modal-content { background: #fff; width: 90%; max-width: 400px; border-radius: 25px; padding: 25px; max-height: 85vh; overflow-y: auto; }
    
    .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: 800; font-size: 14px; margin-bottom: 10px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
    
    .acc-main-card { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #fffbeb; }
    .btn-save { background: var(--success); color: white; border: none; width: 100%; padding: 15px; border-radius: 15px; font-weight: 700; font-size: 16px; cursor: pointer; }
    #accHistory { font-size: 12px; max-height: 150px; overflow-y: auto; }
</style>
    </head>
    <body>
<div class="container">
    <h2 id="shopNameDisp" style="text-align:center; color:var(--primary); margin: 10px 0;">Barber Shop</h2>
    <div id="p1" class="page active"> 
    <div class="grid-3">
    <div class="icon-card" style="background: #fffbeb; border-color: #fde68a;" onclick="handleInsurance()"><span>üõ°Ô∏è</span><span style="color: #b45309;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span></div>
    <div class="icon-card" style="background: #fff1f2; border-color: #fecdd3;" onclick="handleHoliday()"><span>üèñÔ∏è</span><span style="color: #be185d;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</span></div>
    <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1;" onclick="openSettings()"><span>‚öôÔ∏è</span><span style="color: #475569;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span></div>
</div>
   <div class="grid-3">
    <div class="icon-card" style="background: #f1f5f9; border-color: #cbd5e1; padding: 1px; height: 55px; position: relative;">
        <span id="dateDisplay" style="font-size: 18px; font-weight: 700;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
        <input type="date" id="dateInp" 
         onchange="document.getElementById('dateDisplay').innerText = this.value; if(window.updateDateDisplay) updateDateDisplay(this.value)" 
         style="position: absolute; top: 0; left: 0; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 2;">
    </div>
    <input type="time" id="tStart" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°" style="text-align:center; height: 50px;">
    <input type="time" id="tEnd" placeholder="‡πÄ‡∏™‡∏£‡πá‡∏à" style="text-align:center; height: 50px;">
</div>
        <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 12px;"><select id="hairStyle" style="height: 70px;">
        <option value="">üíá ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏£‡∏á‡∏ú‡∏°</option>
        <option value="‡πÄ‡∏î‡πá‡∏Å">üë∂ ‡∏ï‡∏±‡∏î‡∏ú‡∏°‡πÄ‡∏î‡πá‡∏Å</option>
        <option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
        <option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option></select>
        <select id="extra1" style="height: 50px;"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 1</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option> </select>
        <select id="extra2" style="height: 50px;"><option value="">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 2</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option></select></div>
        <input type="number" id="priceInp" class="price-box" placeholder="0" inputmode="numeric">
    <div class="grid-2">
        <button id="btnCash" class="btn btn-pay" onclick="selectPay('Cash')">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button><button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">üì± ‡πÇ‡∏≠‡∏ô</button></div>
        <button class="btn btn-main" onclick="handleSave()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div>
    <div id="p2" class="page" style="padding: 15px;"> 
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
        <div style="background: white; padding:18px 15px; border-radius:20px; text-align:center; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
            <small style="font-weight:800; color:#64748b; text-transform: uppercase;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</small>
            <div id="dTotal" style="font-size:36px; font-weight:900; color:#4338ca; margin: 5px 0;">0</div>
            <div id="dCounts" style="font-size:13px; font-weight:700; color:#1e293b; background:#e0e7ff; display:inline-block; padding:2px 10px; border-radius:10px;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ 0 ‡∏Ñ‡∏ô</div>
     </div>
        <div style="background:white; padding:15px; border-radius:20px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; display:flex; flex-direction:column; justify-content:center; gap:8px;">
            <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#0ea5e9;">üì± ‡πÇ‡∏≠‡∏ô:</span> <b id="dTrans">0</b></div>
            <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#6366f1;">ü§µ ‡∏ä‡πà‡∏≤‡∏á:</span> <b id="dBarber">0</b></div>
            <hr style="border:0; border-top:1px dashed #cbd5e1; margin:4px 0;">
            <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:800;"><span style="color:#64748b;">üè† ‡∏£‡πâ‡∏≤‡∏ô:</span> <b id="dShop">0</b></div>
        </div>
    </div>
       <div style="display:flex; gap:10px; margin-bottom:18px; align-items: center;">
        <div id="settleBar" style="flex: 8; height: 50px; display:flex; align-items:center; justify-content:center; font-weight:900; border-radius:15px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 14px;"></div>
        <button onclick="sendSummary()" style="flex: 2; height: 50px; background:#ff4500; color:white; border:none; border-radius:15px; font-size:20px; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 10px rgba(255, 69, 0, 0.3); cursor:pointer;"><i class="fas fa-paper-plane"></i>
        </button>
    </div>
           <div id="dServiceStats" style="text-align:center; margin-bottom:20px; display:flex; flex-wrap:wrap; justify-content:center; gap:6px;"></div>
           <hr style="border:0; border-top:1px solid #e2e8f0; margin-bottom:15px;">
           <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
           <div style="font-weight:800; color:#1e293b; font-size:14px;">üìã ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</div>
          <div onclick="sendDailyListToLine()" style="background:#06c755; color:white; padding:5px 12px; border-radius:10px; font-size:12px; font-weight:800; cursor:pointer; display:flex; align-items:center; gap:5px; box-shadow: 0 2px 4px rgba(6,199,85,0.2);">‡∏™‡πà‡∏á LINE</div>
           <div id="dailyList" style="display:flex; flex-direction:column; gap:10px;"></div>
           <button onclick="go(3)" style="position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--primary); color: white; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 24px;"><i class="fas fa-check-circle"></i></button>
    </div>

    <div id="p3" class="page">
        <div class="acc-main-card">
        <div style="display:flex; justify-content:space-between; align-items:center;"><h3 style="margin:0; font-size:16px; color:#b45309;"><i class="fas fa-wallet"></i> ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</h3>
        <div id="accLight" style="background:gray; width:12px; height:12px; border-radius:50%;"></div>
    </div>
        <div style="font-size:13px; color:#64748b; margin:15px 0; background:rgba(0,0,0,0.03); padding:12px; border-radius:15px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°:</span><b id="accOldVal">‡∏ø0</b></div>
        <div style="display:flex; justify-content:space-between;"><span>‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ:</span><b id="accTodayVal" style="color:var(--primary)">‡∏ø0</b></div>
    </div>
        <div style="text-align:center; margin:20px 0;">
        <div style="font-size:14px; opacity:0.6;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
        <div style="font-size:48px; font-weight:900; color:var(--primary);">‡∏ø<span id="accNet">0</span></div>
    </div>
        <div id="accStatus" class="status-bar">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
        <button class="btn" onclick="toggleAccHistory()" style="width:100%; border:1px dashed var(--primary); background:#f0f7ff; color:var(--primary); margin-bottom:15px;">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</button>
        <div id="accHistoryWrapper" style="display:none; margin-bottom:15px;"><div id="accHistory" class="card" style="font-size:12px; max-height:150px; overflow:y:auto;"></div></div>
        <div style="background:#f8fafc; padding:15px; border-radius:20px; border:1px solid var(--border);">
        <input type="date" id="accDate" style="margin-bottom:10px;">
        <input type="text" id="accNote" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥" style="margin-bottom:10px;">
        <button class="btn-save" onclick="clearAccount()">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô</button>
    </div>
</div>
        <div class="card" style="margin-top:20px;">
            <label>üìÖ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</label>
            <input type="date" id="histDate" onchange="loadHistDaily()" style="margin:10px 0;">
            <div id="histDailyArea"></div>
        </div>
    </div>

    <div id="modalSet" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--primary); text-align: center;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3> 
        <label style="font-size:11px; font-weight:600;">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label> <input id="setShop" style="margin-bottom:10px;">
        <div class="grid-2">
    <div>
        <label style="font-size:11px; font-weight:600;">% ‡∏ä‡πà‡∏≤‡∏á</label><input type="number" id="setPerc" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50"></div>
    <div>
        <label style="font-size:11px; font-weight:600;">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô/‡∏ß‡∏±‡∏ô</label><input type="number" id="setGuar" placeholder="0"></div>
    </div>
        <div style="margin-top:10px; background: #f1f5f9; padding: 10px; border-radius: 12px;">
        <label style="font-size:11px; font-weight:800; display: flex; justify-content: space-between;"><span>üîÜ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</span><span id="brightVal">100%</span>
        </label><input type="range" id="setBright" min="0" max="0.8" step="0.1" value="0" oninput="..."changeBrightness(this.value); document.getElementById('brightVal').innerText = Math.round((1 - this.value) * 100) + '%';">
    </div>
        <div style="margin-top:10px">
        <label style="font-size:11px; font-weight:600;">‡∏ò‡∏µ‡∏°‡πÅ‡∏≠‡∏õ</label><select id="setTheme">
        <option value="neon-light">üå§ Neon Light (Default)</option><option value="deep-navy">üåå Deep Navy</option><option value="barber-dark">üåë Barber Dark</option></select>
    </div>
        <div class="grid-2" style="margin-top:10px">
            <div>
        <label style="font-size:11px; font-weight:600;">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á</label> <select id="setSound"><option value="on">üîä ‡πÄ‡∏õ‡∏¥‡∏î</option><option value="off">üîá ‡∏õ‡∏¥‡∏î</option></select></div>
    <div>
        <label style="font-size:11px; font-weight:600;">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î</label><select id="setVoice"><option value="female">üë© ‡∏´‡∏ç‡∏¥‡∏á</option><option value="male">üë® ‡∏ä‡∏≤‡∏¢</option></select></div>
    </div>
        <div class="grid-2" style="margin-top:20px">
        <button class="btn" style="background:var(--primary); color:#fff" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button class="btn" style="background:#e2e8f0; color:var(--text)" onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
    </div>
        <button class="btn" style="width:100%; background:var(--danger); color:#fff; margin-top:10px; font-size:12px;" onclick="clearAllData()">‚ö†Ô∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
</div>
    </div>
    <nav class="nav-bar">
        <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
        <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-file-invoice"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
        <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-wallet"></i>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
    </nav>
</div>
    <div id="brightnessOverlay"></div>

     <script>
    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å LocalStorage (‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ)
    let db = JSON.parse(localStorage.getItem("barber_db")) || [];
    let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
    let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
    let payMethod = "";
    const $ = (id) => document.getElementById(id);
    window.onload = () => {
        const today = new Date().toISOString().split('T')[0];
        if($("dateInp")) $("dateInp").value = today;if($("accDate")) $("accDate").value = today;if($("histDate")) $("histDate").value = today;if($("shopNameDisp")) $("shopNameDisp").innerText = conf.shop; // ‡πÉ‡∏ä‡πâ conf.shop ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏ß‡πâ
        updateDateDisplay(today);
    };
function handleSave() {
        const p = parseInt($("priceInp").value);
        if(!p || !payMethod) return alert("‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏û‡∏µ‡πà!");
        const rec = {id: Date.now(),date: $("dateInp").value,time: $("tStart").value || new Date().toLocaleTimeString('th-TH', {hour12:false, hour:'2-digit', minute:'2-digit'}),svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(s => s !== ""),
        price: p,pay: payMethod,type: "SERVICE" // ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó GUARANTEE_CLAIM ‡∏´‡∏£‡∏∑‡∏≠ HOLIDAY
        };
        db.push(rec);saveDB();alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö");$("priceInp").value = "";renderDay();
    }
    // --- 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ 
function handleInsurance() {
    const today = $("dateInp").value || new Date().toISOString().split('T')[0];
    const guaranteeAmount = parseInt(conf.guar) || 0;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î
    const speak = (txt) => {
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'th-TH';
        window.speechSynthesis.speak(msg);
    };

    // --- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏™‡∏±‡πà‡∏á: ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡πÄ‡∏õ‡πá‡∏ô 0) ‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ---
    if (guaranteeAmount <= 0) {
        speak("‡∏û‡∏µ‡πà‡∏Ñ‡∏∞ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞"); // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÄ‡∏°‡∏ô‡∏π '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö' ‡∏Å‡πà‡∏≠‡∏ô");
        return;
    }

    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡πÑ‡∏´‡∏°
    const alreadyGuar = db.find(r => r.date === today && r.type === "GUARANTEE_CLAIM");
    if (alreadyGuar) {
        speak("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞");
        alert("üõ°Ô∏è ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà");
        return;
    }

    if (confirm(`üõ°Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö '‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ' ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏û‡∏µ‡πà?`)) {
        db.push({ 
            id: Date.now(), 
            date: today, 
            time: "00:00", 
            svcs: ["üõ°Ô∏è ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô"], 
            price: 0, 
            pay: "N/A",
            type: "GUARANTEE_CLAIM" 
        });

        saveDB(); 
        speak(`‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô ${guaranteeAmount} ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞`);
        alert("‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        renderDay();
    }
}
    // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î ---
   function handleHoliday() {
    const today = $("dateInp").value;
    if (!today) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô");

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î
    const speak = (txt) => {
        const msg = new SpeechSynthesisUtterance(txt);
        msg.lang = 'th-TH';
        window.speechSynthesis.speak(msg);
    };

    if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${today} ‡πÄ‡∏õ‡πá‡∏ô "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"?`)) {
        const holidayRecord = {
            id: Date.now(),
            date: today,
            time: "00:00",
            svcs: ["üèñÔ∏è ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏£‡πâ‡∏≤‡∏ô"], // ‡πÉ‡∏™‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î
            price: 0,
            pay: "N/A",
            type: "HOLIDAY" // ‡∏°‡∏≤‡∏£‡πå‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≥‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
        };
        
        db.push(holidayRecord);
        saveDB();
        
        speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏™‡∏ö‡∏≤‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞"); // ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î
        alert("üèñÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        renderDay();
    }
}
function changeBrightness(val) {
    const overlay = document.getElementById('brightnessOverlay');
    const body = document.body;
    
    overlay.style.opacity = val;
    
    if (parseFloat(val) > 0) {
        // ‡∏ñ‡πâ‡∏≤‡∏´‡∏£‡∏µ‡πà‡πÑ‡∏ü ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏ó‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° (z-index 999999 ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)
        body.classList.add('show-overlay');
    } else {
        // ‡∏ñ‡πâ‡∏≤‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î ‡πÉ‡∏´‡πâ‡∏ñ‡∏µ‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏≥‡∏•‡∏á‡πÑ‡∏õ‡πÉ‡∏ï‡πâ‡∏î‡∏¥‡∏ô (z-index -1 ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)
        body.classList.remove('show-overlay');
    }
}
    // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ conf ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô) ---
    function openSettings() {
        const modal = $("modalSet");
        if (modal) {
            $("setShop").value = conf.shop || "";
            $("setPerc").value = conf.perc || 50;
            $("setGuar").value = conf.guar || 0;
            modal.style.display = 'flex'; 
        }
    }
    function saveSettings() {
    conf.shop = $("setShop").value;
    conf.perc = parseInt($("setPerc").value);
    conf.guar = parseInt($("setGuar").value);
    conf.theme = $("setTheme").value;
    conf.sound = $("setSound").value;
    conf.voice = $("setVoice").value;
    conf.bright = $("setBright").value;

    localStorage.setItem("barber_conf", JSON.stringify(conf));
    
    applyTheme(conf.theme);
    changeBrightness(conf.bright);
    $("shopNameDisp").innerText = conf.shop;
    
    speak("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    closeSettings();
}
    function closeSettings() {
        if ($("modalSet")) $("modalSet").style.display = 'none';
    }
       // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á
    function changeBrightness(val) {
    const el = document.getElementById('brightnessOverlay');
    if (el) el.style.opacity = val;
    }
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°
    function applyTheme(themeName) {
    document.body.className = themeName;
    }
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î
    function speak(text) {
    if (conf.sound === 'off') return;
    window.speechSynthesis.cancel();
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'th-TH';
    msg.pitch = (conf.voice === 'male') ? 0.8 : 1.2;
    window.speechSynthesis.speak(msg);
    }
    function clearAllData() {
        if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£!")) {
            localStorage.clear();
            location.reload();
        }
    }
    // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà ‡πÅ‡∏ï‡πà‡πÄ‡∏ï‡∏¥‡∏°‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡πä‡∏Å‡πÑ‡∏ß‡πâ‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢)
function updateDateDisplay(val) {
    if (!val) return; // ‡∏Å‡∏±‡∏ô Error ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
    const d = new Date(val);
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô "20 ‡∏°.‡∏Ñ."
    document.getElementById("dateDisplay").innerText = d.toLocaleDateString('th-TH', { 
        day: 'numeric', 
        month: 'short',
        year: '2-digit' // ‡πÅ‡∏ñ‡∏°: ‡πÉ‡∏™‡πà‡∏õ‡∏µ‡∏ó‡πâ‡∏≤‡∏¢‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå
    });
    
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô renderDay ‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢
    if (typeof renderDay === "function") renderDay();
}

// 2. *** ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏≠‡∏¢‡∏π‡πà ‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏£‡∏±‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ ***
window.addEventListener('DOMContentLoaded', () => {
    const dateInp = document.getElementById("dateInp");
    const now = new Date();
    
    // ‡∏à‡∏±‡∏î‡∏ü‡∏≠‡∏£‡πå‡πÅ‡∏°‡∏ï‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡πÉ‡∏ô input ‡πÑ‡∏î‡πâ (YYYY-MM-DD)
    const today = now.getFullYear() + '-' + 
                  String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                  String(now.getDate()).padStart(2, '0');
    
    dateInp.value = today;       // ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
    updateDateDisplay(today);    // ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏ó‡∏ô
});

    function selectPay(m) {
        payMethod = m;
        $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;
        $("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;
    }
function renderDay() {
    const d = document.getElementById("dateInp").value;
    const today = db.filter(r => r.date === d);
    let tot = 0, trans = 0, cash = 0, stats = {}, listHtml = "";

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏ö‡πÉ‡∏ô Loop ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ö‡∏¥‡πâ‡∏•)
    today.sort((a, b) => a.time.localeCompare(b.time)).forEach(r => {
        // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô (‡∏ó‡∏≥‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
        tot += r.price;
        if (r.pay === 'Trans') trans += r.price; else cash += r.price;

        // 2. ‡∏ô‡∏±‡∏ö‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
        if (r.svcs) {
            r.svcs.forEach(s => {
                let name = s.trim();
                if (name !== "") {
                    if (name.includes("‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô") || name.includes("‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á") || name === "‡∏ï‡∏±‡∏î‡∏ú‡∏°") {
                        stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"] = (stats["‡∏ï‡∏±‡∏î‡∏ú‡∏°"] || 0) + 1;
                    } else if (name === "‡πÄ‡∏î‡πá‡∏Å") {
                        stats["‡πÄ‡∏î‡πá‡∏Å"] = (stats["‡πÄ‡∏î‡πá‡∏Å"] || 0) + 1;
                    }
                    stats[name] = (stats[name] || 0) + 1;
                }
            });
        }

        // 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏¢‡∏¥‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ id="dailyList")
        listHtml += `
            <div class="history-row" style="background:#ffffff; padding:15px; border-radius:18px; margin-bottom:10px; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1); border:1px solid #f1f5f9;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <span><b style="color:#4338ca; font-size:15px;">${r.time}</b> | ${r.svcs.join('+')}</span>
                    <b style="font-size:16px; color:#1e293b;">‡∏ø${r.price}</b>
                </div>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
                    <span style="color:#64748b; font-size:13px; font-weight:600;">${r.svcs[0] || ''}</span>
                    <div style="display:flex; align-items:center; gap:15px;">
                        <span style="font-size:12px; font-weight:700; color:#475569;">${r.pay === 'Cash' ? 'üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î' : 'üì± ‡πÇ‡∏≠‡∏ô'}</span>
                        <div onclick="delRec(${r.id})" style="cursor:pointer; padding:5px;"><i class="fas fa-trash-alt" style="color:#dc2626; font-size:18px;"></i></div>
                    </div>
                </div>
            </div>`;
    });

    // --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á ID ‡∏à‡∏≤‡∏Å HTML ‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà) ---
   // --- ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ---

    // 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°
    const hasGuar = today.some(r => r.type === "GUARANTEE_CLAIM");
    
    // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 200)
    const bEarn = hasGuar ? Math.max(tot * (conf.perc / 100), conf.guar) : (tot * (conf.perc / 100));
    
    // 3. ‡∏¢‡∏≠‡∏î‡∏£‡πâ‡∏≤‡∏ô (‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ‡∏•‡∏ö ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á) -> ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
    const sEarn = tot - bEarn;

    // --- ‡∏™‡∏±‡πà‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ---
    document.getElementById("dTotal").innerText = tot.toLocaleString();
    document.getElementById("dTrans").innerText = trans.toLocaleString();
    document.getElementById("dBarber").innerHTML = `${Math.floor(bEarn).toLocaleString()} <small style="color:#64748b;">(‡∏™‡∏î:${cash})</small>`;
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏£‡πâ‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö
    const dShop = document.getElementById("dShop");
    dShop.innerText = Math.floor(sEarn).toLocaleString();
    dShop.style.color = sEarn < 0 ? "#dc2626" : "#1e293b"; 

    document.getElementById("dCounts").innerText = `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ${today.length} ‡∏Ñ‡∏ô`;
    document.getElementById("dailyList").innerHTML = listHtml || "<center style='opacity:0.3; padding:40px;'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</center>";

    // --- ‡πÅ‡∏ñ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (SettleBar) ---
    const b = document.getElementById("settleBar");
    if (b) {
        if (tot === 0 && hasGuar) {
            b.innerText = `‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô ${conf.guar} ‡∏ö.`;
            b.style.background = "#e0e7ff"; b.style.color = "#4338ca";
        } else if (sEarn < 0) {
            // ‡∏Å‡∏£‡∏ì‡∏µ‡∏á‡∏≤‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô -> ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á
            b.innerText = `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ${Math.floor(Math.abs(sEarn))} ‡∏ö.`;
            b.style.background = "#fef2f2"; b.style.color = "#dc2626";
        } else {
            // ‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏°‡∏î) -> ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á
            b.innerText = `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ${Math.floor(bEarn - cash)} ‡∏ö.`;
            b.style.background = "#e0e7ff"; b.style.color = "#4338ca";
        }
    }
    // --- ‡πÅ‡∏ñ‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (settleBar) ---
    const b = document.getElementById("settleBar");
    if (b) {
        if (tot * (conf.perc / 100) < conf.guar) {
            b.innerText = `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô ‡∏ø${Math.floor(conf.guar - (tot * (conf.perc / 100)))}`;
            b.style.background = "#e0e7ff"; b.style.color = "#4338ca";
        } else if (settle > 0) {
            b.innerText = `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle)}`;
            b.style.background = "#fee2e2"; b.style.color = "#dc2626";
        } else if (settle < 0) {
            b.innerText = `üü¶ ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle))}`;
            b.style.background = "#e0e7ff"; b.style.color = "#4338ca";
        } else {
            b.innerText = "‚úÖ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏û‡∏≠‡∏î‡∏µ";
            b.style.background = "#dcfce7"; b.style.color = "#16a34a";
        }
    }

    // --- Badge ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (dServiceStats) ---
    let sH = "";
    for (let s in stats) {
        let bg = (s === "‡∏ï‡∏±‡∏î‡∏ú‡∏°") ? "#4338ca" : (s === "‡πÄ‡∏î‡πá‡∏Å") ? "#ec4899" : "#f1f5f9";
        let color = (bg === "#f1f5f9") ? "#475569" : "white";
        sH += `<span style="background:${bg}; color:${color}; padding:4px 10px; border-radius:10px; font-size:11px; font-weight:700;">${s}: ${stats[s]}</span>`;
    }
    document.getElementById("dServiceStats").innerHTML = sH;
}

   // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏™‡πâ‡∏°‡∏≠‡∏°‡πÅ‡∏î‡∏á ‡∏™‡πà‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ 3 ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á
function sendSummary() {
    const d = document.getElementById("dateInp").value;
    const tot = document.getElementById("dTotal").innerText;
    const trans = document.getElementById("dTrans").innerText;
    const shop = document.getElementById("dShop").innerText;
    const statusText = document.getElementById("settleBar").innerText; // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ "‡∏£‡πâ‡∏≤‡∏ô‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"

    const msg = `üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏ú‡∏° (${d})\n` +
                `------------------\n` +
                `üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${tot} ‡∏ö.\n` +
                `üì± ‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô: ${trans} ‡∏ö.\n` +
                `üè† ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡πâ‡∏≤‡∏ô: ${shop} ‡∏ö.\n` +
                `------------------\n` +
                `üìå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${statusText}`;

    // ‚úÖ ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ô LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
    window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
}
    function sendDailyListToLine() {
    const d = document.getElementById("dateInp").value;
    const today = db.filter(r => r.date === d);
    
    if (today.length === 0) {
        alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà!");
        return;
    }
    let listText = `üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (${d})\n`;
    today.sort((a, b) => a.time.localeCompare(b.time)).forEach((r, idx) => {
        listText += `${idx + 1}. ${r.time} | ${r.svcs.join('+')} | ‡∏ø${r.price}\n`;
    });

    window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(listText)}`;
}
    function clearAccount() {
        const currentTodaySettle = Number($("accTodayVal").innerText.replace('‡∏ø','').replace(',','')) || 0;
        const net = (account.balance || 0) + currentTodaySettle;
        if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô ‡∏ø${net} ?`)) {
            account.logs.unshift({ date: $("accDate").value, amount: net, note: $("accNote").value });
            account.balance = 0; 
            localStorage.setItem("barber_account", JSON.stringify(account));
            alert("‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏¢‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            renderDay();
        }
    }
    function toggleAccHistory() {
        const w = $("accHistoryWrapper");
        w.style.display = w.style.display === "none" ? "block" : "none";
        $("accHistory").innerHTML = account.logs.map(l => `<div style="padding:5px; border-bottom:1px solid #eee;">${l.date}: ‡∏ø${l.amount} (${l.note})</div>`).join('') || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥";
    }

    function loadHistDaily() {
        const d = $("histDate").value;
        const data = db.filter(r => r.date === d);
        $("histDailyArea").innerHTML = data.map(r => `<div class="history-row" style="padding:8px; border-bottom:1px solid #eee;">${r.time} - ${r.svcs.join('+')} <b>‡∏ø${r.price}</b></div>`).join('') || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
    }
    
    function shareLine() {
        const msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${$("dTotal").innerText}\n‡∏ä‡πà‡∏≤‡∏á: ${$("dBarber").innerText}\n‡∏£‡πâ‡∏≤‡∏ô: ${$("dShop").innerText}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
  
function saveDB() { localStorage.setItem("barber_db", JSON.stringify(db)); localStorage.setItem("barber_conf", JSON.stringify(conf)); }
function go(n) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); if(document.getElementById('p'+n)) document.getElementById('p'+n).classList.add('active'); if(document.getElementById('n'+n)) document.getElementById('n'+n).classList.add('active'); renderDay(); }
function delRec(id) { if (confirm("‡∏à‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà?")) { db = db.filter(r => r.id !== id); saveDB(); renderDay(); } }
function sendDailyListToLine() { const d = document.getElementById("dateInp").value, today = db.filter(r => r.date === d); if (today.length === 0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡∏ö‡∏û‡∏µ‡πà!"); let t = `üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (${d})\n`; today.sort((a, b) => a.time.localeCompare(b.time)).forEach((r, i) => { t += `${i + 1}. ${r.time} | ${r.svcs.join('+')} | ‡∏ø${r.price}\n`; }); window.location.href = `https://line.me/R/msg/text/?${encodeURIComponent(t)}`; }
  
</script>
</body>
</html>
