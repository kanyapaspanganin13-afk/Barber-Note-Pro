 <!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="apple-touch-icon" href="https://i.ibb.co/kVrdspsT/Barber-note-pro.jpg">
    <title>Barber Note Pro v.9</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
Â  Â  :root {Â 
Â  Â  Â  Â  --primary: #6366f1; --accent: #0ea5e9; --danger: #ef4444; --success: #22c55e; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --border: #e2e8f0;
Â  Â  }
Â  Â  * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
Â  Â  body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; overflow-x: hidden; }
Â  Â  .container { padding: 15px 15px 100px 15px !important; max-width: 500px; margin: auto; position: relative; z-index: 1; }
Â  Â  .nav-bar {
Â  Â  Â  Â  position: fixed !important; bottom: 0 !important; left: 0 !important; right: 0 !important;
Â  Â  Â  Â  height: 75px !important; background: white !important; display: flex !important;Â 
Â  Â  Â  Â  justify-content: space-around !important; align-items: center !important;Â 
Â  Â  Â  Â  z-index: 99999 !important;Â 
Â  Â  Â  Â  border-top: 1px solid #eee;
Â  Â  Â  Â  box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
Â  Â  }
Â  Â  .nav-item {
Â  Â  Â  Â  flex: 1 !important; display: flex !important; flex-direction: column !important;
Â  Â  Â  Â  align-items: center !important; justify-content: center !important; cursor: pointer !important;
Â  Â  Â  Â  pointer-events: auto !important;
Â  Â  }
Â  Â  .nav-item.active { color: #6366f1; }
Â  Â  .nav-item i { font-size: 24px; }
Â  Â  .nav-item span { font-size: 13px; font-weight: 500; }
Â  Â  body.deep-navy { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --border: #334155; }
Â  Â  body.deep-navy .icon-card, body.deep-navy input, body.deep-navy select { background: #1e293b; color: white; border-color: #334155; }
Â  Â  body.barber-dark { --bg: #121212; --card: #1a1a1a; --text: #e0e0e0; --primary: #fbbf24; --border: #333; }
Â  Â  body.barber-dark .icon-card, body.barber-dark input, body.barber-dark select { background: #1a1a1a; color: #fbbf24; border-color: #333; }Â  Â 
Â  Â Â 
Â  Â  .grid-3 {display: grid !important; grid-template-columns: repeat(3, 1fr) !important; gap: 6px; margin-bottom: 8px;}
Â  Â  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 8px; }
Â  Â  .icon-card { position: relative; border-radius: 15px; padding: 15px 5px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1.5px solid transparent; background: #fff; }
Â  Â  input, select { width: 100%; height: 68px !important; border-radius: 14px !important; font-size: 18px !important; font-weight: 600; text-align: center; border: 1.5px solid var(--border); background: #f1f5f9; }
Â  Â Â .btn { border: none; padding: 12px; border-radius: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: 700; transition: 0.2s; }
Â  Â  .btn-pay { background: #e2e8f0; color: #64748b; border:2px solid transparent; height: 70px; font-size: 18px;}
Â  Â  .btn-pay.active-cash { background: #dcfce7; color: #15803d; border-color: #22c55e; }
Â  Â  .btn-pay.active-trans { background: #e0f2fe; color: #0369a1; border-color: #0ea5e9; }
Â  Â  .btn-main { background: var(--primary); color: white; width: 100%; height: 85px; border-radius: 20px; font-size: 35px; margin-top: 10px; border:none; }
Â  Â  .page { display: none; }Â 
Â  Â  .page.active { display: block; }
Â  Â  .modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.85); display: none; z-index: 100000; align-items: center; justify-content: center; }
Â  Â  .modal-content { background: #fff; width: 90%; max-width: 400px; border-radius: 25px; padding: 25px; max-height: 85vh; overflow-y: auto; }
Â  Â  .status-bar { padding: 12px; border-radius: 12px; text-align: center; font-weight: 800; font-size: 14px; margin-bottom: 10px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
Â  Â  .acc-main-card { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); margin-bottom: 15px; border: 1px solid #fffbeb; }
Â  Â  .btn-save { background: var(--success); color: white; border: none; width: 100%; padding: 15px; border-radius: 15px; font-weight: 700; font-size: 16px; cursor: pointer; }
Â  Â  #accHistory { font-size: 12px; max-height: 150px; overflow-y: auto; }
Â  Â  Â /* à¸¢à¹ˆà¸­à¹€à¸¥à¸°à¹à¸•à¹ˆà¸ªà¸´à¸£à¸´à¸ªà¸§à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¹€à¸”à¸´à¸¡ */
.bank-net-card{background:linear-gradient(135deg,#4f46e5,#6366f1);color:#fff;border-radius:28px;padding:22px;box-shadow:0 15px 30px rgba(79,70,229,.35);margin-bottom:15px;}
.bank-top{display:flex;justify-content:space-between;align-items:center;}
.bank-title{font-size:15px;font-weight:700;opacity:.9;}
.bank-dot{width:12px;height:12px;border-radius:50%;background:#22c55e;box-shadow:0 0 10px #22c55e;}
.bank-balance{text-align:center;margin:25px 0;}
.bank-label{font-size:13px;opacity:.85;}
.bank-amount{font-size:52px;font-weight:900;margin-top:6px;}
.bank-sub{background:rgba(255,255,255,.18);border-radius:18px;padding:12px 15px;font-size:14px;}
.bank-row{display:flex;justify-content:space-between;margin-bottom:6px;}
.bank-row:last-child{margin-bottom:0;}
.bank-status{margin-top:14px;padding:10px;text-align:center;border-radius:14px;font-weight:800;font-size:13px;background:rgba(255,255,255,.25);}
.bank-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.bank-action-card{background:#fff;border-radius:22px;padding:20px 10px;text-align:center;font-weight:800;cursor:pointer;box-shadow:0 8px 18px rgba(0,0,0,.08);display:flex;flex-direction:column;gap:6px;}
.bank-action-card i{font-size:30px;}
.bank-action-card.daily{background:#eff6ff;color:#1d4ed8;}
.bank-action-card.month{background:#ecfeff;color:#0369a1;}
.date-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px; }
.price-row { display: grid; grid-template-columns: 1.6fr 1fr; gap: 10px; margin: 15px 0; align-items: center; }
#priceInp, #tipInp { width: 100% !important; height: 75px !important; border-radius: 18px !important; margin: 0 !important; }
#tipInp { background: #fff1f2 !important; border: 2.5px solid #fecdd3 !important; color: #be185d !important; font-size: 20px; font-weight: 800; }
</style>
</head>
<body>
<div class="container">
    <div id="p1" class="page active">
       <div style="text-align:center; margin: 10px 0;">
    <span id="shopNameDisp" style="border: 2px solid #6366f1; color: #6366f1; padding: 5px 20px; border-radius: 12px; font-weight: 900; font-size: 20px; background: #f5f3ff;">Barber Shop</span>
</div>
<div class="grid-3" style="gap: 8px; margin-bottom: 8px;">
    <div class="icon-card" style="background:#fffbeb; color:#92400e;" onclick="handleInsurance()">ğŸ›¡ï¸ à¸›à¸£à¸°à¸à¸±à¸™</div>
    <div class="icon-card" style="background:#fff1f2; color:#be185d;" onclick="handleHoliday()">ğŸ–ï¸ à¸«à¸¢à¸¸à¸”</div>
    <div class="icon-card" style="background:#f8fafc; color:#475569;" onclick="openSettings()">âš™ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</div>
</div>

<div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 6px; margin-bottom: 10px;">
    <div id="dateBtn" style="height:50px; background:#f1f5f9; border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:15px; position:relative;">
        <span id="dateShow">22 à¸¡.à¸„. 69</span>
        <input type="date" id="dateInp" onchange="updateThaiDate(this.value)" style="position:absolute; opacity:0; width:100%; height:100%;">
    </div>
    <input type="time" id="tStart" style="height:50px; border-radius:12px; border:1px solid #e2e8f0; text-align:center;">
    <input type="time" id="tEnd" style="height:50px; border-radius:12px; border:1px solid #e2e8f0; text-align:center;">
</div>
        <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 8px; margin-bottom: 12px;">
            <select id="hairStyle" style="height: 70px;">
                <option value="">ğŸ’‡ à¹€à¸¥à¸·à¸­à¸à¸—à¸£à¸‡à¸œà¸¡</option>
                <option value="à¹€à¸”à¹‡à¸">ğŸ‘¶ à¸•à¸±à¸”à¸œà¸¡à¹€à¸”à¹‡à¸</option>
                <option>à¸£à¸­à¸‡à¸—à¸£à¸‡</option><option>à¹à¸Ÿà¸Šà¸±à¹ˆà¸™</option><option>à¸ªà¸à¸´à¸™à¹€à¸Ÿà¸”</option><option>à¹€à¸›à¸´à¸”à¸‚à¹‰à¸²à¸‡</option><option>à¸•à¸³à¸£à¸§à¸ˆ/à¸—à¸«à¸²à¸£</option><option>à¸—à¸£à¸‡à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™</option>
                <option>à¹à¸à¹‰à¸œà¸¡</option><option>à¹‚à¸à¸™à¸œà¸¡</option>
            </select>
            <select id="extra1" style="height: 50px;"><option value="">à¸šà¸£à¸´à¸à¸²à¸£ 1</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡</option><option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡</option></select>
            <select id="extra2" style="height: 50px;"><option value="">à¸šà¸£à¸´à¸à¸²à¸£ 2</option><option>à¹‚à¸à¸™à¸«à¸™à¸§à¸”</option><option>à¸à¸±à¸™à¸«à¸™à¹‰à¸²</option><option>à¸ªà¸£à¸°à¸œà¸¡</option><option>à¸¢à¹‰à¸­à¸¡à¸œà¸¡</option></select>
        </div>

        <div class="price-row"><input type="number" id="priceInp" class="price-box" placeholder="0" inputmode="numeric"><input type="number" id="tipInp" class="tip-input" placeholder="+à¸—à¸´à¸›à¹‚à¸­à¸™" inputmode="numeric"></div>
        <div class="grid-2">
            <button id="btnCash" class="btn btn-pay" onclick="selectPay('Cash')">ğŸ’µ à¹€à¸‡à¸´à¸™à¸ªà¸”</button>
            <button id="btnTrans" class="btn btn-pay" onclick="selectPay('Trans')">ğŸ“± à¹‚à¸­à¸™</button>
        </div>
        <button class="btn btn-main" onclick="handleSave()">à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
    </div> <div id="p2" class="page" style="padding: 15px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
            <div style="background: white; padding:18px 15px; border-radius:20px; text-align:center; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0;">
                <small style="font-weight:800; color:#64748b; text-transform: uppercase;">à¸¢à¸­à¸”à¸£à¸§à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰</small>
                <div id="dTotal" style="font-size:36px; font-weight:900; color:#4338ca; margin: 5px 0;">0</div>
                <div id="dCounts" style="font-size:13px; font-weight:700; color:#1e293b; background:#e0e7ff; display:inline-block; padding:2px 10px; border-radius:10px;">à¸¥à¸¹à¸à¸„à¹‰à¸² 0 à¸„à¸™</div>
            </div>

            <div style="background:white; padding:15px; border-radius:20px; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; display:flex; flex-direction:column; justify-content:center; gap:8px;">
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#0ea5e9;">ğŸ“± à¹‚à¸­à¸™:</span> <b id="dTrans">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#f59e0b;">ğŸ’µ à¸ªà¸”:</span> <b id="dCash">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:700;"><span style="color:#6366f1;">ğŸ¤µ à¸Šà¹ˆà¸²à¸‡:</span> <b id="dBarber">0</b></div>
                <div style="display:flex; justify-content:space-between; font-size:14px; font-weight:800;"><span style="color:#64748b;">ğŸ  à¸£à¹‰à¸²à¸™:</span> <b id="dShop">0</b></div>
            </div>
        </div>
     
   <div id="p3" class="page" style="padding:15px;">
    <div class="bank-net-card">
        <div class="bank-top"><span class="bank-title">à¸šà¸±à¸à¸Šà¸µà¸ªà¸¸à¸—à¸˜à¸´</span><div id="accLight" class="bank-dot"></div></div>
        <div class="bank-balance"><div class="bank-label">à¸¢à¸­à¸”à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­à¸ªà¸¸à¸—à¸˜à¸´</div><div class="bank-amount">à¸¿<span id="accNet">0</span></div></div>
        <div class="bank-sub">
            <div class="bank-row"><span>à¸¢à¸­à¸”à¸„à¹‰à¸²à¸‡à¹€à¸”à¸´à¸¡</span><b id="accOldVal">à¸¿0</b></div>
            <div class="bank-row"><span>à¸¢à¸­à¸”à¸§à¸±à¸™à¸™à¸µà¹‰</span><b id="accTodayVal">à¸¿0</b></div>
        </div>
        <div id="accStatus" class="bank-status">à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”...</div>
    </div>
    <div class="bank-actions">
        <div class="bank-action-card daily" onclick="openDailyPopup()"><i class="fas fa-calendar-day"></i><span>à¸¢à¹‰à¸­à¸™à¸«à¸¥à¸±à¸‡à¸£à¸²à¸¢à¸§à¸±à¸™</span></div>
        <div class="bank-action-card month" onclick="openMonthlyPopup()"><i class="fas fa-chart-pie"></i><span>à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™</span></div>
    </div>
    <button class="btn-save" onclick="clearAccount()" style="margin-top:15px; background:var(--primary); width:100%;">âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¹€à¸„à¸¥à¸µà¸¢à¸£à¹Œà¹€à¸‡à¸´à¸™</button>
</div>
    
    </div> </div> <div id="modalSet" class="modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--primary); text-align: center;">âš™ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š</h3> 
        <label style="font-size:11px; font-weight:600;">à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™</label> <input id="setShop" style="margin-bottom:10px;">
        <div class="grid-2">
            <div><label style="font-size:11px; font-weight:600;">% à¸Šà¹ˆà¸²à¸‡</label><input type="number" id="setPerc" placeholder="à¹€à¸Šà¹ˆà¸™ 50"></div>
            <div><label style="font-size:11px; font-weight:600;">à¸›à¸£à¸°à¸à¸±à¸™/à¸§à¸±à¸™</label><input type="number" id="setGuar" placeholder="0"></div>
        </div>
        <div style="margin-top:10px">
            <label style="font-size:11px; font-weight:600;">à¸˜à¸µà¸¡à¹à¸­à¸›</label>
            <select id="setTheme">
                <option value="neon-light">ğŸŒ¤ Neon Light</option>
                <option value="deep-navy">ğŸŒŒ Deep Navy</option>
                <option value="barber-dark">ğŸŒ‘ Barber Dark</option>
            </select>
        </div>
        <div class="grid-2" style="margin-top:10px">
            <div><label style="font-size:11px; font-weight:600;">à¸£à¸°à¸šà¸šà¹€à¸ªà¸µà¸¢à¸‡</label> <select id="setSound"><option value="on">ğŸ”Š à¹€à¸›à¸´à¸”</option><option value="off">ğŸ”‡ à¸›à¸´à¸”</option></select></div>
            <div><label style="font-size:11px; font-weight:600;">à¹€à¸ªà¸µà¸¢à¸‡à¸à¸¹à¸”</label><select id="setVoice"><option value="female">ğŸ‘© à¸«à¸à¸´à¸‡</option><option value="male">ğŸ‘¨ à¸Šà¸²à¸¢</option></select></div>
        </div>
        <div class="grid-2" style="margin-top:20px">
            <button class="btn" style="background:var(--primary); color:#fff" onclick="saveSettings()">à¸šà¸±à¸™à¸—à¸¶à¸</button>
            <button class="btn" style="background:#e2e8f0; color:var(--text)" onclick="closeSettings()">à¸›à¸´à¸”</button>
        </div>
        <button class="btn" style="width:100%; background:var(--danger); color:#fff; margin-top:10px; font-size:12px;" onclick="clearAllData()">âš ï¸ à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i><span>à¸šà¸±à¸™à¸—à¸¶à¸</span></div>
    <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-file-invoice"></i><span>à¸£à¸²à¸¢à¸‡à¸²à¸™</span></div>
    <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-wallet"></i><span>à¸šà¸±à¸à¸Šà¸µ</span></div>
</nav>
 <div id="dailyPopup" class="modal"><div class="modal-content"><h3>ğŸ“… à¸¢à¹‰à¸­à¸™à¸«à¸¥à¸±à¸‡à¸£à¸²à¸¢à¸§à¸±à¸™</h3><input type="date" id="histDate" onchange="loadHistDaily()"><div id="histDailyArea" style="max-height:300px;overflow-y:auto;"></div><button class="btn" onclick="closePop('dailyPopup')" style="width:100%;margin-top:10px;">à¸›à¸´à¸”</button></div></div>
<div id="monthlyPopup" class="modal"><div class="modal-content"><h3>ğŸ“Š à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™</h3><input type="month" id="histMonth" onchange="loadHistMonth()"><div id="histMonthArea" style="max-height:300px;overflow-y:auto;"></div><button class="btn" onclick="closePop('monthlyPopup')" style="width:100%;margin-top:10px;">à¸›à¸´à¸”</button></div></div>
 <script>
    let archives = JSON.parse(localStorage.getItem("barber_archives")) || [];
    function save() {localStorage.setItem("barber_archives", JSON.stringify(archives));}
    let db = JSON.parse(localStorage.getItem("barber_db")) || [];
    let conf = JSON.parse(localStorage.getItem("barber_conf")) || { shop: "Barber Shop", perc: 50, guar: 0 };
    let account = JSON.parse(localStorage.getItem("barber_account")) || { balance: 0, logs: [] };
    let payMethod = "";
    const $ = (id) => document.getElementById(id);
    window.onload = () => {
        const today = new Date().toISOString().split('T')[0];
        if($("dateInp")) $("dateInp").value = today;if($("accDate")) $("accDate").value = today;if($("histDate")) $("histDate").value = today;if($("shopNameDisp")) $("shopNameDisp").innerText = conf.shop;
        updateDateDisplay(today);
    };
    function addMinutes(time, mins) {
    if (!time) return "";
    const [h, m] = time.split(":").map(Number);
    const d = new Date();
    d.setHours(h, m + mins, 0, 0);
    return d.toTimeString().slice(0, 5);
}
function handleSave() {
    const p = parseInt($("priceInp").value), t = parseInt($("tipInp").value) || 0;
    if (!p || !payMethod) return alert("à¹ƒà¸ªà¹ˆà¸£à¸²à¸„à¸²à¹à¸¥à¸°à¹€à¸¥à¸·à¸­à¸à¸§à¸´à¸˜à¸µà¸ˆà¹ˆà¸²à¸¢à¸à¹ˆà¸­à¸™!");
    const start = $("tStart").value || new Date().toTimeString().slice(0, 5);
    const rec = {
        id: Date.now(), date: $("dateInp").value, time: start, endTime: $("tEnd").value || addMinutes(start, 30),
        svcs: [$("hairStyle").value, $("extra1").value, $("extra2").value].filter(Boolean),
        hair: $("hairStyle").value, price: p, tip: t, pay: payMethod, type: "SERVICE"
    };
    db.push(rec); saveDB(); renderDay(); // à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¸°à¸§à¸²à¸”à¸«à¸™à¹‰à¸² 2 à¹ƒà¸«à¸¡à¹ˆ
    ["priceInp", "tipInp", "tStart", "tEnd"].forEach(id => $(id).value = ""); // à¸¥à¹‰à¸²à¸‡à¸Šà¹ˆà¸­à¸‡à¸à¸£à¸­à¸
}
function handleInsurance() {
    const d = $("dateInp").value || new Date().toISOString().split('T')[0], g = parseInt(conf.guar) || 0;
    const speak = (t) => { const m = new SpeechSynthesisUtterance(t); m.lang = 'th-TH'; window.speechSynthesis.speak(m); };
    if (g <= 0) return (speak("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸›à¸£à¸°à¸à¸±à¸™"), alert("âš ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸¢à¸­à¸”à¸›à¸£à¸°à¸à¸±à¸™à¹ƒà¸™ 'à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š' à¸à¹ˆà¸­à¸™"));
    if (db.find(r => r.date === d && r.type === "GUARANTEE_CLAIM")) return (speak("à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸›à¸´à¸”à¸›à¸£à¸°à¸à¸±à¸™à¹„à¸›à¹à¸¥à¹‰à¸§à¸„à¹ˆà¸°"), alert("ğŸ›¡ï¸ à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸à¸±à¸™à¹„à¸›à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š"));
    if (confirm(`ğŸ›¡ï¸ à¸¢à¸·à¸™à¸¢à¸±à¸™à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸š 'à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¹„à¸”à¹‰'?`)) {
        db.push({ id: Date.now(), date: d, time: "00:00", svcs: ["ğŸ›¡ï¸ à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¸§à¸±à¸™"], price: 0, pay: "N/A", type: "GUARANTEE_CLAIM" });
        saveDB(); speak(`à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸à¸±à¸™ ${g} à¸šà¸²à¸— à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢`); alert("âœ… à¹€à¸›à¸´à¸”à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸à¸±à¸™à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"); renderDay();
    }
}
function handleHoliday() {
    const d = $("dateInp").value; if (!d) return alert("à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸à¹ˆà¸­à¸™");
    const speak = (t) => { const m = new SpeechSynthesisUtterance(t); m.lang = 'th-TH'; window.speechSynthesis.speak(m); };
    if (confirm(`à¸¢à¸·à¸™à¸¢à¸±à¸™à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ ${d} à¹€à¸›à¹‡à¸™ "à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”"?`)) {
        db.push({ id: Date.now(), date: d, time: "00:00", svcs: ["ğŸ–ï¸ à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”"], price: 0, pay: "N/A", type: "HOLIDAY" });
        saveDB(); speak("à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸›à¹‡à¸™à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"); alert("ğŸ–ï¸ à¸šà¸±à¸™à¸—à¸¶à¸à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"); renderDay();
    }
}
    function openSettings() {
        const modal = $("modalSet");
        if (modal) {
            $("setShop").value = conf.shop || "";
            $("setPerc").value = conf.perc || 50;
            $("setGuar").value = conf.guar || 0;
            modal.style.display = 'flex'; 
        }
    }
function saveSettings() {
    conf.shop = $("setShop").value; conf.perc = parseInt($("setPerc").value);
    conf.guar = parseInt($("setGuar").value); conf.theme = $("setTheme").value;
    conf.sound = $("setSound").value; conf.voice = $("setVoice").value;
    conf.bright = $("setBright").value;
    
    localStorage.setItem("barber_conf", JSON.stringify(conf));
    applyTheme(conf.theme); changeBrightness(conf.bright);
    $("shopNameDisp").innerText = conf.shop;
    
    if (typeof speak === 'function') speak("à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§");
    alert("âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢"); closeSettings();
}
    function closeSettings() {
        if ($("modalSet")) $("modalSet").style.display = 'none';
    }
    function applyTheme(themeName) {
    document.body.className = themeName;
     }
    function speak(text) {
    if (conf.sound === 'off') return;
    window.speechSynthesis.cancel();
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'th-TH';
    msg.pitch = (conf.voice === 'male') ? 0.8 : 1.2;
    window.speechSynthesis.speak(msg);
    }
    function clearAllData() {
        if (confirm("à¸„à¸¸à¸“à¹à¸™à¹ˆà¹ƒà¸ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¸—à¸µà¹ˆà¸ˆà¸°à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”? à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸°à¸«à¸²à¸¢à¸–à¸²à¸§à¸£!")) {
            localStorage.clear();
            location.reload();
        }
    }
function updateThaiDate(val) {
    if(!val) return;
    const d = new Date(val);
    const months = ["à¸¡.à¸„.","à¸.à¸.","à¸¡à¸µ.à¸„.","à¹€à¸¡.à¸¢.","à¸.à¸„.","à¸¡à¸´.à¸¢.","à¸.à¸„.","à¸ª.à¸„.","à¸.à¸¢.","à¸•.à¸„.","à¸.à¸¢.","à¸˜.à¸„."];
    const year = (d.getFullYear() + 543).toString().slice(-2);
    document.getElementById('dateShow').innerText = `${d.getDate()} ${months[d.getMonth()]} ${year}`;
    renderAll(); // à¸­à¸±à¸›à¹€à¸”à¸•à¹€à¸¥à¸‚à¸«à¸™à¹‰à¸²à¸­à¸·à¹ˆà¸™à¸”à¹‰à¸§à¸¢
}
    function selectPay(m) {
        payMethod = m;
        $("btnCash").className = `btn btn-pay ${m === 'Cash' ? 'active-cash' : ''}`;
        $("btnTrans").className = `btn btn-pay ${m === 'Trans' ? 'active-trans' : ''}`;
    }
function renderDay() {
    const dInp = $("dateInp").value, today = db.filter(r => r.date === dInp), stats = {};
    let tot = 0, trans = 0, cash = 0, listHtml = "";
    today.slice().sort((a,b) => a.time.localeCompare(b.time)).forEach((r, i) => {
        tot += r.price; (r.pay === 'Trans') ? trans += (r.price + (r.tip||0)) : cash += r.price;
        const counted = new Set(["à¸•à¸±à¸”à¸œà¸¡"]); if (r.hair && r.hair.includes("à¹€à¸”à¹‡à¸")) counted.add("à¹€à¸”à¹‡à¸");
        (r.svcs || []).forEach(s => { if (s && !["à¹€à¸”à¹‡à¸","à¸£à¸­à¸‡à¸—à¸£à¸‡","à¹à¸Ÿà¸Šà¸±à¹ˆà¸™","à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™","à¸•à¸±à¸”à¸œà¸¡"].some(x => s.includes(x))) counted.add(s); });
        counted.forEach(k => stats[k] = (stats[k] || 0) + 1);
        const timeShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        listHtml += `<div class="history-row" style="padding:15px; border-bottom:1px solid #f1f5f9; background:#fff;"><div style="display:flex; justify-content:space-between; align-items:center;"><span style="font-weight:800; font-size:14px; color:#1e293b;">${i+1}. [${timeShow}] | ${(r.svcs||[]).join('+')}</span><div style="text-align:right;"><b style="font-size:16px; display:block;">à¸¿${r.price}${r.tip?` <small style="color:#be185d;">(+${r.tip})</small>`:''}</b><span style="font-size:12px; font-weight:700;">${r.pay==='Trans'?'ğŸ“± à¹‚à¸­à¸™':'ğŸ’µ à¸ªà¸”'} <i class="fas fa-trash-alt" style="color:#ef4444; cursor:pointer; margin-left:8px;" onclick="delRec(${r.id})"></i></span></div></div></div>`;
    });
    const bEarn = Math.max(tot * (conf.perc / 100), conf.guar), sEarn = tot - bEarn, settle = cash - bEarn;
    $("dTotal").innerText = tot.toLocaleString(); $("dTrans").innerText = trans.toLocaleString(); $("dCash").innerText = cash.toLocaleString();
    $("dBarber").innerText = Math.floor(bEarn).toLocaleString(); $("dShop").innerText = Math.floor(sEarn).toLocaleString(); $("dCounts").innerText = `à¸¥à¸¹à¸à¸„à¹‰à¸²: ${today.length} à¸„à¸™`;
    let sH = `<div style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-bottom:10px;">`;
    ["à¸•à¸±à¸”à¸œà¸¡", "à¹€à¸”à¹‡à¸"].forEach(k => { if (stats[k]) sH += `<span style="background:#4338ca;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${k}: ${stats[k]}</span>`; });
    for (let s in stats) { if (!["à¸•à¸±à¸”à¸œà¸¡", "à¹€à¸”à¹‡à¸"].includes(s)) sH += `<span style="background:#64748b;color:#fff;padding:5px 12px;border-radius:8px;font-size:11px;font-weight:800;">${s}: ${stats[s]}</span>`; }
    $("dServiceStats").innerHTML = sH + `</div>`;
    $("dailyList").innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin:10px 0; padding:0 5px;"><b style="font-size:16px;">ğŸ“‹ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸§à¸±à¸™à¸™à¸µà¹‰:</b><i class="fab fa-line" style="color:#22c55e;font-size:32px;cursor:pointer" onclick="shareLine()"></i></div>` + (listHtml || "<center style='padding:40px; opacity:0.3;'>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>");
    let txt = "", bg = ""; if (tot === 0) { txt = "ğŸŸ¦ à¸£à¹‰à¸²à¸™à¸ˆà¹ˆà¸²à¸¢à¸›à¸£à¸°à¸à¸±à¸™"; bg = "#e0f2fe"; } else if (settle > 0) { txt = `ğŸŸ¥ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™ à¸¿${settle.toLocaleString()}`; bg = "#fee2e2"; } else if (settle < 0) { txt = `ğŸŸ¦ à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡ à¸¿${Math.abs(settle).toLocaleString()}`; bg = "#e0e7ff"; } else { txt = "âœ… à¸¢à¸­à¸”à¸à¸­à¸”à¸µ"; bg = "#dcfce7"; }
    const container = $("settleBar").parentElement; container.style.cssText = "display:flex; gap:10px; margin-top:10px;";
    container.innerHTML = `<div id="settleBar" style="flex:8; height:55px; background:${bg}; display:flex; align-items:center; justify-content:center; border-radius:15px; font-weight:900; font-size:15px; color:#1e293b; border:1px solid rgba(0,0,0,0.05);">${txt}</div><button onclick="saveAndGo('${dInp}', ${tot}, ${sEarn}, ${bEarn})" style="flex:2; height:55px; background:#f97316; color:#fff; border-radius:15px; border:none; font-size:22px; cursor:pointer; display:flex; align-items:center; justify-content:center; box-shadow: 0 4px 6px rgba(0,0,0,0.1);"><i class="fas fa-paper-plane"></i></button>`;
}
function saveAndGo(date, total, shop, barber) {
    if (total === 0 && !confirm("à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¢à¸­à¸” à¸›à¸´à¸”à¸‡à¸²à¸™à¹€à¸¥à¸¢à¸¡à¸±à¹‰à¸¢?")) return;
    let s = {}; db.filter(r => r.date === date).forEach(r => { 
        r.svcs.forEach(v => s[v] = (s[v]||0)+1); if(r.hair) s["à¸—à¸£à¸‡:"+r.hair] = (s["à¸—à¸£à¸‡:"+r.hair]||0)+1; 
    });
    const entry = { date, total, barber, shop: total-barber, count: db.filter(r => r.date === date).length, stats: s };
    const i = archives.findIndex(a => a.date === date); (i > -1) ? archives[i] = entry : archives.push(entry);
    save(); alert("âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢!"); go(3);
}
    function toggleAccHistory() {
        const w = $("accHistoryWrapper");
        w.style.display = w.style.display === "none" ? "block" : "none";
        $("accHistory").innerHTML = account.logs.map(l => `<div style="padding:5px; border-bottom:1px solid #eee;">${l.date}: à¸¿${l.amount} (${l.note})</div>`).join('') || "à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´";
    }
function renderAll() {
    // 1. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸¥à¸‚à¸«à¸™à¹‰à¸² 2 (à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¸§à¸±à¸™)
    const today = document.getElementById('dateInp').value;
    const todayEntries = db.filter(e => e.date === today);
    
    let total = 0, cash = 0, trans = 0, bTotal = 0, sTotal = 0;
    todayEntries.forEach(e => {
        total += e.total;
        if(e.method === 'Cash') cash += e.price;
        else trans += (e.price + (e.tip || 0));
        bTotal += e.bEarn;
        sTotal += e.sEarn;
    });

    // à¸¢à¸±à¸”à¹€à¸¥à¸‚à¸¥à¸‡à¸«à¸™à¹‰à¸² 2
    document.getElementById('todayTotal').innerText = total;
    document.getElementById('todayCash').innerText = cash;
    document.getElementById('todayTrans').innerText = trans;
    document.getElementById('todayShop').innerText = sTotal;
    document.getElementById('todayBarber').innerText = bTotal;

    // 2. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸¥à¸‚à¸«à¸™à¹‰à¸² 3 (à¸šà¸±à¸à¸Šà¸µà¸ªà¸¸à¸—à¸˜à¸´)
    const accNet = bTotal + (parseFloat(localStorage.getItem('oldDebt')) || 0);
    document.getElementById('accNet').innerText = accNet;
    document.getElementById('accTodayVal').innerText = "à¸¿" + bTotal;
    document.getElementById('accOldVal').innerText = "à¸¿" + (localStorage.getItem('oldDebt') || 0);
    
    // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸µà¹„à¸Ÿà¸ªà¸–à¸²à¸™à¸°
    const light = document.getElementById('accLight');
    if(accNet > 0) { light.style.background = '#22c55e'; light.style.boxShadow = '0 0 10px #22c55e'; }
    else { light.style.background = 'gray'; light.style.boxShadow = 'none'; }
}
   function loadHistDaily() {const d = $("histDate").value; const found = archives.find(a => a.date === d); const area = $("histDailyArea"); 
    if(!found) { area.innerHTML = "<center style='color:#ccc; padding:40px;'>âŒ à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸™à¸›à¸£à¸°à¸§à¸±à¸•à¸´</center>"; return; }
    let rows = found.details.map(r => `
        <div class="history-row" style="font-size:13px; padding:10px 0; border-bottom:1px solid #f1f5f9;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b style="color:#1e293b;">${r.time} | ${r.svcs.join('+')}</b> 
                <b style="color:#1e293b;">à¸¿${r.price}</b>
            </div>
            <div style="font-size:12px; font-weight:600; color:#64748b; margin-top:4px;">
                ${r.hair || '-'} 
                <span style="font-weight:400; opacity:0.6; float:right;">(${r.pay==='Cash'?'ğŸ’µ à¹€à¸‡à¸´à¸™à¸ªà¸”':'ğŸ“± à¹‚à¸­à¸™'})</span>
            </div>
        </div>`).join('');

    // 2. à¸›à¹‰à¸²à¸¢à¸ªà¸–à¸´à¸•à¸´ (Badge)
    let statBadges = ""; if (found.stats) { for(let s in found.stats) { let bg = s.startsWith("à¸—à¸£à¸‡:") ? "#10b981" : "#6366f1"; statBadges += `<span class="badge" style="background:${bg}; color:#fff; margin:2px; padding:4px 8px; border-radius:6px; font-size:11px;">${s.replace("à¸—à¸£à¸‡:","")}: ${found.stats[s]}</span>`; 
        } 
    }
    const settle = found.settle || 0;
    const settleText = settle > 0 ? `ğŸ”´ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™: à¸¿${Math.floor(settle).toLocaleString()}` : settle < 0 ? `ğŸ”µ à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡: à¸¿${Math.floor(Math.abs(settle)).toLocaleString()}` : "ğŸŸ¢ à¸¢à¸­à¸”à¸à¸­à¸”à¸µà¹€à¸›à¹Šà¸°";
    const settleClass = settle > 0 ? "status-red" : settle < 0 ? "status-indigo" : "status-green";

    area.innerHTML = `
    <div style="background:#fff; padding:15px; border-radius:20px; border:1px solid #e2e8f0; margin-top:10px; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05);">
        <div class="status-bar ${settleClass}" style="padding:10px; font-size:14px; margin-bottom:15px; border-radius:12px; font-weight:900; text-align:center;">
            ${settleText}
        </div>
        
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px; font-size:13px;">
            <div style="background:#f8fafc; padding:10px; border-radius:10px; border:1px solid #f1f5f9;">à¸¢à¸­à¸”à¸•à¸±à¸”: <b>${found.total.toLocaleString()}</b></div>
            <div style="background:#f8fafc; padding:10px; border-radius:10px; border:1px solid #f1f5f9;">à¹€à¸‡à¸´à¸™à¸ªà¸”: <b>${found.cash.toLocaleString()}</b></div>
            <div style="background:#f0fdf4; padding:10px; border-radius:10px; color:#166534;">à¸Šà¹ˆà¸²à¸‡à¹„à¸”à¹‰: <b>${Math.floor(found.barber).toLocaleString()}</b></div>
            <div style="background:#eff6ff; padding:10px; border-radius:10px; color:#1e40af;">à¸£à¹‰à¸²à¸™à¹„à¸”à¹‰: <b>${Math.floor(found.shop).toLocaleString()}</b></div>
        </div>

        <div style="margin-bottom:15px; display:flex; flex-wrap:wrap; gap:4px;">${statBadges}</div>
        <div style="border-top:2px dashed #f1f5f9; padding-top:10px;">${rows}</div>
    </div>`;
}
  function loadHistMonth() {
    const m = $("histMonth").value; 
    const area = $("histMonthArea"); 
    if(!m) return;
    
    const filtered = archives.filter(a => a.date.startsWith(m));
    if(!filtered.length) { 
        area.innerHTML = "<center style='color:#ccc; padding:40px;'>ğŸŒ‘ à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¸­à¸‡à¹€à¸”à¸·à¸­à¸™à¸™à¸µà¹‰</center>"; 
        return; 
    }

    let mTotal = 0, mBarber = 0, mShop = 0, mCount = 0, mStats = {};
    filtered.forEach(a => { 
        mTotal += a.total; 
        mBarber += a.barber; 
        mShop += (a.total - a.barber); 
        mCount += a.count; 
        if(a.stats) { for(let s in a.stats) mStats[s] = (mStats[s] || 0) + a.stats[s]; } 
    });

    let sB = "", hB = "";
    for(let s in mStats) { 
        if(s.startsWith("à¸—à¸£à¸‡:")) hB += `<span class="badge" style="background:#10b981; color:white; padding:4px 8px; border-radius:6px; margin:2px; font-size:11px;">${s.replace("à¸—à¸£à¸‡:","")}: ${mStats[s]}</span>`; 
        else sB += `<span class="badge" style="background:#6366f1; color:white; padding:4px 8px; border-radius:6px; margin:2px; font-size:11px;">${s}: ${mStats[s]}</span>`; 
    }
    area.innerHTML = `
    <div style="padding:15px; background:#fff; border-radius:20px; border:1px solid #e2e8f0; box-shadow:0 4px 6px -1px rgba(0,0,0,0.05);">
        <div style="text-align:center; margin-bottom:20px; padding:15px; background:linear-gradient(to bottom, #fff, #f8fafc); border-radius:15px; border:1px solid #f1f5f9;">
            <div style="font-size:12px; color:#64748b; font-weight:bold; margin-bottom:5px;">âœ‚ï¸ à¸¢à¸­à¸”à¸•à¸±à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¹€à¸”à¸·à¸­à¸™</div>
            <div style="font-size:32px; font-weight:900; color:#1e293b;">à¸¿${mTotal.toLocaleString()}</div>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px;">
            <div style="background:#f0fdf4; padding:15px; border-radius:15px; text-align:center; border:1px solid #dcfce7;">
                <div style="font-size:11px; color:#166534; font-weight:bold;">ğŸ¤µ à¸Šà¹ˆà¸²à¸‡à¸£à¸§à¸¡</div>
                <div style="font-size:20px; font-weight:900; color:#15803d;">à¸¿${Math.floor(mBarber).toLocaleString()}</div>
            </div>
            <div style="background:#eff6ff; padding:15px; border-radius:15px; text-align:center; border:1px solid #dbeafe;">
                <div style="font-size:11px; color:#1e40af; font-weight:bold;">ğŸ  à¸£à¹‰à¸²à¸™à¸£à¸§à¸¡</div>
                <div style="font-size:20px; font-weight:900; color:#1e40af;">à¸¿${Math.floor(mShop).toLocaleString()}</div>
            </div>
        </div>

        <div style="display:flex; justify-content:space-around; font-size:13px; margin-bottom:20px; padding:10px; background:#f8fafc; border-radius:12px;">
            <div>ğŸ‘¥ à¸¥à¸¹à¸à¸„à¹‰à¸²: <b>${mCount} à¸„à¸™</b></div>
            <div style="color:#e2e8f0;">|</div>
            <div>ğŸ“… à¸—à¸³à¸‡à¸²à¸™: <b>${filtered.length} à¸§à¸±à¸™</b></div>
        </div>
        <div style="border-top:2px dashed #f1f5f9; padding-top:15px;">
            <label style="font-size:12px; color:#1e293b; font-weight:900;">ğŸ“Š à¸ªà¸–à¸´à¸•à¸´à¸šà¸£à¸´à¸à¸²à¸£:</label>
            <div style="margin:8px 0 15px 0; display:flex; flex-wrap:wrap; gap:2px;">${sB || '-'}</div>
            <label style="font-size:12px; color:#1e293b; font-weight:900;">ğŸ’‡ à¸—à¸£à¸‡à¸œà¸¡à¸¢à¸­à¸”à¸®à¸´à¸•:</label>
            <div style="margin-top:8px; display:flex; flex-wrap:wrap; gap:2px;">${hB || '-'}</div>
        </div>
    </div>`;
    }
function shareLine() {
    const dInp = $("dateInp").value; // à¸”à¸¶à¸‡à¸„à¹ˆà¸² 2026-01-22
    const today = db.filter(r => r.date === dInp);
    if (!today.length) return;

    // --- à¸ˆà¸¸à¸”à¸—à¸µà¹ˆ 1: à¸¢à¹‰à¸²à¸¢à¸§à¸±à¸™à¸—à¸µà¹ˆà¸¡à¸²à¹„à¸§à¹‰à¸«à¸™à¹‰à¸² à¸.à¸¨. (22/01/2026) ---
    const dateParts = dInp.split('-');
    const formattedDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;

    let tot = 0, cash = 0, trans = 0, stats = {};
    let clientList = today.sort((a,b) => a.time.localeCompare(b.time)).map((r, i) => {
        tot += r.price; r.pay === 'Trans' ? trans += r.price : cash += r.price;
        
        // à¹€à¸à¹‡à¸šà¸ªà¸–à¸´à¸•à¸´à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡à¹„à¸§à¹‰à¸à¹ˆà¸­à¸™ (à¹€à¸à¸·à¹ˆà¸­à¹€à¸­à¸²à¹„à¸›à¸à¸£à¸­à¸‡à¸—à¸µà¸«à¸¥à¸±à¸‡)
        if (r.hair && r.hair.includes("à¹€à¸”à¹‡à¸")) stats["à¹€à¸”à¹‡à¸"] = (stats["à¹€à¸”à¹‡à¸"] || 0) + 1;
        (r.svcs || []).forEach(s => {
            if (!s) return;
            stats[s] = (stats[s] || 0) + 1;
        });
        const tShow = r.endTime ? `${r.time}-${r.endTime}` : r.time;
        return `${i+1}. [${tShow}] ${(r.svcs || []).join('+')} = ${r.price} ${r.pay === 'Trans' ? 'ğŸ“±' : 'ğŸ’µ'}`;
    }).join('\n');
    const allowedStats = ["à¹€à¸”à¹‡à¸", "à¸ªà¸£à¸°à¸œà¸¡", "à¹‚à¸à¸™à¸«à¸™à¸§à¸”", "à¸¢à¹‰à¸­à¸¡à¸œà¸¡", "à¸¢à¹‰à¸­à¸¡à¸ªà¸µ"];
    let statText = Object.entries(stats)
        .filter(([k]) => allowedStats.some(a => k.includes(a))) // à¹€à¸­à¸²à¹€à¸‰à¸à¸²à¸°à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸„à¸³à¸—à¸µà¹ˆà¸ªà¸±à¹ˆà¸‡
        .map(([k, v]) => {
            let icon = "ğŸ”¹";
            if (k.includes("à¹€à¸”à¹‡à¸")) icon = "ğŸ§’";
            else if (k.includes("à¸ªà¸£à¸°")) icon = "ğŸ§¼";
            else if (k.includes("à¹‚à¸à¸™")) icon = "ğŸª’";
            else if (k.includes("à¸¢à¹‰à¸­à¸¡")) icon = "ğŸ¨";
            return `${icon} ${k}: ${v}`;
        }).join('\n');
    
    let bEarn = Math.max(tot * (conf.perc / 100), conf.guar);
    let settle = cash - bEarn;
    let settleMsg = settle > 0 ? `âš ï¸ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¸£à¹‰à¸²à¸™ ${Math.floor(Math.abs(settle))}` : `ğŸŸ¦ à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¸Šà¹ˆà¸²à¸‡ ${Math.floor(Math.abs(settle))}`;
    
    let msg = `ğŸ’ˆ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸£à¹‰à¸²à¸™: Barber Shop\nğŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆ: ${formattedDate}\n-------------------------\nğŸ“ à¸¥à¸¹à¸à¸„à¹‰à¸² (à¸£à¸§à¸¡ ${today.length} à¸„à¸™):\n${clientList}\n-------------------------\nğŸ“Š à¸ªà¸£à¸¸à¸›à¸‡à¸²à¸™:\n${statText}\n-------------------------\nğŸ’° à¸¢à¸­à¸”à¸£à¸§à¸¡: ${tot}\nğŸ“± à¹‚à¸­à¸™: ${trans} | ğŸ’µ à¸ªà¸”: ${cash}\nğŸ¤µ à¸Šà¹ˆà¸²à¸‡: ${Math.floor(bEarn)}\nğŸ  à¸£à¹‰à¸²à¸™: ${Math.floor(tot - bEarn)}\n-------------------------\n${settleMsg}`;
    
    window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
}
    function saveDB() { localStorage.setItem("barber_db", JSON.stringify(db)); localStorage.setItem("barber_conf", JSON.stringify(conf)); }
    function go(n) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); if(document.getElementById('p'+n)) document.getElementById('p'+n).classList.add('active'); if(document.getElementById('n'+n)) document.getElementById('n'+n).classList.add('active'); renderDay(); }
    function delRec(id) { if (confirm("à¸ˆà¸°à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¹„à¸«à¸¡à¸„à¸£à¸±à¸šà¸à¸µà¹ˆ?")) { db = db.filter(r => r.id !== id); saveDB(); renderDay(); } }
    function editTime(id) {const rec = db.find(r => r.id === id);if (!rec) return;const newStart = prompt("à¹à¸à¹‰à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡ (HH:MM)", rec.time);if (!newStart) return;const newEnd = prompt("à¹à¸à¹‰à¹€à¸§à¸¥à¸²à¹€à¸ªà¸£à¹‡à¸ˆ (HH:MM)", rec.endTime || "");rec.time = newStart;rec.endTime = newEnd || addMinutes(newStart, 30);saveDB();renderDay();}
    function openDailyPopup(){ document.getElementById('dailyPopup').style.display="flex"; }
    function openMonthlyPopup(){ document.getElementById('monthlyPopup').style.display="flex"; }
    function closePop(id){ document.getElementById(id).style.display="none"; }
  
</script>
</body>
</html>
